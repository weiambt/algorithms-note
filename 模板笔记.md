æ¨¡æ¿ç¬”è®°

ç©ºé—´æœ€å¤§å¼€åˆ°5e7

## æ¿å­

### å¿«è¯»

ä¸‹é¢è¿™ä¸ªæ¿å­æ‰æ˜¯çœŸæ­£æœ‰ç”¨çš„ï¼ˆåœ¨è“æ¡¥æ¯æœ‰ç”¨ï¼‰

- è¯»å…¥æ•°å­—ï¼šç”¨StreamTokenizerï¼Œå…ˆnextTokenï¼Œå†st.nvalæ‹¿åˆ°å€¼
- è¯»å­—ç¬¦ä¸²ï¼šç”¨BufferedReaderï¼Œç”¨readLineè¯»ã€‚
- å¦‚æœæ•°å­—å’Œå­—ç¬¦æ··è¯»ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸€ä¸ªæ•°å­—è¯»å®Œå†è¯»Stringçš„æ—¶å€™è¦å¤šç”¨ä¸€ä¸ªnextLineè¯»å…¥å›è½¦ç¬¦

```java
class Read{
	StreamTokenizer st = new StreamTokenizer(new BufferedReader(new InputStreamReader(System.in)));
	BufferedReader reader = new BufferedReader(new InputStreamReader(System.in));
	public int nextInt() throws Exception{
		st.nextToken();
		return (int) st.nval;
	}
	
	public double nextDouble() throws Exception{
		st.nextToken();
		return st.nval;
	}
	
	public long nextLong() throws Exception{
		st.nextToken();
		return (long)st.nval;
	}
	
	public String nextLine() throws Exception{
		return reader.readLine();
	}
}
```

> åœ¨è“æ¡¥æ¯ä¸­ï¼Œ1e5æ•°æ®é‡çš„è¾“å…¥éœ€è¦ç”¨å¿«è¯»æ‰èƒ½æ‹¿ä¸‹æ›´å¤šçš„åˆ†

### å¿«å†™

printlnå¾ˆæ…¢ï¼Œæ‰§è¡Œ1e5æ¬¡printlnéœ€è¦1ç§’ï¼Œæ‰§è¡Œ1e6æ¬¡printéœ€è¦1ç§’ï¼Œæ‰€ä»¥å½“è¾“å‡ºè¶…è¿‡1e6å°±è¦ç”¨å¿«å†™

```
PrintWriter out = new PrintWriter(new OutputStreamWriter(System.out));
//......
out.flush();
```







### å–æ¨¡

å¤„ç†è´Ÿæ•°çš„æ¨¡æ˜¯è´Ÿæ•°çš„é—®é¢˜ï¼Œå¯ä»¥è®©è´Ÿæ•°çš„æ¨¡æ˜¯æ­£æ•°

```java
	static int getMod(int a,int mod) {
		return (a%mod + mod)%mod;
	}
```

### å¿«é€Ÿå¹‚

```java
public class Main {
  static long qpow(long a,long b,long mod){
    long res = 1;
    while(b>0){
      if((b&1)==1) res *= a;
      b >>= 1;
      a *= a;
      res %= mod;
      a %= mod;
    }
    return res;
  }

//ps:ç”¨longæ¥å­˜ï¼Œé‡Œé¢æœ‰ä¹˜æ³•ï¼Œä¼šçˆ†intçš„ï¼Œå³ä½¿é¢˜ç›®é‡Œé¢çš„è¾“å…¥æ˜¯intçš„ã€‚
```





## æ¨¡æ‹Ÿ

### æ—¥æœŸ

```java
static int[] d = {0,31,30,31,30,31,30,31,31,30,31,30,31};

static int nextDay(int n) {
	int year = n/10000;
	int mon = n%10000/100;
	int day = n%100;
	
	//åˆ¤æ–­é—°å¹´ï¼Œç¡®å®š2æœˆæœ‰å¤šå°‘å¤©
	if(year%4==0 && year%100!=0 || year%400==0) 
		d[2] = 29;
	else d[2] = 28;
		
	//è®¡ç®—
	day++;
	if(day>d[mon]) {
		mon++;
		day = 1;
	}
	if(mon>12) {
		mon = 1;
		year++;
	}
	return year*10000+mon*100+day;
}

//ä»å¼€å§‹æ—¥æœŸæšä¸¾åˆ°ç»“æŸæ—¥æœŸ
for(int i=from;i<=to;i=nextDay(i)) {
    if(check(i))
        ans++;
}
```


## åŸºç¡€ç®—æ³•

### æ•´æ•°äºŒåˆ†

- æ¨¡æ¿1ï¼šå¯»æ‰¾å·¦è¾¹ç•Œ

  æ‰¾å·¦è¾¹ç•Œâ€”â€”>æ‰¾å·¦åŒºé—´â€”â€”> r = midï¼Œä»è€Œmidé‚£é‡Œä¸éœ€è¦+1ï¼Œelseé‡Œé¢å°±æ˜¯l = mid+1;

  æ‰¾å·¦è¾¹ç•Œâ€”â€”>æ‰¾å·¦åŒºé—´â€”â€”>checkä¸­çš„midä¸€å®šåœ¨xçš„å³è¾¹ï¼Œmid>x

  ```java
  	int l = 1,r = n;
  	while(l<r) {
          int mid = (l+r)>>1;
          if(check(mid)) r=mid;
          else l = mid+1;
      }
  	return l;
  ```

- æ¨¡æ¿2ï¼šå¯»æ‰¾å³è¾¹ç•Œ

  æ‰¾å³è¾¹ç•Œâ€”â€”>æ‰¾å³åŒºé—´â€”â€”> l = midï¼Œä»è€Œmidé‚£é‡Œéœ€è¦+1ï¼Œelseé‡Œé¢å°±æ˜¯r = mid-1;

  æ‰¾å³è¾¹ç•Œâ€”â€”>æ‰¾å³åŒºé—´â€”â€”>checkä¸­çš„midä¸€å®šåœ¨xçš„å·¦è¾¹ï¼Œmid<x

  ```java
      int l = 1,r = n;
      while(l<r) {
          int mid = (l+r+1)>>1;
          if(check(mid)) l=mid;
          else r = mid-1;
      }
      return l;
  ```

- äºŒåˆ†æ­¥éª¤

  - 1.ææ¸…æ¥šè¿™é¢˜ç”¨äºŒåˆ†æ‰¾åˆ°ä»€ä¹ˆï¼Ÿæ¯”å¦‚æ±‚ç¬¬ä¸€ä¸ªmidæ»¡è¶³mid > x
  - 2.æ˜¯æ±‚å·¦è¾¹ç•Œè¿˜æ˜¯å³è¾¹ç•Œï¼Œå¦‚æœæ˜¯å·¦è¾¹ç•Œå°±æ˜¯æ±‚å·¦åŒºé—´ï¼Œé‚£ä¹ˆcheckåé¢å°±æ˜¯r=mid
  - 3.checkå‡½æ•°å°±èƒ½å†™å‡ºæ¥äº†ï¼ˆç”±2çŸ¥é“äº†å·¦åŒºé—´è¿˜æ˜¯å³åŒºé—´ï¼Œå¦‚æœæ˜¯æ±‚å·¦åŒºé—´ï¼Œé‚£ä¹ˆmidä¸€å®šå°±åœ¨å³åŒºé—´ï¼‰
  - 4.æ ¹æ®2å°±èƒ½çŸ¥é“midçš„ç»“æœæ˜¯å¦éœ€è¦+1

- æ³¨æ„ç‚¹ï¼š

  - äºŒåˆ†ä¸€å®šæœ‰ç­”æ¡ˆï¼Œä¸€å®šä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œä½†æ˜¯è¿™ä¸ªå€¼ä¸ä¸€å®šæ»¡è¶³é¢˜æ„ï¼Œæ‰€ä»¥è¦ç‰¹åˆ¤æœ€åè¿”å›çš„læ˜¯å¦æ»¡è¶³é¢˜æ„
  - if(check(mid))åé¢çš„è¯­å¥ä¸æ˜¯l=midå°±æ˜¯r=midï¼Œä¸å­˜åœ¨l=mid+1è¿™ç§æƒ…å†µã€‚ç­”æ¡ˆåŒ…å«åœ¨è¿™ä¸ªèŒƒå›´å†…
  - 

  

#### lowerBoundã€upperBound

```java
//æ‰¾åˆ°numsä¸­ç¬¬ä¸€ä¸ªå¤§äºxçš„æ•°çš„ä¸‹æ ‡
static int upperBound(int[] nums,int l,int r,int x) {
	while(l<r) {
		int mid = l+r>>1;
		if(nums[mid]>x) r=mid;
		else l = mid +1;
	}
	return l;//è¿™é‡Œè¿”å›çš„nums[l]ä¸ä¸€å®šæ»¡è¶³é¢˜æ„ï¼Œè¿˜éœ€è¦ç‰¹åˆ¤
}
//æ‰¾åˆ°numsä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äºxçš„æ•°çš„ä¸‹æ ‡
static int lowerBound(int[] nums,int l,int r,int x) {
    while(l<r) {
        int mid = l+r>>1;
        if(nums[mid]>=x) r=mid;
        else l = mid +1;
    }
    return l;//è¿™é‡Œè¿”å›çš„nums[l]ä¸ä¸€å®šæ»¡è¶³é¢˜æ„ï¼Œè¿˜éœ€è¦ç‰¹åˆ¤
}
```

#### äºŒåˆ†å¯»æ‰¾å·¦å³è¾¹ç•Œ

```java
//å¯»æ‰¾å‡åºæ•°ç»„arrä¸­[l,r]ä¸­å€¼ä¸ºxçš„å·¦è¾¹ç•Œï¼ˆç¬¬ä¸€ä¸ªxï¼‰ä¸‹æ ‡
static int findLeft(int l,int r,int x) {
    while(l<r) {
        int mid = (l+r)>>1;
        if(arr[mid]>=x) r=mid;
        else l = mid+1;
    }
    return arr[l]==k?l:-1;//return l;
}
//å¯»æ‰¾å‡åºæ•°ç»„arrä¸­[l,r]ä¸­å€¼ä¸ºxçš„å³è¾¹ç•Œï¼ˆæœ€åä¸€ä¸ªxï¼‰ä¸‹æ ‡
static int findRight(int l,int r,int x) {
    while(l<r) {
        int mid = (l+r+1)>>1;
        if(arr[mid]<=x) l=mid;
        else r = mid-1;
    }
    return arr[l]==k?l:-1;//return l;
}
```

ä½œè€…ï¼šweiambt
é“¾æ¥ï¼šhttps://www.acwing.com/activity/content/code/content/5425322/
æ¥æºï¼šAcWing
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

#### äºŒåˆ†çš„ä¼ å‚å†™æ³•

åœ¨ä¸Šé¢çš„lowerBoundã€upperBoundå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æœ€åè¿˜éœ€è¦è‡ªå·±åˆ¤æ–­ä¸€ä¸‹æœ€åä¸€ä¸ªçŠ¶æ€æ˜¯å¦åˆæ³•ï¼Ÿå¦‚æœç”¨å¼€åŒºé—´çš„å†™æ³•æˆ‘ä»¬å°±ä¸éœ€è¦æœ€åç‰¹åˆ¤ã€‚è§ä¸‹æ–‡

æ¯”å¦‚è¦åœ¨[l,r]çš„æ—¶å€™äºŒåˆ†ï¼Œé‚£ä¹ˆæˆ‘åœ¨è°ƒç”¨äºŒåˆ†å‡½æ•°çš„æ—¶å€™ï¼Œæ˜¯è¿™æ ·`lower_bound(l,r)`è°ƒå—ï¼Ÿä¸æ¨èï¼Œæ¨èä½¿ç”¨`lower_bound(l,r+1)`ï¼ˆæ‰¾å³è¾¹ï¼‰æˆ–è€…`lower_bound(l-1,r)`ï¼ˆæ‰¾å·¦è¾¹ï¼‰çš„æ–¹å¼ï¼Œè§ä¸‹æ–‡ã€‚ä¸æ˜¯ç¬¬ä¸€ç§æ–¹å¼ä¸èƒ½åšï¼Œä¹Ÿèƒ½åšï¼Œä½†æ˜¯äºŒåˆ†å®Œè¦è‡ªå·±å†è¿›è¡Œå¤„ç†ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚

- å¯¹äºé—­åŒºé—´çš„ä¼ å‚å†™æ³•ï¼ˆå·¦é—­å³é—­ï¼‰ï¼ŒäºŒåˆ†æ˜¯è¦ä¸€å®šæœ‰ç­”æ¡ˆçš„ï¼Œè¿™é‡Œæˆ‘ä»¬æœ€åè¦è‡ªå·±ç‰¹åˆ¤æœ€åä¸€ä¸ªä½ç½®æ˜¯å¦åˆæ³•ã€‚yæ€»çš„éƒ½æ˜¯è¿™ä¸ªå†™æ³•
- å¯¹äºå¼€åŒºé—´çš„ä¼ å‚å†™æ³•ï¼ˆå·¦é—­å³å¼€ã€å·¦å¼€æœ‰é—­ï¼‰ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç‰¹åˆ¤ï¼Œå› ä¸ºå¼€åŒºé—´çš„é‚£ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯ä¸æ»¡è¶³çš„ä½ç½®ã€‚

ç”¨åº“å‡½æ•°éƒ½æ˜¯å¼€åŒºé—´çš„æ–¹å¼ä¼ å‚ï¼Œå¦‚æœç”¨é—­åŒºé—´çš„æ–¹å¼ä¼ å‚ï¼Œåº“å‡½æ•°æˆ‘ä»¬æ— æ³•åœ¨å‡½æ•°é‡Œåˆ¤æ–­ï¼Œåªèƒ½åœ¨å¤–é¢åˆ¤æ–­ï¼Œæœ€åéœ€è¦è‡ªå·±è½¬åŒ–ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å¦‚æœå›¾æ–¹ä¾¿ï¼Œå¯ä»¥åœ¨æ‰åº“å‡½æ•°çš„æ—¶å€™ç”¨è‡ªå·±å°†é—­åŒºé—´è½¬æˆå¼€åŒºé—´ä¼ å‚ï¼Œæ¯”å¦‚æ‰¾å³è¾¹ï¼Œ[i,n-1]ä¸­æ‰¾ï¼Œè°ƒç”¨åº“å‡½æ•°å°±ä¼ å‚lower_bound(i+1,n)





### æµ®ç‚¹æ•°äºŒåˆ†

æµ®ç‚¹æ•°äºŒåˆ†æ²¡æœ‰è¾¹ç•Œçš„é—®é¢˜ã€ä¹Ÿæ²¡æœ‰å–æ•´çš„é—®é¢˜

ä¾‹å­ï¼šä¸‹é¢æ˜¯äºŒåˆ†è®¡ç®—ä¸‰æ¬¡æ–¹æ ¹

```java
static double find(double l,double r,double x) {
    while(r-l>1e-6) {//ä¿ç•™6ä½å°æ•°ï¼Œå–å†³äºé¢˜ç›®
        double  mid = (l+r)/2;
        if(mid*mid*mid >= x) r = mid;
        else l = mid;//ä¸ç”¨+1
    }
    return l;
}
//ps:æœ€åè¦å¯¹lä¿ç•™å°æ•°æ‰èƒ½çœ‹åˆ°æ­£ç¡®ç­”æ¡ˆ
System.out.printf("%.6f",l);
```



### ç§¦ä¹éŸ¶ç®—æ³•

- å°†nè¿›åˆ¶ä¸‹çš„æ•°xè½¬æ¢æˆ10è¿›åˆ¶ä¸‹çš„æ•°

```java
    //å°†kè¿›åˆ¶ä¸‹çš„æ•°sè½¬æ¢æˆåè¿›åˆ¶æ•°
	static int sum(char[] s,int k) {
        int res = 0;
        for(int i=0;i<s.length;i++) {
            res = res * k + s[i]-'0';
        }
        return res;
    }
```

- æ±‚ç­‰æ¯”æ•°åˆ—æ±‚å’Œï¼ˆOï¼ˆnï¼‰ï¼‰

  ä¾‹å¦‚æ±‚ï¼š1+p^1+p^2+...p^k

### å•è°ƒæ ˆ

- é¢˜ç›®èƒŒæ™¯

  å¯»æ‰¾å·¦è¾¹ï¼ˆå³è¾¹ï¼‰ç¦»ä»–æœ€è¿‘çš„æ¯”å®ƒå¤§/å°çš„æ•°

- åŸç†

  å•è°ƒæ€§ï¼ˆä¸‹ä¾‹æ˜¯æ‰¾æ¯”å®ƒå°çš„å€¼ï¼‰

  ![img](images/image-20210123215048534.png)

- ç®—æ³•

  æ‰¾å·¦è¾¹ç¦»ä»–æœ€è¿‘çš„æ¯”ä»–å°çš„æ•°ï¼šæ ˆä¸­å…ƒç´ å‡åºï¼ˆæ ˆé¡¶å¤§çš„å‡ºæ ˆï¼‰

  æ‰¾å·¦è¾¹ç¦»ä»–æœ€è¿‘çš„æ¯”ä»–å¤§çš„æ•°ï¼šæ ˆä¸­å…ƒç´ é™åºï¼ˆæ ˆé¡¶å°çš„å‡ºæ ˆï¼‰

  å½“æ ˆä¸ºç©ºæ—¶ï¼Œè¡¨ç¤ºæ‰¾ä¸åˆ°æ»¡è¶³è¦æ±‚çš„ï¼Œè®¡ç®—ansï¼Œå°†è¯¥å€¼åŠ å…¥æ ˆä¸­

- æ—¶é—´å¤æ‚åº¦

  Oï¼ˆnï¼‰,æš´åŠ›ç®—æ³•æ˜¯Oï¼ˆn^2ï¼‰

- æ¨¡æ¿ï¼ˆå¯»æ‰¾å·¦è¾¹ç¦»ä»–æœ€è¿‘çš„æ¯”å®ƒå°çš„ï¼‰

  ```c++
  stack<int> st;
  int main(){
      int n;
      cin>>n;
      while(n--){
          int x;
          cin>>x;
          while(st.size() && st.top()>=x) st.pop();
          if(st.size()) cout<<st.top()<<" ";
          else cout<<"-1 ";
          st.push(x);
      }
      return 0;
  }
  ```

  

- ä¾‹é¢˜

  acwing830

  lc901

  lc907. å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œ(å•è°ƒæ ˆ+æ•°å­¦)

### å•è°ƒé˜Ÿåˆ—

æœ‰éš¾åº¦ï¼

- é¢˜ç›®èƒŒæ™¯ï¼šæ»‘åŠ¨çª—å£ï¼Œè®¡ç®—ä¸€ä¸ªå¤§å°ä¸ºkçš„æ»‘åŠ¨çª—å£çš„å®æ—¶çš„æœ€å¤§ï¼ˆæœ€å°ï¼‰å€¼

- æ€è·¯

  å’Œå•è°ƒæ ˆä¸€æ ·ï¼Œéƒ½æ˜¯å…·æœ‰ç›¸åŒçš„å•è°ƒæ€§ï¼Œæ¯”å¦‚ï¼šå½“æ‰¾çª—å£å†…çš„æœ€å°å€¼æ—¶ï¼Œé˜Ÿåˆ—ä¸­æ˜¯ä¿æŒå‡åºçš„ã€‚

  > é‚£ä¹ˆå°±æ˜¯æŠŠé˜Ÿå°¾çš„æ¯”å®ƒå¤§çš„å€¼å…¨éƒ¨å‡ºé˜Ÿ
  >
  > å…·ä½“æ€è·¯ï¼šhttps://www.acwing.com/activity/content/code/content/1134199/

- ä¾‹é¢˜

  acwing154æ»‘åŠ¨çª—å£





## æ•°æ®ç»“æ„

- - -

â€‹      

### å‰ç¼€å’Œ

> å‰ç¼€å’Œå’Œå·®åˆ†æ•°ç»„éƒ½æ˜¯ä»ä¸‹æ ‡1å¼€å§‹

```java
//åˆå§‹åŒ–
sum[i] = sum[i-1] + arr[i];

//æ±‚å’Œarrçš„[a,b]çš„å’Œ
sum[b] - sum[a-1];
```

- ä¸‹æ ‡ä»1å¼€å§‹æ–¹ä¾¿

#### äºŒç»´å‰ç¼€å’Œ

```java
	//1ã€åˆå§‹åŒ–
	for(int i=1;i<=n;i++) 
   	 	for(int j=1;j<=m;j++) {
        	s[i][j] = sc.nextInt();
        	s[i][j] += s[i-1][j]+s[i][j-1]-s[i-1][j-1];
    	}
    
   //2.æ±‚å’Œï¼šæ±‚ï¼ˆx1,y1ï¼‰å’Œ(x2,y2)ä¸­é—´çš„å­çŸ©å½¢çš„å’Œ
   System.out.println(s[x2][y2]-s[x1-1][y2]-s[x2][y1-1]+s[x1-1][y1-1]);
```

- ä¸‹æ ‡ä»1å¼€å§‹æ–¹ä¾¿

### å·®åˆ†

> å‰ç¼€å’Œçš„é€†è¿ç®—

ä½œç”¨ï¼šèƒ½å¤Ÿä»¥Oï¼ˆ1ï¼‰çš„æ—¶é—´ä¿®æ”¹ä¸€ä¸ªåŒºé—´çš„å€¼

åŸæ•°ç»„sumï¼Œå·®åˆ†æ•°ç»„chafen

```java
//åˆå§‹åŒ–
for(int i = 1;i<=n;i++) {
    arr[i] = sc.nextInt();
    chafen[i] = arr[i] - arr[i-1];
}

//æ“ä½œä¸€ï¼šå¯¹äºåŸæ•°ç»„sumä¸­çš„[l,r]ä¸­çš„å€¼+vï¼ˆè¿™æ˜¯ç¦»çº¿æ“ä½œï¼Œå®é™…ä¸Šsumæ²¡æœ‰è¢«æ›´æ–°ï¼‰
static void add(int l,int r,int v){
    chafen[l]+=v;
    chafen[r+1]-=v;
}

//æ“ä½œäºŒï¼šè®¡ç®—æœ€ç»ˆç»“æœï¼ˆæ•°ç»„çš„æœ€ç»ˆå€¼ï¼‰
for(int i=1;i<=n;i++) 
    sum[i] = sum[i-1] + chafen[i];

//å·®åˆ†åŸç†
chafen[i] = sum[i] - sum[i-1]
    
//æœ€ç»ˆæ•°ç»„çš„åŸç†(ä¿®æ”¹ç»“æŸå)
sum[i] = chafen[1] + chafen[2] + ... + chafen[i]

```

- æ€è€ƒ
  - å·®åˆ†æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯aï¼Œåé¢å…ƒç´ å…¨0ï¼šä»£è¡¨åŸæ•°ç»„çš„å€¼éƒ½æ˜¯a
  - ç‰¹æ®Šçš„ï¼Œå·®åˆ†æ•°ç»„ä¸­å…ƒç´ å…¨0ï¼šä»£è¡¨åŸæ•°ç»„å…¨0
  - chafen[i]ä¼šå¯¹sum[i+3]çš„å€¼å½±å“ï¼Œè¦æƒ³æŠŠsum[i+3]é™åˆ°0ï¼Œå°±è¦å…ˆæŠŠchafen[i]é™æˆ0



#### äºŒç»´å·®åˆ†

```java
	åŸç†ï¼šå’ŒäºŒç»´å‰ç¼€å’Œä¸€æ ·çš„å…¬å¼
	
	1.åˆå§‹åŒ–ï¼š
	for(int i=1;i<=n;i++) 
        for(int j=1;j<=m;j++) {
            s[i][j] = sc.nextInt();
            chafen[i][j] = s[i][j] - s[i-1][j] - s[i][j-1] + s[i-1][j-1];
    }
    
    2.åœ¨ï¼ˆx1,y1ï¼‰å’Œ(x2,y2)ä¸­é—´çš„å­çŸ©å½¢ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½åŠ c
                chafen[x1][y1] += c;
                chafen[x1][y2+1] -= c;
                chafen[x2+1][y1] -= c;
                chafen[x2+1][y2+1] += c;
                
    3ã€è®¡ç®—æœ€ç»ˆæ•°ç»„
    for(int i=1;i<=n;i++) {
        for(int j=1;j<=m;j++) {
            s[i][j] = s[i-1][j] + s[i][j-1] - s[i-1][j-1] + chafen[i][j];
            System.out.print(s[i][j]+" ");
        }
        System.out.println();
    }
```



### ç¦»æ•£åŒ–

- å¦‚æœä¸€ä¸ªæ•°ç»„ï¼Œä»–çš„å€¼åŸŸçš„èŒƒå›´å¾ˆå¤§ï¼Œæ¯”å¦‚ä¸Šç•Œå‡ä¸‹ç•Œçš„å€¼å¤§äº1e8ï¼Œä½†æ˜¯æ•°ç»„çš„é•¿åº¦åªæœ‰1e5ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨ç¦»æ•£åŒ–ï¼Œè¿™ç±»é¢˜ç›®éœ€è¦ç”¨æŠŠæ•°ç»„è½¬åŒ–æˆåªä¿ç•™ç›¸å¯¹å…³ç³»çš„ç¦»æ•£åŒ–æ•°ç»„ã€‚

- æ¯”å¦‚ï¼Œarr = {33,88,44,111}ï¼Œå¯ä»¥è½¬æ¢æˆï¼šw = {1,3,2,4};

- æ–¹æ³•å°±æ˜¯å¯¹arræ’åºï¼Œå¹¶ä¿ç•™ä¸‹æ ‡ï¼Œæœ€åæŠŠä¸‹æ ‡ä½ç½®ä¸Šçš„æ•°æ¢æˆæ’å.

- æ­¥éª¤
  - 1.æ’åº
  - 2.å»é‡
  - 3.äºŒåˆ†å¯»æ‰¾

- ä¸¥è°¨æ¨¡ç‰ˆ

  ```java
  	//è®¡ç®—ç¦»æ•£åŒ–æ•°ç»„Oï¼ˆnlognï¼‰
  	static Integer[] solve(int[] t,int sz) {
  		TreeSet<Integer> se = new TreeSet<Integer>();
  		for(int i=1;i<=sz;i++)
  			se.add(t[i]);
          Integer[] order = se.toArray(new Integer[0]);
   		return order;
  	}
  
  	//äºŒåˆ†æ‰¾ç¦»æ•£åçš„å€¼
  	static int find(int x){
  	    int l = 0,r = idx-1;
  	    while(l<r){
  	        int mid = l+r+1>>1;
  	        if(order[mid]<=x) l = mid;
  	        else r = mid-1;
  	    }
  	    return l;
  	}
  
  	//äºŒåˆ†ï¼Œæˆ–è€…ç”¨arr[i]çš„æ—¶å€™æŸ¥ä¸€ä¸‹ç¦»æ•£å€¼
  		find(a[i]);
  ```

  

- ä¸ä¸¥è°¨æ¨¡ç‰ˆæ¨¡æ¿ï¼ˆé€‚ç”¨äºæ‰€æœ‰æ•°éƒ½ä¸åŒçš„æƒ…å†µï¼‰

```java
   //åˆå§‹åŒ–ç»“æ„ä½“æ•°ç»„
    Node[] arr = new Node[N];
    for(int i=1;i<=n;i++){
        arr[i] = new Node(nums[i],i);
    }
    //æ’åº
    Arrays.sort(arr,1,n+1,(a,b)->a.val-b.val);
    //ç”¨æ’åä»£æ›¿å€¼
    for(int i=1;i<=n;i++){
        w[arr[i].id] = i;
    }

    class Node{
        int val,id;//idæ˜¯ä¸‹æ ‡ä½ç½®
        Node(int val,int id){
            this.val = val;
            this.id = id;
        }
    }
```

#### å‰ç¼€å’Œç¦»æ•£åŒ–

> AcWing 802åŒºé—´å’Œï¼šhttps://www.acwing.com/activity/content/code/content/6437889/

æ±‚åŒºé—´å’Œã€‚

ç”¨treemap

- æœ¬é¢˜å°±æ˜¯å‰ç¼€å’Œï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯æ•°æ®èŒƒå›´ï¼Œæ•°ç»„çš„ä¸‹æ ‡æ˜¯-1e9~1e9ï¼Œä¸èƒ½ç”¨è¿ç»­çš„æ•°ç»„å»å­˜å‚¨ï¼Œéœ€è¦ç¦»æ•£åŒ–å­˜å‚¨ï¼Œjavaä¸­ç”¨treemapä½œä¸ºç¦»æ•£åŒ–çš„å‰ç¼€å’Œæ•°ç»„ï¼Œéœ€è¦å¯¹ä¸‹æ ‡æ’åºï¼Œä»è€Œè®¡ç®—å‰ç¼€å’Œã€‚

- è®¡ç®—ketSetæ‹¿åˆ°æ‰€æœ‰çš„keyï¼Œä»è€Œè®¡ç®—å‰ä¸€ä¸ªä½ç½®çš„mapå€¼ï¼Œ

- æ­¤å¤–ï¼Œæ‰€æœ‰çš„æŸ¥è¯¢ä¸‹æ ‡l,rä¹Ÿéœ€è¦åˆå§‹åŒ–åœ¨mapä¸­ï¼Œå¦åˆ™å°±æ— æ³•è®¡ç®—ã€‚è¿™æ ·mapçš„æœ€å¤§å€¼å°±è¦å¼€åˆ°3e5ï¼Œkeysæ•°ç»„è¦è¿™ä¹ˆå¤§

- æŸ¥è¯¢çš„æ—¶å€™ï¼Œéœ€è¦è¿”å›lå‰ä¸€ä¸ªkeyçš„å€¼ï¼Œè€Œä¸æ˜¯ç®€å•çš„l-1ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°treemapçš„apiï¼šlowerEntry(key),å¾—åˆ°å°äºkeyçš„æœ€å¤§çš„keyå¯¹åº”çš„å®ä½“

```
		//è¾“å…¥
		for(int i=1;i<=n;i++) {
            int idx = sc.nextInt();
            int val = sc.nextInt();
            mp.put(idx,mp.getOrDefault(idx, 0)+val);
        }
		//æŸ¥è¯¢çš„åŒºé—´åˆå§‹åŒ–åˆ°mapä¸­
        for(int i=0;i<m;i++) {
            int l = sc.nextInt();
            int r = sc.nextInt();
            q[i][0] = l;q[i][1] = r;
            mp.put(l, mp.getOrDefault(l, 0));
            mp.put(r, mp.getOrDefault(r, 0));
        }
        //æ‹¿åˆ°æ‰€æœ‰ç”¨åˆ°çš„ä¸‹æ ‡
        Integer[] keys =  mp.keySet().toArray(new Integer[1]);
        for(int i=1;i<keys.length;i++) {
            mp.put(keys[i],mp.get(keys[i])+mp.get(keys[i-1]));//å‰ç¼€å’Œ
        }

        for(int i=0;i<m;i++) {
            int l = q[i][0];
            int r = q[i][1];
            if(l==keys[0])
//              System.out.println(mp.ceilingEntry(r).getValue());//å¯ä»¥è¿™ä¹ˆå†™
                System.out.println(mp.get(r));
            else
//              System.out.println(mp.get(r)-mp.get(l-1));//ä¸èƒ½è¿™ä¹ˆå†™ï¼ï¼ï¼
                System.out.println(mp.get(r)-mp.lowerEntry(l).getValue());

        }
```



### å †

å †æ˜¯äºŒå‰æ ‘çš„ç»“æ„ï¼Œæˆ‘ä»¬è¦åˆ©ç”¨å †å®ç°ä»¥ä¸‹äº”ä¸ªæ“ä½œï¼š

1. æ’å…¥ä¸€ä¸ªæ•°
2. æ±‚é›†åˆæœ€å€¼
3. åˆ é™¤æœ€å€¼
4. åˆ é™¤ä»»æ„å…ƒç´ 
5. ä¿®æ”¹ä»»æ„å…ƒç´ 

å‰ä¸‰ä¸ªæ“ä½œå¯ä»¥é‡‡ç”¨STLç›´æ¥å®ç°ï¼Œç„¶è€Œåä¸¤ä¸ªå°±ä¸è¡Œäº†ã€‚

å †åˆ é™¤æœ€åä¸€å±‚ä¹‹åæ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œæˆ‘ä»¬ä»¥å°æ ¹å †ä¸ºä¾‹ã€‚

#### åŒå †æ‰¾ä¸­ä½æ•°

- é¢˜æ„ï¼šP1168 ä¸­ä½æ•°ã€‚ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º *N* çš„éè´Ÿæ•´æ•°åºåˆ— Aï¼Œå¯¹äºå‰å¥‡æ•°é¡¹æ±‚ä¸­ä½æ•°ã€‚

- æ€è·¯é¦–å…ˆè®°å½•ä¸€ä¸ªå˜é‡midï¼Œè®°å½•ç­”æ¡ˆï¼ˆä¸­ä½æ•°ï¼‰ã€‚å»ºç«‹ä¸¤ä¸ªå †ï¼Œä¸€ä¸ªå¤§æ ¹å †ä¸€ä¸ªå°æ ¹å †ï¼Œå¤§æ ¹å †â‰¤midçš„æ•°ï¼Œå°æ ¹å †å­˜ >midçš„çš„æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬å‘å †ä¸­åŠ å…¥å…ƒç´ æ—¶ï¼Œå°±é€šè¿‡ä¸m**i**dçš„æ¯”è¾ƒï¼Œé€‰æ‹©åŠ å…¥å“ªä¸€ä¸ªå †ã€‚ä½†æˆ‘ä»¬åœ¨è¾“å‡ºç­”æ¡ˆå‰éœ€è¦å¯¹midè¿›è¡Œè°ƒæ•´ï¼Œå¦‚æœ**å°æ ¹å †å’Œå¤§æ ¹å †å†…å…ƒç´ ç›¸åŒ**ï¼Œå°±æ— éœ€å¤„ç†ï¼Œæ­¤æ—¶midä»ç„¶æ˜¯å½“å‰çš„ä¸­ä½æ•°ã€‚å¦‚æœä¸¤ä¸ªå †ä¸­å…ƒç´ ä¸ªæ•°ä¸åŒï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚**å…·ä½“æ˜¯æŠŠå…ƒç´ ä¸ªæ•°è¾ƒå¤šçš„å †çš„å †é¡¶ä½œä¸ºmidï¼Œä¸Šä¸€æ¬¡çš„midåŠ å…¥å…ƒç´ è¾ƒå°‘çš„å †ã€‚**

> å‚è€ƒï¼šhttps://www.luogu.com.cn/blog/zy-E/p1168-zhong-wei-shuo





### å­—å…¸æ ‘Tire

ä½œç”¨ï¼šé«˜æ•ˆçš„è¿›è¡Œå­—ç¬¦ä¸²å­˜å‚¨å’ŒæŸ¥è¯¢ï¼ˆä¹Ÿå¯ä»¥ç”¨æ¥å­˜äºŒè¿›åˆ¶ï¼Œå‚è€ƒé¢˜ï¼šæœ€å¤§å¼‚æˆ–å¯¹ï¼‰

- ä¸€æ£µ26å‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„äºŒåå…­ä¸ªå­©å­åˆ†åˆ«ä»£è¡¨æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±æ˜¯>0çš„æ•°ï¼Œä¸å­˜åœ¨å°±æ˜¯0
- æ ¹èŠ‚ç‚¹æ˜¯0ï¼Œå¦‚æœsonæ•°ç»„çš„å€¼æ˜¯0è¡¨ç¤ºè¿™ä¸ªç‚¹ä¸å­˜åœ¨ï¼Œæ¯ä¸€ä¸ªæ–°çš„ç‚¹éƒ½æ˜¯ >= 1ã€‚
- Næ˜¯æ‰€æœ‰å­—ç¬¦ä¸²çš„é•¿åº¦å’Œï¼ˆs1.len + s2.len + ...ï¼‰çš„æœ€å¤§å€¼
- æ—¶é—´å¤æ‚åº¦Oï¼ˆå­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ï¼‰
```java
        static int N = 101000;//æ‰€æœ‰å­—ç¬¦ä¸²çš„é•¿åº¦å’Œï¼ˆs1.len + s2.len + ...ï¼‰çš„æœ€å¤§å€¼
		static int[][] son = new int[N][26];
		//son[i][k] = jè¡¨ç¤ºï¼šèŠ‚ç‚¹içš„ä¸‹ä¸€ä¸ªä½ç½®å­˜æ”¾çš„å­—ç¬¦æ˜¯kçš„èŠ‚ç‚¹ç´¢å¼•æ˜¯j
		static int[] cnt = new int[N];
		static int idx = 0;
		
		//æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²
		static void insert(char[] str) {
			int p=0;//å­—å…¸æ ‘æŒ‡é’ˆï¼Œåˆå§‹æ—¶æŒ‡å‘æ ¹èŠ‚ç‚¹0
			for(int i=0;i<str.length;i++) {
				int u = str[i]-'a';
				if(son[p][u]==0) //å¦‚æœæ˜¯0ï¼Œå°±ä»£è¡¨è¿™ä¸ªèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ª
                    son[p][u]= ++idx;
				p = son[p][u];
			}
			cnt[p]++;
		}
		
		//æŸ¥è¯¢å­—ç¬¦ä¸²strå‡ºç°çš„æ¬¡æ•°
		static int query(char[] str) {
			int p = 0;
			for(int i=0;i<str.length;i++) {
				int u = str[i]-'a';
				if(son[p][u]==0) return 0;
				p = son[p][u];
			}
			return cnt[p];
		}
		å‚è€ƒï¼šhttps://www.acwing.com/activity/content/code/content/725149/
```

### å¹¶æŸ¥é›†

```java
	//å­˜æ”¾çˆ¶èŠ‚ç‚¹ï¼ˆç¥–å…ˆèŠ‚ç‚¹ï¼‰
	static int[] p = new int[N];
	//æ‰¾åˆ°xçš„ç¥–å…ˆèŠ‚ç‚¹ï¼ˆè·¯å¾„å‹ç¼©ï¼‰
	static int find(int x) {
        if(x==p[x]) return x;
        return p[x] = find(p[x]);
    }

	//åˆå§‹åŒ–
	for(int i=1;i<=n;i++) 
        p[i]=i;//æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯æ ¹èŠ‚ç‚¹
	//æ“ä½œ1ï¼šåˆå¹¶
	p[find(a)]=find(b);
	//æ“ä½œ2ï¼šæŸ¥è¯¢
	if(find(a)==find(b))//åœ¨åŒä¸€ä¸ªé›†åˆä¸­
        
```

### åˆ†å—æ€æƒ³

https://www.lanqiao.cn/courses/38752/learning/?id=2690843&compatibility=false

è§£å†³çš„é—®é¢˜ï¼šåŒºé—´ä¿®æ”¹ã€åŒºé—´æ±‚å’Œã€åŒºé—´æ±‚å’Œã€åœ¨çº¿é—®é¢˜ã€æ‡’æ ‡è®°

ç”¨åŒºé—´åˆ†å—çš„æ€æƒ³ï¼Œè¿›è¡Œä¼˜åŒ–çš„ç­–ç•¥ï¼ˆå’Œçº¿æ®µæ ‘ä¸»è¦æ€æƒ³å®Œå…¨ä¸€æ ·ï¼‰ã€‚

åˆ†å—çš„ç¼ºç‚¹æ˜¯æ¸è¿›æ„ä¹‰çš„å¤æ‚åº¦O(n * sqrt(n) )ï¼Œç›¸è¾ƒäºçº¿æ®µæ ‘å’Œæ ‘çŠ¶æ•°ç»„ä¸å¤Ÿå¥½ã€‚

- åˆ†å—å’Œ[çº¿æ®µæ ‘](https://so.csdn.net/so/search?q=çº¿æ®µæ ‘&spm=1001.2101.3001.7020)çš„åŒºåˆ«åœ¨äº
  - **åˆ†å—ç®—æ³•å¯ä»¥ç»´æŠ¤ä¸€äº›çº¿æ®µæ ‘ç»´æŠ¤ä¸äº†çš„ä¸œè¥¿**ï¼Œä¾‹å¦‚å•è°ƒé˜Ÿåˆ—ç­‰ï¼Œ
  - **çº¿æ®µæ ‘èƒ½ç»´æŠ¤çš„ä¸œè¥¿å¿…é¡»èƒ½å¤Ÿè¿›è¡Œä¿¡æ¯åˆå¹¶**ï¼Œè€Œåˆ†å—åˆ™ä¸éœ€è¦ã€‚ 
  - ä¸è¿‡ï¼Œå®ƒä»¬ä¹Ÿæœ‰å…±åŒç‚¹ï¼Œåˆ†å—å’Œçº¿æ®µæ ‘ä¸€æ ·ï¼Œåˆ†å—éœ€è¦æ”¯æŒ**ç±»ä¼¼æ ‡è®°åˆå¹¶**çš„ä¸œè¥¿ã€‚  
  - åˆ†å—çš„æ—¶é—´O(nâˆšn)ï¼Œè€Œçº¿æ®µæ ‘O(nlogn)
  - çº¿æ®µæ ‘æ˜¯é€’å½’å®ç°çš„ï¼Œåˆ†å—æ˜¯å¾ªç¯

![image-20240525145117279](images/image-20240525145117279.png)

æ¨¡æ¿ï¼š

- å•ç‚¹ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢

![image-20240525155236423](images/image-20240525155236423.png)

```
import java.util.Scanner;

public class Main {
  static int N = 101000;
  static long[] a = new long[N];
  static long[] sum = new long[N];
  
  //a[idx]è¡¨ç¤ºåŸæ•°ç»„aä¸‹æ ‡idxçš„å€¼
  //sum[id]è¡¨ç¤ºç»„å·idä¸‹æ‰€æœ‰å…ƒç´ å’Œ
  //zusz è¡¨ç¤ºç»„çš„å¤§å°ï¼šç»„å†…å…ƒç´ ä¸ªæ•°
  //zucnt è¡¨ç¤ºç»„çš„ä¸ªæ•°
  //zuid[idx]è¡¨ç¤ºæ•°ç»„aä¸‹æ ‡idxå¤„å±äºå“ªä¸ªç»„
  //zul[idx]è¡¨ç¤ºæ•°ç»„aä¸‹æ ‡idxå¤„å±äºçš„ç»„çš„å·¦è¾¹ç•Œ
  //zur[idx]è¡¨ç¤ºæ•°ç»„aä¸‹æ ‡idxå¤„å±äºçš„ç»„çš„å³è¾¹ç•Œ
  
  static int[] zuid = new int[N],zul = new int[N], zur = new int[N];
  static int zusz, zucnt;
    static int n,m;

    static void init(){
      zusz = (int)Math.sqrt(n) + 1;
      
      for(int i=1;i <= n;i += zusz){
        zucnt += 1;

        for(int j=i;j<=i+zusz-1;j++){
          sum[zucnt] += a[j];
          zuid[j] = zucnt;
          zul[j] = i;
          zur[j] = Math.min(i+zusz-1,n);
        }
      }
    }
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        
        n = sc.nextInt();
        for(int i=1;i<=n;i++)
          a[i] = sc.nextInt();
        init();
        m = sc.nextInt();
        while(m-->0){
          int op = sc.nextInt();
          int x = sc.nextInt();
          int y = sc.nextInt();
          if(op==1){//å¢åŠ 
            a[x] += y;
            sum[zuid[x]] += y;
          }else{//åŒºé—´æ±‚å’Œ
            long res = 0;
            if(zuid[x] == zuid[y]){//å¦‚æœæ˜¯ä¸€ç»„ï¼Œè¦å•ç‹¬å¤„ç†ï¼Œå¦åˆ™WA
                for(int i = x;i <= y;i++)
                    res += a[i];
            }else{
                for(int i = zuid[x]+1;i < zuid[y];i++)
                    res += sum[i];
                for(int i=x;i<=zur[x];i++)
                    res += a[i];
                for(int i=zul[y];i<=y;i++)
                    res += a[i];
            }
            
            System.out.println(res);
          }
        }
          

    }
}
```

- åŒºé—´ä¿®æ”¹ã€åŒºé—´æ±‚å’Œ

![image-20240525161816931](images/image-20240525161816931.png)

å¤šäº†ä¸€ä¸ªæ‡’æ ‡è®°ï¼ˆæ°¸ä¹…åŒ–æ ‡è®°ï¼Œä¸ä¼šè¢«æ¸…ç©ºï¼‰ï¼Œä½†æ˜¯è¿™é‡Œçš„æ‡’æ ‡è®°æ¯”çº¿æ®µæ ‘ç®€å•ï¼Œæ˜¯é™æ€çš„æ‡’æ ‡è®°ï¼Œä¸ä¼šè¢«æ¸…ç©ºï¼Œå› ä¸ºåˆ†å—æ˜¯å¯ä»¥æ“ä½œ**åŸæ•°ç»„**çš„ï¼Œä¸éœ€è¦åœ¨æ¯ä¸€æ¬¡æŸ¥è¯¢æ—¶æ¢å¤æ‡’æ ‡è®°ï¼Œ

```
import java.util.Scanner;

public class Main {
  static int N = 101000;
  static long[] a = new long[N];
  static long[] sum = new long[N];
  
  //a[idx]è¡¨ç¤ºåŸæ•°ç»„aä¸‹æ ‡idxçš„å€¼
  //sum[gid]è¡¨ç¤ºç»„å·gidä¸‹æ‰€æœ‰å…ƒç´ å’Œ
  //zusz è¡¨ç¤ºç»„çš„å¤§å°ï¼šç»„å†…å…ƒç´ ä¸ªæ•°
  //zucnt è¡¨ç¤ºç»„çš„ä¸ªæ•°
  //zuid[idx]è¡¨ç¤ºæ•°ç»„aä¸‹æ ‡idxå¤„å±äºå“ªä¸ªç»„
  //zul[idx]è¡¨ç¤ºæ•°ç»„aä¸‹æ ‡idxå¤„å±äºçš„ç»„çš„å·¦è¾¹ç•Œ
  //zur[idx]è¡¨ç¤ºæ•°ç»„aä¸‹æ ‡idxå¤„å±äºçš„ç»„çš„å³è¾¹ç•Œ

  //zulazy[gid]è¡¨ç¤ºç»„å·gidçš„æ‡’æ ‡è®°
  
  static int[] zuid = new int[N],zul = new int[N], zur = new int[N],zulazy = new int[N];
  static int zusz, zucnt;
    static int n,m;

    static void init(){
      zusz = (int)Math.sqrt(n) + 1;
      
      for(int i=1;i <= n;i += zusz){
        zucnt += 1;

        for(int j=i;j<=i+zusz-1;j++){
          sum[zucnt] += a[j];
          zuid[j] = zucnt;
          zul[j] = i;
          zur[j] = Math.min(i+zusz-1,n);
        }
      }
    }

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        
        n = sc.nextInt();
        m = sc.nextInt();
        for(int i=1;i<=n;i++)
          a[i] = sc.nextInt();
        init();
        
        while(m-->0){
          int op = sc.nextInt();
          int x = sc.nextInt();
          int y = sc.nextInt();
          if(op==1){//åŒºé—´å¢åŠ 
            int v = sc.nextInt();
            if(zuid[x] == zuid[y]){
                for(int i = x;i <= y;i++){
                  a[i] += v;
                  sum[zuid[i]] += v;
                } 
            }else{
                //å®Œæ•´åŒºé—´åŠ æ ‡è®°
                for(int i = zuid[x]+1;i < zuid[y];i++){
                  sum[i] += zusz * v;
                  zulazy[i] += v;
                }
                //ä¸å®Œæ•´çš„æš´åŠ›åŠ 
                for(int i=x;i<=zur[x];i++){
                  a[i] += v;
                  sum[zuid[i]] += v;
                } 
                for(int i=zul[y];i<=y;i++){
                  a[i] += v;
                  sum[zuid[i]] += v;
                }        
            }

          }else{//åŒºé—´æ±‚å’Œ
            long res = 0;
            if(zuid[x] == zuid[y]){//å¦‚æœæ˜¯ä¸€ç»„ï¼Œè¦å•ç‹¬å¤„ç†ï¼Œå¦åˆ™WA
                for(int i = x;i <= y;i++)
                    res += a[i]+zulazy[zuid[i]];
            }else{
                for(int i = zuid[x]+1;i < zuid[y];i++)
                    res += sum[i];
                for(int i=x;i<=zur[x];i++)
                    res += a[i]+zulazy[zuid[i]];
                for(int i=zul[y];i<=y;i++)
                    res += a[i]+zulazy[zuid[i]];
            }
            
            System.out.println(res);
          }
        }
          

    }
}
```





### æ ‘çŠ¶æ•°ç»„

è§£å†³å“ªäº›é—®é¢˜

- å•ç‚¹ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢
  - æ±‚å’Œ
  - æœ€å¤§å€¼ï¼ˆåªèƒ½æŸ¥å‰ç¼€æœ€å¤§å€¼ï¼Œä¸èƒ½æŸ¥åŒºé—´æœ€å¤§å€¼ï¼‰
- åŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢
  - æ±‚å’Œï¼ˆå·®åˆ†æ ‘çŠ¶æ•°ç»„ï¼‰
- åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢
  - æ±‚å’Œï¼ˆç»´æŠ¤2ä¸ªå·®åˆ†æ ‘çŠ¶æ•°ç»„ï¼‰
- æƒå€¼æ ‘çŠ¶æ•°ç»„
  - lognæ—¶é—´ç»Ÿè®¡æ¯”xå°çš„æ•°çš„ä¸ªæ•°

#### å•ç‚¹ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢

ä¸¤ä¸ªæ“ä½œï¼ˆä¸€ç»´æ•°ç»„ï¼‰

- å•ç‚¹ä¿®æ”¹ï¼šä¿®æ”¹æŸä¸ªä½ç½®ä¸Šçš„æ•°çš„å€¼ï¼šOï¼ˆlognï¼‰
- åŒºé—´æ±‚å’Œï¼šæ±‚ä¸€ä¸ªåŒºé—´å‰ç¼€å’Œï¼šOï¼ˆlognï¼‰

æ ‘çŠ¶æ•°ç»„ï¼š

```
C[x] = sum(x-lowbit(x) , x] #å·¦å¼€å³é—­
```

![1](./img/shuzhuangshuzu.png)

> æ™®é€šå‰ç¼€å’Œè™½ç„¶æ˜¯Oï¼ˆ1ï¼‰çš„ï¼Œä½†æ˜¯ä¸€æ—¦ä¿®æ”¹äº†æŸä¸€ä¸ªå…ƒç´ åï¼Œè®¡ç®—å‰ç¼€å’Œçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯Oï¼ˆnï¼‰äº†
>
> æ™®é€šå‰ç¼€å’Œæ˜¯ç¦»çº¿çš„ï¼Œæ ‘çŠ¶æ•°ç»„æ˜¯åœ¨çº¿çš„ã€‚ï¼ˆæ ‘çŠ¶æ•°ç»„æ˜¯æ ¹æ®ä¸‹æ ‡çš„äºŒè¿›åˆ¶åé¢æœ‰å‡ ä¸ª0è¿›è¡Œåˆ’åˆ†å±‚æ•°çš„ï¼Œæ¯”å¦‚3çš„äºŒè¿›åˆ¶æœ‰0ä¸ª0ï¼Œé‚£ä¹ˆå°±åœ¨æœ€åº•å±‚ï¼‰
>
> â€‹										æ·»åŠ å…ƒç´                         æ±‚å’Œ
>
> æ™®é€šå‰ç¼€å’Œï¼š					Oï¼ˆ1ï¼‰						Oï¼ˆnï¼‰
>
> æ ‘çŠ¶æ•°ç»„ï¼š						Oï¼ˆlognï¼‰                  Oï¼ˆlognï¼‰

**æ¨¡æ¿**

- æ ‘çŠ¶æ•°ç»„ä¸‹æ ‡ä»1å¼€å§‹çš„

```java
	//åŸæ•°ç»„:arr,æ ‘çŠ¶æ•°ç»„ï¼štree,=
 	static int lowbit(int x) {
		return x&-x;
	}
	//åœ¨arr[idx]çš„å€¼æ·»åŠ v
	static void add(int idx,int v) {
        //arr[idx] += v;//å¦‚æœå°†idxå˜æˆv
		for(int i=idx;i<=n;i+=lowbit(i)) 
			tree[i]+=v;
	}
	//è®¡ç®—arr[1~x]çš„å’Œ
	static int sum(int idx) {
		int res = 0;
		for(int i=idx;i>0;i-=lowbit(i)) 
			res += tree[i];
		return res;
	}

	static int query(int l,int r){
        return sum(r)-sum(l-1);
    }

	//åˆå§‹åŒ–,å¦‚æœåˆå§‹æ˜¯0ä¸éœ€è¦åˆå§‹åŒ–
	for(int i=1;i<=n;i++)
		add(i,arr[i]);

	//arr[idx]çš„å€¼æ·»åŠ y
	add(idx,y);

	//è®¡ç®—[x,y]å‰ç¼€å’Œ
	query(x,y)

	//arr[idx]ä¿®æ”¹æˆy
    add(idx,y-arr[idx]);
```

#### æƒå€¼æ ‘çŠ¶æ•°ç»„

- æ ‘çŠ¶æ•°ç»„ä¸‹æ ‡æ˜¯å€¼åŸŸï¼ˆè®¡ç®—å·¦è¾¹å°äºå®ƒçš„æ•°çš„ä¸ªæ•°ï¼‰

- å…³é”®ä¿¡æ¯ï¼š**æ ‘çŠ¶æ•°ç»„çš„query(x)æ“ä½œæ˜¯è®¡ç®—ä¸€ä¸ªå‰ç¼€å’Œï¼Œå¦‚æœä¸‹æ ‡æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ å€¼ï¼Œé‚£ä¹ˆåˆšå¥½å°±å¯ä»¥lognå¾—åˆ°ä¸ªæ•°ã€‚**

- æ€è·¯ï¼šå¯¹äºæ¯ä¸ªarr[i]ï¼Œæ¯æ¬¡éœ€è¦æ±‚å‡ºå·¦è¾¹/å³è¾¹æ¯”å®ƒå°çš„æ•°çš„ä¸ªæ•°ï¼Œç”±äºæ•°ç»„é•¿åº¦çš„é™åˆ¶ï¼Œè€Œå®é™…æ•°ç»„çš„å€¼åŸŸå¾ˆå¤§ï¼Œæ‰€ä»¥è¿™ç§æ€è·¯ä¸€èˆ¬éœ€è¦è¿›è¡Œç¦»æ•£åŒ–å¤„ç†ï¼Œè¿™æ ·å¾—åˆ°çš„æ•°ç»„çš„å€¼åŸŸå°±æ˜¯1<=y<=nï¼Œè¿™æ ·å°±èƒ½æŠŠå€¼åŸŸä½œä¸ºæ ‘çŠ¶æ•°ç»„çš„ä¸‹æ ‡äº†ã€‚å¯¹äºæ ‘çŠ¶æ•°ç»„çš„æ¯ä¸€æ¬¡query,å®é™…ä¸Šæ˜¯è®¡ç®—ä¸€ä¸ªå‰ç¼€å’Œï¼Œæ¯”å¦‚query(x)ï¼Œè¿”å›å€¼å°±æ˜¯1~xä¸­å°äºç­‰äºxçš„æ•°çš„ä¸ªæ•°ã€‚
- ç¦»æ•£åŒ–æ•°ç»„w,ä¿å­˜çš„ç›¸å¯¹å¤§å°å…³ç³»ï¼Œwä¸­å­˜å‚¨çš„æ•°æ˜¯1~nï¼Œè¿™ä¸ªå€¼åŸŸå°±æ˜¯ä½œä¸ºæ ‘çŠ¶æ•°ç»„çš„ä¸‹æ ‡
- æ­¤æ—¶çš„tree[i]=jè®°å½•çš„æ˜¯å€¼ä¸ºiçš„æ•°çš„ä¸ªæ•°ï¼Œæ¯ä¸€æ¬¡query(idx)ï¼Œå®é™…å°±æ˜¯æ‰¾åˆ°å°äºç­‰äºidxçš„æ•°çš„ä¸ªæ•°æ˜¯jï¼ˆè€Œidxåœ¨è¿™é‡Œæ­£å¥½æ˜¯å€¼ï¼‰

æ€è·¯å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/93795692

ä¾‹é¢˜ï¼šlc315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°ï¼ˆæ ‘çŠ¶æ•°ç»„+ç¦»æ•£åŒ–ï¼‰

**åº”ç”¨**

- lc315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°ï¼ˆæ ‘çŠ¶æ•°ç»„+ç¦»æ•£åŒ–ï¼‰
- è®¡ç®—é€†åºå¯¹çš„æ•°é‡ï¼ˆå¯ä»¥ç”¨å½’å¹¶æ’åºã€ä¹Ÿå¯ä»¥ç”¨æ ‘çŠ¶æ•°ç»„ï¼‰ï¼šå€’ç€æ±‚
- AcWing 241. æ¥¼å…°å›¾è…¾
- AcWing 1215. å°æœ‹å‹æ’é˜Ÿï¼ˆç»“è®º+æ ‘çŠ¶æ•°ç»„ï¼‰

#### å·®åˆ†æ ‘çŠ¶æ•°ç»„

> æ ‘çŠ¶æ•°ç»„çš„å˜å½¢

##### åŒºé—´ä¿®æ”¹ã€å•ç‚¹æŸ¥è¯¢

- æ ‘çŠ¶æ•°ç»„ç»´æŠ¤å·®åˆ†æ•°ç»„ï¼šå°†åŸæ•°ç»„aè®¡ç®—å‡ºå·®åˆ†æ•°ç»„bï¼Œæ„å»ºæ ‘çŠ¶æ•°ç»„
  
  - å•ç‚¹æ±‚å’Œï¼šai = b1 + ... + bi
    - åŒºé—´ä¿®æ”¹ï¼šb(l) += x; b(r+1) -= x
  
  - æ€è·¯ï¼šåœ¨æ ‘çŠ¶æ•°ç»„ä¸Šåšå·®åˆ†
  
    - æ¯ä¸€æ¬¡ä¿®æ”¹[l,r]å…ƒç´ +d,ç›¸å½“äº`add(l,d) ,add(r+1,-d)`
    - æ¯ä¸€æ¬¡æŸ¥è¯¢xå¤„å…ƒç´ çš„å€¼ï¼Œç›¸å½“äº`sum(x)`
    - å·®åˆ†æ ‘çŠ¶æ•°ç»„çš„åˆå§‹åŒ–
  
  ```java
            for(int i=1;i<=n;i++) {
    			arr[i] = sc.nextInt();
    			add(i,(int)(arr[i]-arr[i-1]));
    		}
  ```
  

##### åŒºé—´ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢

- æ–¹æ³•

  æ„å»ºä¸€ä¸ªå·®åˆ†æ ‘çŠ¶æ•°ç»„biï¼Œå†æ„å»ºä¸€ä¸ªi * biçš„æ ‘çŠ¶æ•°ç»„
  
- æ€è·¯ï¼šæ¨å…¬å¼

  ![image-20240525170012476](images/image-20240525170012476.png)
  
- æ¨å¯¼è¿‡ç¨‹

  ![å¤‡æ³¨ 2020å¹´7æœˆ25æ—¥.png](images/55909_2458a3c69c-%E5%A4%87%E6%B3%A8-2020%E5%B9%B47%E6%9C%8825%E6%97%A5.png)

- åŒºé—´ä¿®æ”¹ ï¼ˆæ ‘çŠ¶æ•°ç»„ï¼‰

```

  static long[] tree = new long[N],tree2 = new long[N];
  static int n,m;
  static int lowbit(int x){
    return x&-x;
  }
  static void add(long[] tree,int idx,long v ){
    for(int i=idx;i<=n;i+=lowbit(i))
      tree[i] += v;
  }

  static long sum(long[] tree,int idx){
    long res = 0;
    for(int i=idx;i>0;i-=lowbit(i))
      res += tree[i];
    return res;
  }

  //åŸæ•°ç»„ï¼šåŒºé—´ä¿®æ”¹æ“ä½œ
  static void f_add(int l,int r,long v){
    add(tree,l,v);
    add(tree,r+1,-v);
    //i * diæ•°ç»„
    add(tree2,l,(long)l*v);
    add(tree2,r+1,-(long)(r+1)*v);
  }

  //åŸæ•°ç»„ï¼šæŸ¥è¯¢å‰ç¼€æ“ä½œ
  static long f_sum(int idx){
      return (idx+1) * sum(tree,idx) - sum(tree2,idx);
  }
  //åŸæ•°ç»„ï¼šæŸ¥è¯¢åŒºé—´æ“ä½œ
  static long f_query(int l,int r){
    return f_sum(r) - f_sum(l-1);
  }
  
  //åˆå§‹åŒ–
		int pre = 0;
        for(int i=1;i<=n;i++){
          int x = sc.nextInt();
          //å°†å·®åˆ†å€¼æ’å…¥æ ‘çŠ¶æ•°ç»„
          int chafen = x - pre;
          add(tree,i,chafen);
          add(tree2,i,(long)i*chafen);
          pre = x;
        }
```



#### å‰ç¼€æœ€å¤§å€¼

æ ‘çŠ¶æ•°ç»„å…¶å®ä¹Ÿèƒ½ç»´æŠ¤æœ€å¤§å€¼ï¼Œä½†æ˜¯åªèƒ½æ±‚å‰ç¼€çš„æœ€å¤§å€¼ï¼Œä¸èƒ½æ±‚å­åŒºé—´çš„æœ€å¤§å€¼ï¼ˆå› ä¸ºæœ€å¤§å€¼æ²¡æœ‰å‡æ³•ï¼‰

    //æ’å…¥ä¸€ä¸ªæ•°ï¼Œæ›´æ–°æœ€å¤§å€¼
    static void solveMax(int idx,long val) {
        for(int i=idx;i<N;i+=lowbit(i))
            tree[i]= Math.max(tree[i],val);
    }
    
    //è®¡ç®—1~idxä¸­çš„æœ€å¤§å€¼
    static long maxPre(int idx) {
        long res = 0;
        for(int i=idx;i>0;i-=lowbit(i))
            res = Math.max(res, tree[i]);
        return res;
    }
https://www.acwing.com/activity/content/code/content/6538977/

### çº¿æ®µæ ‘

> æ ‘çŠ¶æ•°ç»„çš„æ‰©å±•ï¼Œåº”ç”¨åœºæ™¯è¿œå¤§äºæ ‘çŠ¶æ•°ç»„

![](images/%E7%BA%BF%E6%AE%B5%E6%A0%91.png)

#### å•ç‚¹ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢

æ¿å­å¦‚ä¸‹

```java
	static int[] w = new int[N];//åŸæ•°ç»„
	static Node[] tree = new Node[4*N];//çº¿æ®µæ ‘æ•°ç»„

	//å‘ä¸Šæ›´æ–°ï¼Œæ ¹èŠ‚ç‚¹æ˜¯u
	static void pushup(int u) {
		tree[u].val = tree[u<<1].val + tree[u<<1|1].val;
	}

	//æ„å»ºçº¿æ®µæ ‘å‡½æ•°ï¼Œæ ¹èŠ‚ç‚¹uï¼Œæ„å»ºåŒºé—´[l,r]
	static void build(int u,int l,int r) {
		//å¶å­èŠ‚ç‚¹ç›´æ¥è®°å½•æƒå€¼
		if(l==r) 
			tree[u] = new Node(l, r, w[l]);
		else {
			tree[u] = new Node(l, r, 0);//å€¼å…ˆè®°ä¸º0ï¼Œpushupå†æ›´æ–°
			int mid = l+r>>1;
			build(u<<1, l, mid);//æ„å»ºå·¦å­æ ‘
			build(u<<1|1, mid+1, r);//æ„å»ºå³å­æ ‘
			pushup(u);//å‘ä¸Šæ›´æ–°val
		}
	}

	//å•ç‚¹ä¿®æ”¹ï¼šç»™idxä½ç½®ä¸Šçš„æ•°+vã€‚uä»£è¡¨å½“å‰èŠ‚ç‚¹
	static void modify(int u,int idx,int v) {
		//éå†åˆ°å¶å­èŠ‚ç‚¹å°±æ˜¯å…·ä½“çš„ä½ç½®idx
		if(tree[u].l==tree[u].r)
			tree[u].val += v;
		else {
			//åˆ¤æ–­æ˜¯åœ¨è¯¥èŠ‚ç‚¹uçš„å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ä¸Š
			int mid = tree[u].l + tree[u].r >>1;
			if(idx<=mid) modify(u<<1, idx, v);
			else modify(u<<1|1, idx, v);
			pushup(u);//å‘ä¸Šæ›´æ–°,è¿™é‡Œéå¸¸å®¹æ˜“å¿˜è®°ï¼ï¼ï¼
		}
	}
	
	//è®¡ç®—å½“å‰èŠ‚ç‚¹uä¸‹çš„åœ¨[l,r]èŒƒå›´å†…çš„å’Œï¼Œuä»£è¡¨å½“å‰èŠ‚ç‚¹(é€’å½’çš„æ—¶å€™l,ræ˜¯ä¸å˜çš„)
	static int query(int u,int l,int r) {
		//å¦‚æœåŒºé—´å’Œvalå®Œå…¨åŒ…å«å½“å‰èŠ‚ç‚¹ï¼Œå°±ç›´æ¥åŠ ä¸Š
		if(tree[u].l>=l && tree[u].r<=r) 
			return tree[u].val;
		//å¦åˆ™ï¼Œå½“å‰èŠ‚ç‚¹çš„èŒƒå›´ä¸€åˆ†ä¸ºäºŒ
		int mid = tree[u].l + tree[u].r >>1;
		int sum = 0;//è¿™ä¸ªå‚æ•°æ ¹æ®å…·ä½“é¢˜ç›®å˜åŒ–ï¼Œå¦‚æœæ˜¯æ±‚å’Œè¿™é‡Œå°±æ˜¯sum
		//å¦‚æœå·¦ã€å³åŒºé—´æ»¡è¶³å°±åŠ ä¸Š
		if(l <= mid) sum += query(u<<1,l,r);
		if(r >= mid+1) sum += query(u<<1|1, l, r);
		return sum;
	}
	
	

    static class Node{
        int l,r,val;
        public Node(int l,int r,int val) {
            this.l = l;
            this.r = r;
            this.val = val;
        }
    }

//åˆå§‹åŒ–ï¼š
build(1,1,n);

//æŸ¥è¯¢[a,b]çš„ç»“æœï¼š
query(1,a,b);

//ä¿®æ”¹idxä½ç½®çš„å€¼+v
modify(1,idx,v);
```

ç»†èŠ‚ï¼š

- çº¿æ®µæ ‘æ•°ç»„treeæ˜¯4å€Nçš„åŒºé—´ï¼ˆNæ˜¯åŸæ•°ç»„æœ€å¤§é•¿åº¦ï¼‰
- pushupæ˜¯ç”¨å­èŠ‚ç‚¹çš„ä¿¡æ¯æ›´æ–°çˆ¶èŠ‚ç‚¹çš„ä¿¡æ¯
- buildæ˜¯åˆå§‹åŒ–å‡½æ•°
- queryæ˜¯æŸ¥è¯¢å‡½æ•°ï¼ˆæœ€å®¹æ˜“é”™ï¼‰ï¼Œå‚æ•°lå’Œråœ¨é€’å½’çš„æ—¶å€™éƒ½æ˜¯ä¸å˜çš„ï¼›midæ˜¯å–æ ‘çš„å·¦å³è¾¹ç•Œçš„ä¸­ç‚¹è€Œä¸æ˜¯lå’Œrçš„ä¸­ç‚¹ï¼›é€’å½’çš„å‡ºå£æ˜¯å½“å‰èŠ‚ç‚¹å·²ç»è¢«å®Œå…¨åŒ…å«å°±è¿”å›valï¼Œä¸æ˜¯éå†åˆ°å¶å­èŠ‚ç‚¹ã€‚
- modifyå‡½æ•°çš„midä¹Ÿæ˜¯è®¡ç®—æ ‘èŠ‚ç‚¹çš„ä¸­ç‚¹ï¼Œè€Œä¸æ˜¯lå’Œrçš„ä¸­ç‚¹ï¼›é€’å½’è°ƒç”¨å·¦å³å­æ ‘åä¸€å®šè¦pushup
- ä¸‰ä¸ªæ ¸å¿ƒå‡½æ•°buildï¼Œqueryï¼Œmodifyéƒ½æ˜¯é€’å½’è°ƒç”¨ï¼›åªæœ‰queryæœ‰è¿”å›å€¼ï¼›buildã€modifyéƒ½éœ€è¦pushup



#### å¸¦æ‡’æ ‡è®°çš„çº¿æ®µæ ‘

- åº”ç”¨åœºæ™¯ï¼šåŒºé—´ä¿®æ”¹é—®é¢˜

- æè¿°ï¼šå¦‚æœå½“ä¿®æ”¹çš„ä¸æ˜¯ä¸€ä¸ªç‚¹è€Œæ˜¯ä¸€ä¸ªåŒºé—´çš„æ—¶å€™ï¼Œä½¿ç”¨æ‡’æ ‡è®°èƒ½å¤Ÿä¾ç„¶ä»¥Oï¼ˆlognï¼‰çš„æ—¶é—´è¿›è¡Œã€‚

- æ€è·¯ï¼šä¿®æ”¹[l,r]åŒºé—´å†…çš„æ•°ï¼Œæ¯æ¬¡é€’å½’éå†åˆ°ä¸€ä¸ªèŠ‚ç‚¹åŒºé—´[a,b]ï¼Œå½“è¿™ä¸ªèŠ‚ç‚¹çš„åŒºé—´[a,b]è¢«[l,r]å®Œå…¨è¦†ç›–çš„æ—¶å€™ï¼Œä¸ºäº†èŠ‚çº¦æ€§èƒ½ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠåŠ ä¸Šæ‡’æ ‡è®°ï¼ˆç›¸å½“äºè®°ä¸Šè¿™ç¬”è´¦ï¼‰ï¼Œå¹¶æ›´æ–°valï¼Œç„¶åç›´æ¥è¿”å›ã€‚å¦‚æœåé¢åœ¨è¿›è¡Œä¿®æ”¹/æŸ¥è¯¢çš„æ—¶å€™ï¼Œå…ˆè¿›è¡ŒPushDownï¼ŒæŠŠçˆ¶èŠ‚ç‚¹çš„è´¦ç»™å­©å­ä»¬ç®—æ¸…æ¥šï¼Œå†å»å¯¹å­©å­ä»¬è¿›è¡Œæ“ä½œ

- æ ¸å¿ƒæ€æƒ³

  - valå±æ€§å®æ—¶è®°å½•èŠ‚ç‚¹çš„æœ€æ–°å€¼ï¼Œè€Œæ‡’æ ‡è®°lzæ˜¯è®°å½•åŒºé—´æ‰€æœ‰æ•°éœ€è¦åŠ çš„å€¼ï¼ˆä¸ºäº†ä¸å®Œæ•´åŒºé—´å‡†å¤‡ï¼‰

  - pushDownæ–¹æ³•ï¼Œç”¨çˆ¶èŠ‚ç‚¹æ‡’æ ‡è®°æ›´æ–°å­èŠ‚ç‚¹ã€‚

    - å½“èŠ‚ç‚¹æ˜¯è¢«[l,r]å®Œæ•´çš„è¦†ç›–æ—¶ï¼Œåˆ™åªæ›´æ–°ä¸€ä¸‹æœ€å€¼valå³å¯ï¼Œå¹¶æ›´æ–°æ‡’æ ‡è®°ï¼ŒOï¼ˆ1ï¼‰

    - å½“éœ€è¦ä¿®æ”¹ã€æŸ¥è¯¢å­èŠ‚ç‚¹éƒ¨åˆ†åŒºé—´æ—¶ï¼Œå°†æ‡’æ ‡è®°å‘ä¸‹ä¼ é€’ï¼ˆå¦‚æœæ˜¯åªè¦éƒ¨åˆ†åŒºé—´ï¼Œé‚£ä¹ˆéœ€è¦æŠŠæ¯ä¸ªå€¼éƒ½æ›´æ–°äº†ï¼‰ã€‚Oï¼ˆlognï¼‰

- å®ç°ç»†èŠ‚

  - å•ç‚¹ä¿®æ”¹ä¸åŒºé—´ä¿®æ”¹çš„å®ç°**åŒºåˆ«**

    - Nodeå¤šäº†ä¸€ä¸ªæ‡’æ ‡è®°lz

    - å¤šäº†ä¸€ä¸ªå‡½æ•°pushDown

    - buildå‡½æ•°ä¸å˜ï¼Œåªéœ€è¦Nodeå¢åŠ ä¸€ä½åº¦

    - addå‡½æ•°

      å‡½æ•°å‚æ•°å¢åŠ äº†å·¦å³ä¸‹æ ‡

      å¦‚æœæ˜¯èŠ‚ç‚¹è¢«åŒºé—´å…¨è¦†ç›–ï¼Œå°±æ›´æ–°valå’Œlz

      å¦åˆ™ï¼Œå…ˆpushdownï¼Œå†åˆ†åˆ«æ£€æŸ¥å·¦å³2ä¸ªåŒºé—´ï¼ˆä¹‹å‰æ˜¯åªæ£€æŸ¥ä¸€ä¸ªåŒºé—´ã€ä¸æ˜¯idxäº†ï¼‰

    - queryå‡½æ•°

      å¦‚æœæ˜¯èŠ‚ç‚¹ä¸è¢«åŒºé—´å…¨è¦†ç›–ï¼Œé‚£ä¹ˆå…ˆ pushdown

  - å…³é”®ç‚¹

    - pushDownæ–¹æ³•ï¼šå°†çˆ¶èŠ‚ç‚¹çš„lzç»™2ä¸ªå­èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°å­èŠ‚ç‚¹çš„valï¼Œå› ä¸ºå­èŠ‚ç‚¹çš„valæ²¡æœ‰è¢«çˆ¶èŠ‚ç‚¹çš„lzæ›´æ–°è¿‡ã€‚æœ€åçˆ¶èŠ‚ç‚¹çš„lzç½®ç©º
    - pushDownæ–¹æ³•åœ¨addã€queryä¸­ä½¿ç”¨ï¼Œåœ¨èŠ‚ç‚¹ä¸è¢«å®Œå…¨åŒ…å«çš„æƒ…å†µä¸‹ï¼Œéƒ½éœ€è¦å…ˆè¢«æ‰§è¡Œpushdown
    - addå’Œqueryçš„æ–¹æ³•å‚æ•°ï¼šl,réƒ½æ˜¯ä¸€ç›´ä¼ ä¸‹å»çš„ï¼Œä¸éœ€è¦ä¿®æ”¹

    - pushUpæ–¹æ³•åœ¨buildã€addä¸­ä½¿ç”¨

- æ ¸å¿ƒæ“ä½œï¼š

  ```java
  	//å‘ä¸‹æ›´æ–°ï¼šç”¨çˆ¶èŠ‚ç‚¹çš„çŠ¶æ€æ›´æ–°å­èŠ‚ç‚¹ï¼ŒæŠŠæ‡’æ ‡è®°ç»™å„¿å­èŠ‚ç‚¹
  	//æŠŠçˆ¶äº²çš„è´¦ç»™å„¿å­ç®—æ¸…
  	static void pushDown(int u) {
  	    //ä¼ é€’æ‡’æ ‡è®°
  		tree[u<<1].add += tree[u].add;
  		tree[u<<1|1].add += tree[u].add;
  		//ä¼ é€’æœ€å¤§å€¼
  		tree[u<<1].val += tree[u].add;
  		tree[u<<1|1].val += tree[u].add;
  		tree[u].add = 0;//æ¸…ç©ºçˆ¶èŠ‚ç‚¹çš„æ ‡è®°
  	}
  	    //åŒºé—´ä¿®æ”¹ï¼šå°†[l,r]çš„å€¼éƒ½+val
  	static void modify(int u,int l,int r,int val) {
  	    //å¦‚æœè¿™ä¸ªèŠ‚ç‚¹çš„åŒºé—´è¢«å®Œå…¨è¦†ç›–ï¼Œå°±åŠ ä¸Šæ‡’æ ‡è®°
  		if(tree[u].l>=l && tree[u].r<=r) {
  			tree[u].add += val;
  			tree[u].val += val;
  		}else {//å¦åˆ™ï¼Œä¸è¢«å®Œå…¨è¦†ç›–ï¼Œå…ˆæŠŠè´¦ç®—æ¸…å†ä¿®æ”¹åŒºé—´ï¼Œæœ€åæ›´æ–°åˆ°çˆ¶èŠ‚ç‚¹
  			pushDown(u);
  			int mid = tree[u].l+tree[u].r>>1;
  			if(mid>=l) modify(u<<1,l,r,val);
  			if(mid+1<=r) modify(u<<1|1,l,r,val);
  			pushUp(u);
  		}
  	}
  	
  	//åŒºé—´æ±‚å’Œ
  	static long query(int u,int l,int r) {
  		if(tree[u].l>=l && tree[u].r<=r)
  			return tree[u].val;
  		//å…ˆç®—æ¸…è´¦ï¼Œå†æ±‚å†…éƒ¨çš„å€¼
  		pushDown(u);
  		long mx = INF;
  		int mid = tree[u].l+tree[u].r>>1;
  		if(l<=mid) mx = Math.min(mx,query(u<<1,l,r));
  		if(mid+1<=r) mx = Math.min(mx,query(u<<1|1,l,r));
  		return mx;
  	}
  ```



##### åŒºé—´ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢ï¼ˆæœ€å€¼ï¼‰

å®Œæ•´ä»£ç ï¼š

```java
    class Node{
        int l,r;
        long val;
        long add;//æ‡’æ ‡è®°
        public Node(int l,int r,long val,long add) {
            this.l = l;this.r = r;this.val = val;this.add = add;
        }
    }
	static int[] w = new int[N];
	static Node[] tree = new Node[4*N];
	//å‘ä¸Šæ›´æ–°ï¼šç”¨å­èŠ‚ç‚¹çš„å€¼æ›´æ–°çˆ¶èŠ‚ç‚¹
	static void pushUp(int u) {
		tree[u].val = Math.min(tree[u<<1].val,tree[u<<1|1].val);
	}

	//å‘ä¸‹æ›´æ–°ï¼šç”¨çˆ¶èŠ‚ç‚¹çš„çŠ¶æ€æ›´æ–°å­èŠ‚ç‚¹ï¼ŒæŠŠæ‡’æ ‡è®°ç»™å„¿å­èŠ‚ç‚¹
	//æŠŠçˆ¶äº²çš„è´¦ç»™å„¿å­ç®—æ¸…
	static void pushDown(int u) {
	    //ä¼ é€’æ‡’æ ‡è®°
		tree[u<<1].add += tree[u].add;
		tree[u<<1|1].add += tree[u].add;
		//ä¼ é€’æœ€å¤§å€¼
		tree[u<<1].val += tree[u].add;
		tree[u<<1|1].val += tree[u].add;
		tree[u].add = 0;//æ¸…ç©ºçˆ¶èŠ‚ç‚¹çš„æ ‡è®°
	}
	static void build(int u,int l,int r) {
		if(l==r) {
			tree[u] = new Node(l,r,w[l],0);
		}else {
			tree[u] = new Node(l, r, 0, 0);
			int mid = l+r>>1;
			build(u<<1,l,mid);
			build(u<<1|1,mid+1,r);
			pushUp(u);
		}
	}

    //åŒºé—´ä¿®æ”¹ï¼šå°†[l,r]çš„å€¼éƒ½+val
	static void modify(int u,int l,int r,int val) {
	    //å¦‚æœè¿™ä¸ªèŠ‚ç‚¹çš„åŒºé—´è¢«å®Œå…¨è¦†ç›–ï¼Œå°±åŠ ä¸Šæ‡’æ ‡è®°
		if(tree[u].l>=l && tree[u].r<=r) {
			tree[u].add += val;
			tree[u].val += val;
		}else {//å¦åˆ™ï¼Œä¸è¢«å®Œå…¨è¦†ç›–ï¼Œå…ˆæŠŠè´¦ç®—æ¸…å†ä¿®æ”¹åŒºé—´ï¼Œæœ€åæ›´æ–°åˆ°çˆ¶èŠ‚ç‚¹
			pushDown(u);
			int mid = tree[u].l+tree[u].r>>1;
			if(mid>=l) modify(u<<1,l,r,val);
			if(mid+1<=r) modify(u<<1|1,l,r,val);
			pushUp(u);
		}
	}
	
	//åŒºé—´æ±‚å’Œ
	static long query(int u,int l,int r) {
		if(tree[u].l>=l && tree[u].r<=r)
			return tree[u].val;
		//å…ˆç®—æ¸…è´¦ï¼Œå†æ±‚å†…éƒ¨çš„å€¼
		pushDown(u);
		long mx = INF;
		int mid = tree[u].l+tree[u].r>>1;
		if(l<=mid) mx = Math.min(mx,query(u<<1,l,r));
		if(mid+1<=r) mx = Math.min(mx,query(u<<1|1,l,r));
		return mx;
	}
	//åˆå§‹åŒ–
	build(1,1,n);

	//ä¿®æ”¹[l,r]å†…çš„æ¯ä¸ªæ•°+d
	modify(1, l, r,d);
	
	//æŸ¥è¯¢[l,r]
	query(1, l, n)
				
```

##### åŒºé—´ä¿®æ”¹ã€åŒºé—´æ±‚å’Œï¼ˆæ±‚å’Œï¼‰



```java
class SegTree_lz{
	static int N = 101000;
	static Node[] tree = new Node[4*N];
	
	//å‘ä¸Šæ›´æ–°ï¼šç”¨å­èŠ‚ç‚¹çš„å€¼æ›´æ–°çˆ¶èŠ‚ç‚¹
	static void pushUp(int u) {
		tree[u].val = tree[u<<1].val + tree[u<<1|1].val;
	}
	//å‘ä¸‹æ›´æ–°ï¼šç”¨çˆ¶èŠ‚ç‚¹çš„çŠ¶æ€æ›´æ–°å­èŠ‚ç‚¹ï¼ŒæŠŠæ‡’æ ‡è®°ç»™å„¿å­èŠ‚ç‚¹
	//æŠŠçˆ¶äº²çš„è´¦ç»™å„¿å­ç®—æ¸…
	static void pushDown(int u) {
	    //ä¼ é€’æ‡’æ ‡è®°
		tree[u<<1].add += tree[u].add;
		tree[u<<1|1].add += tree[u].add;
		//ä¼ é€’
		tree[u<<1].val += tree[u].add * (tree[u<<1].r-tree[u<<1].l+1);
		tree[u<<1|1].val += tree[u].add * (tree[u<<1|1].r-tree[u<<1|1].l+1);
		tree[u].add = 0;//æ¸…ç©ºçˆ¶èŠ‚ç‚¹çš„æ ‡è®°
	}
	static void build(int u,int l,int r) {
		if(l==r) {
			tree[u] = new Node(l,r,w[l],0);
		}else {
			tree[u] = new Node(l,r,0,0);
			int mid = l+r>>1;
			build(u<<1,l,mid);
			build(u<<1|1,mid+1,r);
			pushUp(u);
		}
	}

    //åŒºé—´ä¿®æ”¹ï¼šå°†[l,r]çš„å€¼éƒ½+val
	static void modify(int u,int l,int r,int val) {
	    //å¦‚æœè¿™ä¸ªèŠ‚ç‚¹çš„åŒºé—´è¢«å®Œå…¨è¦†ç›–ï¼Œå°±åŠ ä¸Šæ‡’æ ‡è®°
		if(tree[u].l>=l && tree[u].r<=r) {
			tree[u].add += val;
			tree[u].val += val*(tree[u].r-tree[u].l+1);
		}else {//å¦åˆ™ï¼Œä¸è¢«å®Œå…¨è¦†ç›–ï¼Œå…ˆæŠŠè´¦ç®—æ¸…å†ä¿®æ”¹åŒºé—´ï¼Œæœ€åæ›´æ–°åˆ°çˆ¶èŠ‚ç‚¹
			pushDown(u);
			int mid = tree[u].l+tree[u].r>>1;
			if(mid>=l) modify(u<<1,l,r,val);
			if(mid+1<=r) modify(u<<1|1,l,r,val);
			pushUp(u);
		}
	}

	//åŒºé—´æ±‚å’Œ
	static long query(int u,int l,int r) {
		if(tree[u].l>=l && tree[u].r<=r)
			return tree[u].val;
		//å…ˆç®—æ¸…è´¦ï¼Œå†æ±‚å†…éƒ¨çš„å€¼
		pushDown(u);
		long res = 0;
		int mid = tree[u].l+tree[u].r>>1;
		if(l<=mid) res += query(u<<1,l,r);
		if(mid+1<=r) res += query(u<<1|1,l,r);
		return res;
	}
	static class Node{
			int l,r;
			long val;
			long add;//æ‡’æ ‡è®°
			public Node(int l,int r,long val,long add) {
					this.l = l;this.r = r;this.val = val;this.add = add;
			}
	}
}
```

#### æ¿å­

##### æ±‚å’Œ

```java
//å•ç‚¹ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢ï¼šæ±‚å’Œ
class SegTree{
  int[] w;
  Node[] tree;
  int n;

  SegTree(int n,int[] ww){
    this.n = n;
    this.w = ww;
    this.tree = new Node[4*(n+1)];

    build(1,1,n);
  }

  void pushUp(int u){
    tree[u].val = tree[u<<1].val + tree[u<<1|1].val;
  }

  void build(int u,int l,int r){
    if(l==r){
      tree[u] = new Node(l,r,w[l]);
    }else{
      tree[u] = new Node(l,r,w[l]);
      int mid = l+r>>1;
      build(u<<1,l,mid);
      build(u<<1|1,mid+1,r);
      pushUp(u);
    }
  }

  void add(int u,int idx,long val){
    if(tree[u].l == tree[u].r) tree[u].val += val;
    else{
      int mid = tree[u].l + tree[u].r >> 1;
      if(idx<=mid) add(u<<1,idx,val);
      else add(u<<1|1,idx,val);
      pushUp(u);
    }
  }

  long query(int u,int l,int r){
    if(tree[u].l >= l && tree[u].r <= r)
      return tree[u].val;
    else{
      int mid = tree[u].l + tree[u].r >>1;
      int s = 0;
      if(mid >= l) s += query(u<<1,l,r);
      if(mid+1 <= r) s += query(u<<1|1,l,r);
      return s;
    }
  }

  class Node{
    int l,r;
    long val;
    public Node(int l,int r,long val) {
      this.l = l;
      this.r = r;
      this.val = val;
    }
  }
}
```



```java
//åŒºé—´ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢ï¼šæ±‚å’Œ
class SegTree{
  int[] w;
  Node[] tree;
  int n;

  SegTree(int n,int[] ww){
    this.n = n;
    this.w = ww;
    this.tree = new Node[4*(n+1)];

    build(1,1,n);
  }

  void pushUp(int u){
    tree[u].val = tree[u<<1].val + tree[u<<1|1].val;
  }

  void pushDown(int u){
    long lazy = tree[u].lz;
    tree[u<<1].lz += lazy;
    tree[u<<1|1].lz += lazy;
    tree[u<<1].val += lazy * (tree[u<<1].r - tree[u<<1].l+1);
    tree[u<<1|1].val += lazy * (tree[u<<1|1].r - tree[u<<1|1].l+1);
    tree[u].lz = 0;
  }

  void build(int u,int l,int r){
    if(l==r){
      tree[u] = new Node(l,r,w[l],0);
    }else{
      tree[u] = new Node(l,r,0,0);
      int mid = l+r>>1;
      build(u<<1,l,mid);
      build(u<<1|1,mid+1,r);
      pushUp(u);
    }
  }

  void add(int u,int l,int r,long val){
    if(tree[u].l >= l && tree[u].r <= r){
      tree[u].val += val * (tree[u].r - tree[u].l+1);
      tree[u].lz += val;
    }else{
      pushDown(u);
      int mid = tree[u].l + tree[u].r >> 1;
      if(l<=mid) add(u<<1,l,r,val);
      if(mid+1<=r) add(u<<1|1,l,r,val);
      pushUp(u);
    }
  }

  long query(int u,int l,int r){
    if(tree[u].l >= l && tree[u].r <= r)
      return tree[u].val;
    else{
      pushDown(u);
      int mid = tree[u].l + tree[u].r >>1;
      long s = 0;
      if(mid >= l) s += query(u<<1,l,r);
      if(mid+1 <= r) s += query(u<<1|1,l,r);
      return s;
    }
  }

  class Node{
    int l,r;
    long val,lz;
    public Node(int l,int r,long val,long lz) {
      this.l = l;
      this.r = r;
      this.val = val;
      this.lz = lz;
    }
  }
}
```

##### æœ€å¤§å€¼

```java
//å•ç‚¹ä¿®æ”¹ã€åŒºé—´æ±‚å’Œ
class SegTree{
  int[] w;
  Node[] tree;
  int n;
  long INF = Long.MAX_VALUE;

  SegTree(int n,int[] ww){
    this.n = n;
    this.w = ww;
    this.tree = new Node[4*(n+1)];

    build(1,1,n);
  }

  void pushUp(int u){
    tree[u].val = Math.max(tree[u<<1].val,tree[u<<1|1].val);
  }

  void build(int u,int l,int r){
    if(l==r){
      tree[u] = new Node(l,r,w[l]);
    }else{
      tree[u] = new Node(l,r,0);
      int mid = l+r>>1;
      build(u<<1,l,mid);
      build(u<<1|1,mid+1,r);
      pushUp(u);
    }
  }

  void add(int u,int idx,long val){
    if(tree[u].l == tree[u].r) tree[u].val += val;
    else{
      int mid = tree[u].l + tree[u].r >> 1;
      if(idx<=mid) add(u<<1,idx,val);
      else add(u<<1|1,idx,val);
      pushUp(u);
    }
  }

  long query(int u,int l,int r){
    if(tree[u].l >= l && tree[u].r <= r)
      return tree[u].val;
    else{
      int mid = tree[u].l + tree[u].r >>1;
      long ma = -INF;
      if(mid >= l) ma = Math.max(ma,query(u<<1,l,r));
      if(mid+1 <= r) ma = Math.max(ma,query(u<<1|1,l,r));
      return ma;
    }
  }

  class Node{
    int l,r;
    long val;
    public Node(int l,int r,long val) {
      this.l = l;
      this.r = r;
      this.val = val;
    }
  }
}

```



```
//åŒºé—´ä¿®æ”¹ã€åŒºé—´æ±‚å’Œ
```



### åˆ†å—ã€æ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘çš„é€‚ç”¨åœºæ™¯

å°ç»“

- åŒºé—´æŸ¥è¯¢

  - ç¦»çº¿åŒºé—´æŸ¥è¯¢

    - æ±‚å’Œï¼š

      å‰ç¼€å’Œã€STè¡¨

    - æœ€å€¼ã€GCD

      STè¡¨

  - åœ¨çº¿åŒºé—´æŸ¥è¯¢

    - æ±‚å’Œ

      æ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘ã€åˆ†å—

    - æœ€å€¼ã€GCD

      çº¿æ®µæ ‘ã€åˆ†å—

- å‰ç¼€æŸ¥è¯¢

  - ç¦»çº¿

    - æ±‚å’Œã€æœ€å€¼ã€GCD

      å‰ç¼€å’Œã€å‰ç¼€æœ€å€¼ã€å‰ç¼€GCD

  - åœ¨çº¿

    - æ±‚å’Œã€æœ€å€¼ã€

      æ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘ã€åˆ†å—
      
    - GCD
    
      ?





### STè¡¨

ST è¡¨æ˜¯ç”¨äºè§£å†³ **å¯é‡å¤è´¡çŒ®é—®é¢˜** çš„æ•°æ®ç»“æ„ã€‚RMQé—®é¢˜ä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å¤è´¡çŒ®é—®é¢˜

> RMQ æ˜¯è‹±æ–‡ Range Maximum/Minimum Query çš„ç¼©å†™ï¼Œè¡¨ç¤ºåŒºé—´æœ€å¤§ï¼ˆæœ€å°ï¼‰å€¼ã€‚è§£å†³ RMQ é—®é¢˜æœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ [RMQ ä¸“é¢˜](https://oi-wiki.org/topic/rmq/)ã€‚

ST è¡¨åŸºäº [å€å¢](https://oi-wiki.org/basic/binary-lifting/) æ€æƒ³ï¼Œå¯ä»¥åšåˆ°Oï¼ˆnlognï¼‰é¢„å¤„ç†ï¼Œ![\Theta(1)](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)Oï¼ˆ1ï¼‰ å›ç­”æ¯ä¸ªè¯¢é—®ã€‚

> æ¨¡æ¿é¢˜ï¼ˆhttps://www.luogu.com.cn/problem/P3865
>
> é¢˜ç›®å¤§æ„ï¼šç»™å®šnä¸ªæ•°ï¼Œæœ‰mä¸ªè¯¢é—®ï¼Œå¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œä½ éœ€è¦å›ç­”åŒºé—´[l,r]ä¸­çš„æœ€å¤§å€¼ã€‚
>
> è€ƒè™‘æš´åŠ›åšæ³•ã€‚æ¯æ¬¡éƒ½å¯¹åŒºé—´[l,r]æ‰«æä¸€éï¼Œæ±‚å‡ºæœ€å¤§å€¼ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªç®—æ³•ä¼šè¶…æ—¶ã€‚
>
> å¦‚æœç”¨çº¿æ®µæ ‘ï¼Œä¹Ÿè¡Œï¼Œä½†æ˜¯å¤§æå°ç”¨äº†ï¼Œå› ä¸ºæ˜¯æ±‚é™æ€çš„

- åˆå§‹åŒ–

  é¦–å…ˆä½ åº”è¯¥çŸ¥é“çš„æ˜¯ï¼ŒSTè¡¨æ˜¯åˆ©ç”¨å€å¢æ€æƒ³æ¥ç¼©çŸ­æ—¶é—´çš„ã€‚è€Œå€å¢å°±ä½“ç°åœ¨ä»–æ•°ç»„çš„å®šä¹‰ä¸­ï¼šå¯¹äºğ‘“[ğ‘–][ğ‘—]*f*[*i*][*j*]ï¼ŒæŒ‡çš„æ˜¯åœ¨åºåˆ—çš„ç¬¬ié¡¹ï¼Œ**å‘å2^ğ‘—ä¸ªå…ƒç´ æ‰€åŒ…å«åºåˆ—é—´çš„æœ€å¤§å€¼**ã€‚å…·ä½“çš„ï¼Œ`f[i][j]è¡¨ç¤ºä»èŠ‚ç‚¹iå¼€å§‹å‘å³2^jä¸ªå…ƒç´ çš„åŒºé—´çš„æœ€å€¼,f[i][j]è¡¨ç¤ºåŒºé—´[i,i+2^j-1]çš„æœ€å¤§å€¼`

  ![image-20240508203924355](images/image-20240508203924355.png)

- åŒºé—´æ±‚å€¼

  ![image-20240508203957771](images/image-20240508203957771.png)

- STè¡¨æ¨¡æ¿

	```
	static int[] arr = new int[N];
	
	//f[i][j]è¡¨ç¤ºä»èŠ‚ç‚¹iå¼€å§‹å‘å³2^jä¸ªå…ƒç´ çš„åŒºé—´çš„æœ€å€¼ï¼šåŒºé—´[i,i+2^j-1]
	static int[][] f = new int[N][M];
	
	//åˆå§‹åŒ–stè¡¨ï¼ŒOï¼ˆnlognï¼‰
	static void init() {
		//é•¿åº¦æ˜¯1çš„åŒºé—´å°±æ˜¯æœ¬èº«
		for(int i=1;i<=n;i++)
			f[i][0] = arr[i];
		//åˆ†æˆä¸¤ä¸ªå­åŒºé—´
		for(int j=1;j<M;j++) 
			for(int i=1;i+(1<<j)-1 <= n;i++) 
				f[i][j] = Math.max(f[i][j-1],f[i+(1<<(j-1))][j-1]);
	}
	
	//æŸ¥è¯¢stè¡¨ï¼ŒOï¼ˆ1ï¼‰
	static int query(int l,int r) {
		//è®¡ç®—åŒºé—´[l,r]çš„æœ€å¤§2çš„å¹‚è·¨åº¦ï¼ˆl+2^k-1 <= rï¼‰
		int k = (int) (Math.log(r-l+1)/Math.log(2));
		//åˆ†ä¸ºä¸¤ä¸ªå­åŒºé—´
		int res = Math.max(f[l][k],f[r-(1<<k)+1][k]);
		return res;
	}
	```
	
	

> psï¼šlog(2,n)å¯ä»¥ç”¨é€’æ¨å¼ä¼˜åŒ–ï¼Œä»è€Œè¾¾åˆ°O(1)æŸ¥è¯¢
>
> log (2,n) = log(2,n/2) + 1
>
> ![image-20240508204247802](images/image-20240508204247802.png)

- stè¡¨çš„åº”ç”¨

  é™¤ RMQ ä»¥å¤–ï¼Œè¿˜æœ‰å…¶å®ƒçš„ã€Œå¯é‡å¤è´¡çŒ®é—®é¢˜ã€ã€‚ä¾‹å¦‚ã€ŒåŒºé—´æŒ‰ä½ä¸ã€ã€ã€ŒåŒºé—´æŒ‰ä½æˆ–ã€ã€ã€ŒåŒºé—´ GCDã€ï¼ŒST è¡¨éƒ½èƒ½é«˜æ•ˆåœ°è§£å†³ã€‚

  å¦‚æœåˆ†æä¸€ä¸‹ï¼Œã€Œå¯é‡å¤è´¡çŒ®é—®é¢˜ã€ä¸€èˆ¬éƒ½å¸¦æœ‰æŸç§ç±»ä¼¼ RMQ çš„æˆåˆ†ã€‚ä¾‹å¦‚ã€ŒåŒºé—´æŒ‰ä½ä¸ã€å°±æ˜¯æ¯ä¸€ä½å–æœ€å°å€¼ï¼Œè€Œã€ŒåŒºé—´ GCDã€åˆ™æ˜¯æ¯ä¸€ä¸ªè´¨å› æ•°çš„æŒ‡æ•°å–æœ€å°å€¼ã€‚

- ä¾‹é¢˜

  é€‰ç‰›ï¼šhttps://www.luogu.com.cn/record/158444125

  é™é›¨é‡ï¼šhttps://www.luogu.com.cn/problem/P2471

> åŸºäºSTè¡¨å€å¢çš„æ€æƒ³è¿˜æœ‰æœ€è¿‘å…¬å…±ç¥–å…ˆçŸ¥è¯†ç‚¹ï¼ˆå›¾è®ºç« èŠ‚ï¼‰





## å­—ç¬¦ä¸²



### KMP

åˆ¤æ–­æ¨¡å¼ä¸²ï¼ˆpï¼‰æ˜¯ä¸æ˜¯ä¸»ä¸²ï¼ˆsï¼‰çš„å­ä¸²ï¼Œè¿”å›ä¸»ä¸²ä¸­å‡ºç°å­ä¸²çš„ä¸‹æ ‡

> ä¹Ÿå¯ä»¥ç”¨å­—ç¬¦ä¸²å“ˆå¸Œ

æ—¶é—´å¤æ‚åº¦Oï¼ˆnï¼‰

```java
static char[] p,s;//pæ˜¯æ¨¡å¼ä¸²ï¼Œsæ˜¯ä¸»ä¸²
static int[] ne = new int[N];//pçš„nextæ•°ç»„,ne[i]=jè¡¨ç¤ºç›¸ç­‰çš„å‰åç¼€æœ€å¤§é•¿åº¦
//næ˜¯æ¨¡å¼ä¸²çš„é•¿åº¦ï¼Œmæ˜¯ä¸»ä¸²çš„é•¿åº¦ã€‚

//1.è®¡ç®—æ¨¡å¼ä¸²pçš„nextæ•°ç»„ï¼ˆèƒŒè¿‡ï¼‰
static void getNext() {
    for(int i=2,j=0;i<=n;i++) {
        while(j>0 && p[i]!=p[j+1]) 
            j=ne[j];
        if(p[i]==p[j+1])
            j++;
        ne[i] = j;
    }
}

//2.kmpåŒ¹é…
for(int i=1,j=0;i<=m;i++) {
    while(j>0 && s[i]!=p[j+1])
        j=ne[j];
    if(s[i]==p[j+1]) j++;
    if(j==n) {//åŒ¹é…æˆåŠŸ
        out.print(i-n+1+" ");//ä¸‹æ ‡ä»1å¼€å§‹
        j = ne[j];//è®¡ç®—åé¢æ˜¯å¦è¿˜æœ‰å­ä¸²p
    }
}
```

å…³é”®ç‚¹ï¼š

- æ¨¡å¼ä¸²pï¼Œä¸»ä¸²sã€‚å­—ç¬¦ä¸²ä¸‹æ ‡éƒ½æ˜¯ä»1å¼€å§‹ã€‚næ˜¯pçš„é•¿åº¦ï¼Œmæ˜¯sçš„é•¿åº¦ã€‚
- æŒ‡é’ˆiæŒ‡å‘ä¸»ä¸²ï¼ŒæŒ‡é’ˆjæŒ‡å‘æ¨¡å¼ä¸²ï¼Œ**æ¯ä¸€è½®æ˜¯å°†iä¸j+1çš„ä½ç½®æ¯”è¾ƒ**ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œjå°±å›é€€åˆ°ne[j]
- å¦‚æœiå’Œj+1ä½ç½®ç›¸åŒï¼Œé‚£ä¹ˆå°±j++
- ä¸ºä»€ä¹ˆæ˜¯j+1å’Œiçš„ä½ç½®æ¯”è¾ƒï¼Ÿï¼Ÿï¼Ÿå› ä¸ºä¸€æ—¦æ‰¾åˆ°ä¸ç¬¦åˆçš„ï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰¾å‰ä¸€ä½å‰é¢çš„å­ä¸²çš„nextæ•°ç»„

### å­—ç¬¦ä¸²å“ˆå¸Œ

åº”ç”¨åœºæ™¯ï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¿«é€Ÿåˆ¤æ–­è¿™ä¸ªå­ä¸²çš„ä¸¤ä¸ªå­ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œæ—¶é—´å¤æ‚åº¦Oï¼ˆ1ï¼‰

> æ­£å¸¸ç”¨substring()ï¼Œæœ€åä¼šè¾¾åˆ°Oï¼ˆnï¼‰

- å‰ç¼€å’Œæ€æƒ³
- æŠŠä¸€ä¸ªå­—ç¬¦ä¸²æ˜ å°„æˆä¸€ä¸ªæ•°ï¼Œhash[i]å­˜æ”¾å‰ç¼€å­—ç¬¦ä¸²str[1~i]çš„hashå€¼
- åˆå§‹åŒ–ï¼šhash[i] = hash[i-1]*P + str[i]
- è®¡ç®—å­ä¸²str[l~R]çš„å“ˆå¸Œå€¼ = hash[r] - hash[l-1]*pow(P,r-l+1).ç”»å›¾å°±èƒ½æ¨å‡ºæ¥

![image-20240508162531965](images/image-20240508162531965.png)

```java
	static char[] str = new char[N];
	static int[] hash = new int[N],pow = new int[N];
	static int P = 131;//ç»éªŒå€¼
	
	//åˆå§‹åŒ–
	pow[0]=1;
	hash[0]=0;
	for(int i=1;i<=n;i++) {
		hash[i] = hash[i-1]*P + str[i];
		pow[i] = pow[i-1]*P;//é¢„å¤„ç†æ¬¡æ–¹
	}
	
	//è®¡ç®—å­ä¸²çš„å“ˆå¸Œå€¼
	static int query(int l,int r) {
		return hash[r] - hash[l-1]*pow[r-l+1];
	}

```

#### å­—ç¬¦ä¸²å“ˆå¸Œåˆ¤æ–­å›æ–‡å­ä¸²

ç”¨äºŒåˆ†ç­”æ¡ˆ+å­—ç¬¦ä¸²å“ˆå¸Œå¹³æ›¿ã€‚ï¼ˆåˆ¤æ–­æ˜¯å¦å¯è¡Œæ—¶æšä¸¾å›æ–‡ä¸­å¿ƒï¼ˆå¯¹ç§°è½´ï¼‰ï¼Œå“ˆå¸Œåˆ¤æ–­ä¸¤ä¾§æ˜¯å¦ç›¸ç­‰ã€‚éœ€è¦åˆ†åˆ«é¢„å¤„ç†æ­£ç€å’Œå€’ç€çš„å“ˆå¸Œå€¼ï¼‰

### å…è®¸ ![k](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7) kæ¬¡å¤±é…çš„å­—ç¬¦ä¸²åŒ¹é…

![image-20240508164033297](images/image-20240508164033297.png)

äºŒåˆ†ä½ç½®mid,ç„¶åcheck a[1~mid]å’Œb[1~mid]çš„å“ˆå¸Œå€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œå°±è¡¨ç¤ºå·¦è¾¹æ²¡æœ‰ä¸ä¸€æ ·çš„å€¼ï¼Œå°±å³åŒºé—´

![image-20240508164243881](images/image-20240508164243881.png)

### é©¬æ‹‰è½¦ç®—æ³•

ä»¥Oï¼ˆnï¼‰æ—¶é—´æ‰¾åˆ°æœ€é•¿**å›æ–‡å­ä¸²**çš„é•¿åº¦ã€‚

```

```



- è¿™ä¸ªç®—æ³•å¯ä»¥ç”¨äºŒåˆ†ç­”æ¡ˆ+å­—ç¬¦ä¸²å“ˆå¸Œå¹³æ›¿ã€‚ï¼ˆåˆ¤æ–­æ˜¯å¦å¯è¡Œæ—¶æšä¸¾å›æ–‡ä¸­å¿ƒï¼ˆå¯¹ç§°è½´ï¼‰ï¼Œå“ˆå¸Œåˆ¤æ–­ä¸¤ä¾§æ˜¯å¦ç›¸ç­‰ã€‚éœ€è¦åˆ†åˆ«é¢„å¤„ç†æ­£ç€å’Œå€’ç€çš„å“ˆå¸Œå€¼ï¼‰



## æ•°å­¦

https://www.acwing.com/blog/content/681/

### åˆ¤æ–­è´¨æ•°ï¼ˆè¯•é™¤æ³•ï¼‰

æ—¶é—´å¤æ‚åº¦Oï¼ˆsqrt(n)ï¼‰

```java
static int is_prime(int n){
        if(n<2) return 0;
        for (int i=2;i<=n/i;i++){
            if(n%i==0) return 0;
        }
        return 1;
}
```

### è´¨å› æ•°åˆ†è§£

æ—¶é—´å¤æ‚åº¦Oï¼ˆsqrt(n)ï¼‰

- ç”¨treemapå­˜å‚¨
- æšä¸¾2~æ ¹å·n
- æœ€å¤šåªæœ‰ä¸€ä¸ªå¤§äºæ ¹å·nçš„è´¨å› å­kï¼Œå¹¶ä¸”è¿™ä¸ªå¤§äºæ ¹å·nçš„è´¨å› å­kçš„å¹‚ä¸€å®šæ˜¯1ã€‚ï¼ˆåè¯æ³•ï¼šå‚è€ƒ[è¯æ˜](https://blog.csdn.net/Supreme7/article/details/129336166?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22129336166%22%2C%22source%22%3A%22Supreme7%22%7D)ï¼‰

```java
static Map<Integer,Integer> mp = new TreeMap<>();//TreeMapæœ‰åº
static void divide(int n){
    for(int i=2;i<=n/i;i++){
        int cnt = 0;//javaé‡Œä¸èƒ½mp[i]++ï¼Œæ‰€ä»¥ç”¨å˜é‡cntå­˜å‚¨ï¼Œå†èµ‹å€¼
        while(n%i==0){
            n/=i;
            cnt++;
        }
        mp.put(i,cnt);
    }
    if(n>1) mp.put(n,1);
}
//è¾“å‡º
for(Integer key:mp.keySet()){
    int val = mp.get(key);
    if(val>0)
        System.out.println(key+" "+mp.get(key));
}
```



### æ±‚å› å­ï¼ˆçº¦æ•°ï¼‰

æ—¶é—´å¤æ‚åº¦ sqrt(nï¼‰

```java
	static ArrayList<Integer> yue = new ArrayList<>();   
	static void solve(int n){
        for (int i = 1; i <= n/i; i++) {
            if(n%i==0){
                yue.add(i);
                if(n/i!=i)
                    yue.add(n/i);
            }
        }
        Collections.sort(yue);//çº¦æ•°ä»å°åˆ°è¾¾æ’
    }
```

### çº¦æ•°ä¹‹å’Œã€çº¦æ•°ä¸ªæ•°

```
å¦‚æœ N = p1^c1 * p2^c2 * ... *pk^ck
çº¦æ•°ä¸ªæ•°ï¼š (c1 + 1) * (c2 + 1) * ... * (ck + 1)
çº¦æ•°ä¹‹å’Œï¼š (p1^0 + p1^1 + ... + p1^c1) * ... * (pk^0 + pk^1 + ... + pk^ck)
```



### ç´ æ•°ç­›

æ±‚nä»¥å†…çš„æ‰€æœ‰ç´ æ•°

#### 1.åŸƒæ°ç­›æ³•ï¼ˆé€‚åˆæ±‚æ¯ä¸€ä¸ªç´ æ•°ï¼‰ï¼ˆæ¨èï¼‰

æ—¶é—´å¤æ‚åº¦ï¼ˆOï¼ˆnlognï¼‰ï¼‰

- æšä¸¾næ¬¡
- å°†ç´ æ•°çš„æ‰€æœ‰å€æ•°ç­›æ‰

```java
static int[] st;
static int[] primes;
static int cnt;

void get_primes(int n){
    for(int i=2;i<=n;i++){
        if(st[i]==0){
            primes[cnt++]=i;
            for(int j=i+i;j<=n;j+=i)
                st[j]=1;
        }
    }
    //æ±‚ç´ æ•°ä¸ªæ•°
    cnt	
}
```

#### 2.ä¼˜åŒ–çš„åŸƒæ°ç­›æ³•ï¼ˆä¸é€‚åˆæ±‚æ¯ä¸€ä¸ªç´ æ•°ï¼‰

æ—¶é—´å¤æ‚åº¦ï¼ˆOï¼ˆnloglognï¼‰ï¼‰

- æšä¸¾æ ¹å·næ¬¡
- è¿˜æ˜¯ç­›è´¨æ•°çš„å€æ•°ï¼Œä½†æ˜¯æ˜¯ä»i*iå¼€å§‹ç­›ï¼Œå› ä¸ºæ¯”i * iå°çš„æ•°å·²ç»è¢«å‰é¢çš„æ™’è¿‡äº†

```java
void getPrimes(int n){
    for(int i=2;i<=n/i;i++){//æ ¹å·næ¬¡
        if(st[i]==0){
            for(int j=i*i;j<=n;j+=i)//i*iå¼€å§‹
                st[j]=1;
        }
    }
    //æ±‚ç´ æ•°ä¸ªæ•°
    for(int i=2;i<=n;i++) 
        if(st[i]==0) ans++;
    //æ±‚æ¯ä¸€ä¸ªç´ æ•°
    // for(int i=2;i<=n;i++)
    //     if(st[i]==0) primes[cnt++]=i;
}
```


#### 3.çº¿æ€§ç­›ï¼ˆæ€§èƒ½æœ€å¥½ï¼‰
```java
void get_primes(int n)
{
    for (int i = 2; i <= n; i ++ )
    {
        if (!st[i]) primes[cnt ++ ] = i;
        for (int j = 0; primes[j] <= n / i; j ++ )
        {
            st[primes[j] * i] = true;
            if (i % primes[j] == 0) break;
        }
    }
}
```



### æ±‚ç»„åˆæ•°

æ±‚Cï¼ˆa,bï¼‰

ç”¨longå­˜ï¼ï¼ï¼

- N åœ¨3000ä»¥å†…ï¼ˆé¢˜æ„ä¸ç”¨å–æ¨¡ï¼‰

```java
    static long[][] C = new long[N][N];
    static void init(){
        for (int i = 0; i < N; i++) {
            for (int j = 0; j <= i; j++) {
                if(j==0) C[i][j] = 1;
                else C[i][j] = C[i-1][j] + C[i-1][j-1];
                //å¯¹äºè¦å¯¹ç­”æ¡ˆå–æ¨¡çš„æ—¶å€™ï¼Œåœ¨è®¡ç®—ç»„åˆæ•°çš„æ—¶å€™å°±è¦å–æ¨¡
                //else C[i][j] = (C[i-1][j] + C[i-1][j-1])%Mod;
            }
        }
    }
```

- Nåœ¨10^8ä»¥å†…ã€é¢˜ç›®è¯´è¦å–æ¨¡ï¼ˆç”¨é€†å…ƒæ±‚ï¼‰

  `C(a,b) = a!/(b! * (a-b)!) = a! * niyuan(b!) * niyuan((a-b)!)`

  ç”±äºè¯¢é—®æ¯”è¾ƒå¤šï¼Œç›´æ¥åˆå§‹åŒ–é˜¶ä¹˜å’Œé˜¶ä¹˜çš„é€†å…ƒæ•°ç»„

  é€’æ¨å¼ï¼š
  `n! = (n-1)! * n`
  `1/(n!) = 1/(n-1)! * 1/n`,å…¶ä¸­`1/n = qpow(n,Mod-2)`(è´¹é©¬å°å®šç†)

```java
    //jiechen[i] = i!
    static long[] jiechen = new long[N];
    //jiechenniyuan[i] = â€œi!çš„é€†å…ƒâ€
    static long[] jiechenniyuan = new long[N];

	//åˆå§‹åŒ–é˜¶ä¹˜ã€é˜¶ä¹˜çš„é€†å…ƒ
	static void init() {
		jiechen[0] = 1;
		jiechenniyuan[0] = 1;
		for(int i=1;i<N;i++) {
			jiechen[i] = jiechen[i-1] * i%Mod;
			jiechenniyuan[i] = jiechenniyuan[i-1] * qpow(i, Mod-2)%Mod;
		}
	}
	//C(a,b) = a!/(b! * (a-b)!) = a! * niyuan(b!) * niyuan((a-b)!)
	static long C(int a,int b) {
		long res = 1;
		res = res * jiechen[a]%Mod;
		res = res * jiechenniyuan[b]%Mod;
		res = res * jiechenniyuan[a-b]%Mod;
		return res;
	}
https://www.acwing.com/activity/content/code/content/5904493/
```

> å¦‚æœé¢˜ç›®é‡Œé¢æ²¡æœ‰è¯´è¦å¯¹ç»„åˆæ•°å–æ¨¡ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•ä¸èƒ½ä½¿ç”¨ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼



### åˆ¤æ–­å…¶ä»–ç‚¹æ˜¯å¦åœ¨åŒä¸€æ¡ç›´çº¿ä¸Š

> å·²çŸ¥ä¸¤ä¸ªç‚¹ï¼ˆx0,y0ï¼‰(x1,y1)ä»è€Œå¯ä»¥ç¡®å®šä¸€æ¡ç›´çº¿ï¼Œå†å»åˆ¤æ–­ä¸€ä¸ªç‚¹ï¼ˆx,yï¼‰æ˜¯å¦åœ¨è¿™æ¡ç›´çº¿ä¸Šé¢ï¼Œæœ‰å¦‚ä¸‹å…¬å¼ã€‚ç”¨çš„æ˜¯ç›´çº¿çš„ä¸€èˆ¬å½¢å¼ã€‚

ç”±äºé™¤æ³•ä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ç›´çº¿çš„ä¸€èˆ¬å½¢å¼ï¼š$(Y-y0)/(X-x0) = (y1-y0)/(x1-x0)$ï¼ŒåŒ–ç®€å¾— $(Y-y0) * (x1-x0) == (X-x0) = (y1-y0)$,æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­è¿™ä¸ªä¸œè¥¿æ˜¯ä¸æ˜¯ç›¸ç­‰å³å¯åˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€æ¡ç›´çº¿ä¸Š

- ä¾‹å­ï¼šx0,y0å›ºå®šï¼Œç»Ÿè®¡ç»è¿‡ï¼ˆx0,y0ï¼‰çš„æ‰€æœ‰ç›´çº¿ä¸­ï¼Œè‡³å°‘éœ€è¦å¤šå°‘æ ¹ç›´çº¿èƒ½å¤ŸæŠŠæ‰€æœ‰ç»™å®šçš„ç‚¹è¦†ç›–æ‰ã€‚

``` java
		//è¿™é‡Œx0,y0æ˜¯å›ºå®šçš„
		for(int i=0;i<n;i++) {//æšä¸¾ç¬¬äºŒä¸ªç‚¹ï¼Œç¡®å®šè¿™æ¡ç›´çº¿
			if(st[i]==1) continue;//è¿™ä¸ªç‚¹å·²ç»åœ¨å…¶ä»–çš„ç›´çº¿ä¸Šäº†,å°±ä¸éœ€è€ƒè™‘è¿™ä¸ªç‚¹äº†
			int x1 = arr[i].x;
			int y1 = arr[i].y;
			ans++;//è¿™æ˜¯ä¸€æ¡æ–°çš„ç›´çº¿ï¼Œè®¡æ•°+1
			for(int j=i+1;j<n;j++) {
				int x = arr[j].x;
				int y = arr[j].y;
                //ä½¿ç”¨ç›´çº¿çš„ä¸€èˆ¬å…¬å¼åˆ¤æ–­ç‚¹(x,y)æ˜¯å¦åœ¨è¿™æ¡ç›´çº¿ä¸Š
				if((x-x0)*(y0-y1) == (y-y0)*(x0-x1)) 
					st[j] = 1;
			}
		}
```



### è´¹é©¬å°å®šç†

æè¿°ï¼š

```
å¦‚æœä¸€ä¸ªæ•°pæ˜¯è´¨æ•°ï¼Œå¹¶ä¸”aä¸æ˜¯pçš„å€æ•°ï¼Œé‚£ä¹ˆæœ‰a^ï¼ˆp-1ï¼‰ = 1 (mod p)ã€‚
é™¤ä»¥påŒä½™
```

ç­‰ä»·äºï¼šï¼ˆæ¨èï¼‰

```
å¦‚æœä¸€ä¸ªæ•°pæ˜¯è´¨æ•°,å¹¶ä¸”aå’Œpäº’è´¨ï¼ˆå°±ä¸€å®šæ»¡è¶³gcd(a,pï¼‰=1ï¼‰ï¼Œé‚£ä¹ˆæœ‰a^ï¼ˆp-1ï¼‰ = 1 (mod p)
```

> åº•å±‚é€»è¾‘ï¼šaæ˜¯pçš„å€æ•°ï¼Œé‚£ä¹ˆgcd(a,p) = p;å¦‚æœaä¸æ˜¯pçš„å€æ•°ï¼Œé‚£ä¹ˆgcd(a,p)ä¸ä¸€å®šæ˜¯1ï¼Œä½†æ˜¯å½“aå’Œpæœ‰ä¸€ä¸ªæ˜¯è´¨æ•°æ—¶ï¼Œé‚£ä¹ˆæ­¤æ—¶gcd(a,p)=1ã€‚
>
> äº’è´¨çš„ç†è§£ï¼šgcd(a,pï¼‰=1ã€‚å¦‚æœä¸¤ä¸ªæ•°éƒ½æ˜¯è´¨æ•°ï¼Œé‚£ä¹ˆä¸€å®šäº’è´¨ã€‚å¦‚æœä¸¤ä¸ªæ•°æœ‰ä¸€ä¸ªæ˜¯è´¨æ•°ï¼Œå¦å¤–ä¸€ä¸ªæ•°ä¸æ˜¯å®ƒçš„å€æ•°ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ•°äº’è´¨ï¼ŒåŸå› ï¼šè´¨æ•°åªæœ‰1å’Œä»–æœ¬èº«ä¸¤ä¸ªçº¦æ•°ï¼Œä¸æ˜¯å€æ•°ï¼Œé‚£ä¹ˆä»–æœ¬èº«ä¸èƒ½æˆä¸ºå…¬çº¦æ•°äº†ï¼Œé‚£ä¹ˆå…¬çº¦æ•°åªèƒ½æ˜¯1äº†ã€‚

å®˜æ–¹è§£é‡Šï¼š

![](images/feima.png)

> ä¸€èˆ¬é…åˆæ±‚é€†å…ƒä½¿ç”¨

https://www.acwing.com/activity/content/code/content/748142/)

### æ¬§æ‹‰å®šç†

#### æ¬§æ‹‰å‡½æ•°

1âˆ¼N  ä¸­ä¸ N äº’è´¨çš„æ•°çš„ä¸ªæ•°è¢«ç§°ä¸ºæ¬§æ‹‰å‡½æ•°ï¼Œè®°ä¸º Ï•(N)ã€‚

è‹¥åœ¨ç®—æ•°åŸºæœ¬å®šç†ä¸­ï¼Œä¸‹å›¾ä¸­çš„pæ˜¯nçš„è´¨å› å­
![QQæˆªå›¾20221105190013.jpg](images/61195_0ba3faca5c-QQ%E6%88%AA%E5%9B%BE20221105190013.jpg)

> ç‰¹åˆ«çš„ï¼Œå¦‚æœnæ˜¯è´¨æ•°ï¼Œåˆ™Ï•(n) = n-1

```java
int solve(int n){
    int res=n;
    for(int i=2;i<=n/i;i++){
        if(n%i==0){
            res = res /i * (i-1);
            while(n%i==0)n/=i;
        }
    }
    if(n>1) res = res/n*(n-1);
    return res;
}
```

#### è´¹é©¬å°å®šç†

æ ¹æ®è´¹é©¬å°å®šç†å¯çŸ¥ï¼š

å½“mæ˜¯è´¨æ•°å¹¶ä¸”aä¸æ˜¯mçš„å€æ•°æ—¶ï¼Œ a^(mâˆ’2)å°±æ˜¯aåœ¨æ¨¡mæ„ä¹‰ä¸‹çš„ä¹˜æ³•é€†å…ƒ.



#### æ¬§æ‹‰å®šç†

![image-20240524141405724](images/image-20240524141405724.png)

å…¶ä¸­ï¼ŒÏ•(m)è¡¨ç¤ºæ¨¡æ•°mçš„æ¬§æ‹‰å‡½æ•°ï¼Œç‰¹åˆ«çš„ï¼Œè´¹é©¬å°å®šç†å°±æ˜¯æ¬§æ‹‰å®šç†çš„ç‰¹æ®Šæƒ…å†µï¼Œå› ä¸ºè´¹é©¬å°å®šç†çš„æ¡ä»¶ï¼ˆmæ˜¯è´¨æ•°å¹¶ä¸”aä¸æ˜¯mçš„å€æ•°ï¼‰æ˜¯æ¬§æ‹‰å®šç†ï¼ˆaä¸mäº’è´¨ï¼‰çš„å……åˆ†æ¡ä»¶ã€‚

> gcd(3,4) = 1ï¼Œa=3,m=4ï¼Œä½†æ˜¯ä¸æ»¡è¶³è´¹é©¬å°å®šç†æ‰€ä»¥ä¸æ˜¯å……è¦

- ä¹Ÿå°±æ˜¯è¯´ 

  å½“a,mäº’è´¨æ—¶ï¼Œa^(Ï•(m) -1) æ˜¯açš„ä¹˜æ³•é€†å…ƒ,ä½†æ˜¯æ—¶é—´æ˜¯O(sqrrt(n))çš„

#### æ‰©å±•æ¬§æ‹‰å®šç†(æ¬§æ‹‰é™å¹‚)

æ¬§æ‹‰å®šç†çš„æ²¹äº’è´¨çš„é™åˆ¶çš„ï¼Œä½†æ˜¯æ‰©å±•çš„æ¬§æ‹‰å®šç†æ²¡æœ‰

![image-20240525131013845](images/image-20240525131013845.png)

æ³¨æ„ï¼š**è¿™ä¸¤ä¸ªæƒ…å†µä¸èƒ½åˆå¹¶,éœ€è¦å•ç‹¬å¤„ç†**

> ![image-20240525133810105](images/image-20240525133810105.png)

```
//æ ¹æ®å¤§æŒ‡æ•°æ•°ç»„å’Œæ¬§æ‹‰å‡½æ•°å€¼ï¼Œè¿›è¡Œé™å¹‚ï¼Œè¿”å›é™åç»“æœ
long oula_down(char[] s, long oula){
	long res = 1,flag = 0;
	for(int i=0;i<s.length;i++){
		res = res * 10 + (s[i]-'0');//ç§¦ä¹éŸ¶ç®—æ³•
		if(res > oula){
			res %= oula;
			flag = 1;
		}
	}
	if(flag==1) res += oula;
	return res;
}
```

> psï¼š
>
> - ç”±äºåªæœ‰å½“æŒ‡æ•°b > oulaæ—¶ï¼Œæ‰éœ€è¦å–æ¨¡ï¼Œæ‰€ä»¥ç”¨ifç‰¹åˆ¤ï¼Œæ­¤å¤–ï¼Œè¿˜éœ€è¦ + oula
>
> - åŠ æ³•ä¹˜æ³•åˆ†é…å–æ¨¡ç¬¦
>
>   ç”±äºabc = (a*10 + b) *10 +  cï¼Œæ‰€ä»¥åœ¨è®¡ç®—æ—¶ä¸€è¾¹ç®—ä¸€è¾¹å–æ¨¡

### è£´èœ€å®šç†ï¼ˆçº¿æ€§ç»„åˆï¼‰

- è‹¥a,bæ˜¯æ•´æ•°,ä¸”gcd(a,b)=dï¼Œé‚£ä¹ˆå¯¹äºä»»æ„çš„æ•´æ•°x,y,éƒ½æœ‰ax+byéƒ½ä¸€å®šæ˜¯dçš„å€æ•°ã€‚ï¼ˆå……è¦çš„ï¼‰
  ç‰¹åˆ«åœ°ï¼Œä¸€å®šå­˜åœ¨æ•´æ•°x,yï¼Œä½¿ax+by=dæˆç«‹ã€‚

æ¢å¥è¯è¯´ï¼š

- ä¸¤ä¸ªæ•´æ•°a,b,æ–¹ç¨‹`a*x+b*y=m`æœ‰è§£ï¼Œå½“ä¸”ä»…å½“mæ˜¯gcd(a,b)çš„å€æ•°ï¼ˆå……è¦ï¼‰

#### æ¨è®ºï¼šæœ€å¤§æ— æ³•çº¿æ€§ç»„åˆçš„æ•°

![image-20240524142924930](images/image-20240524142924930.png)

Oï¼ˆ1ï¼‰

### æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•

æ‰©å±•æ¬§å‡ é‡Œå¾—ä»£ç ï¼š

```java
// æ±‚x, yï¼Œä½¿å¾—ax + by = gcd(a, b)
// æ‰©å±•æ¬§å‡ é‡Œå¾—:æ±‚è§£æ–¹ç¨‹ax+by=gcd(a,b)çš„è§£
// x=yâ€² y=xâ€²âˆ’[a/b]*yâ€²
static int x, y;//å…¨å±€å˜é‡ï¼Œæ›¿ä»£å¼•ç”¨
int exgcd(int a,int b){
    if(b==0){
        x=1,y=0;
        return a;
    }

    int gcd=exgcd(b,a%b);//é€’å½’è°ƒç”¨
    int tmp = x;
    x=y,y=tmp-a/b*y;
    return gcd;
}

	//ç»“æœè¯´æ˜
	1.exgcd()çš„è¿”å›å€¼æ˜¯æœ€å¤§å…¬çº¦æ•°
 	2.æœ€åçš„ï¼ˆxï¼Œyï¼‰æ˜¯æ–¹ç¨‹ax + by = gcd(a,b)çš„è§£
    3.å¦‚æœexgcd()çš„ç»“æœæ˜¯1ï¼ˆé‚£ä¹ˆaå’Œbäº’è´¨ï¼Œå°±å­˜åœ¨é€†å…ƒï¼‰ï¼Œé‚£ä¹ˆxæ˜¯açš„é€†å…ƒï¼ˆxå¯èƒ½æ˜¯è´Ÿæ•°ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯getMod(x)ï¼‰
        
    å‚è€ƒï¼šhttps://www.cnblogs.com/kksk/p/13069795.html  
```



#### **æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚é€†å…ƒ**

æ¿å­å·²ç»ç»™å‡ºæ¥äº†ï¼Œä¸‹é¢ç»™å‡ºè¯´æ˜ã€‚

ç›®æ ‡ï¼šæ±‚açš„é€†å…ƒxï¼Œa*x==1(% mod)ï¼Œaä¸æ˜¯è´¨æ•°

æˆ‘ä»¬å‡è®¾é€†å…ƒå­˜åœ¨ï¼Œå·²çŸ¥é€†å…ƒå­˜åœ¨çš„å……è¦æ¡ä»¶æ˜¯ï¼šgcd(a,mod) == 1

å·²çŸ¥è£´èœ€å®šç†ï¼šax + by = gcd(a, b)çš„æ–¹ç¨‹ä¸€å®šæœ‰è§£

å¦b = mod

åˆ™ï¼Œa * x + mod * y =  gcd(a,mod) = 1 

ä¸¤è¾¹æ¨¡modå¾—ï¼š a*x % mod = 1ï¼Œå³ a * x = 1(%mod)

æ­¤æ—¶çš„xå°±æ˜¯açš„æ¨¡modçš„é€†å…ƒï¼Œxä¹Ÿå°±æ˜¯æ–¹ç¨‹ax+by=gcd(a,b)çš„è§£çš„æ¨ªåæ ‡

![image-20230321205847482](images/image-20230321205847482.png)

![image-20230321205909890](img/image-20230321205909890.png)

### é€†å…ƒ

- å®šä¹‰

```
è‹¥æ•´æ•°bï¼Œmäº’è´¨ï¼Œå¹¶ä¸”å¯¹äºä»»æ„çš„æ•´æ•° aï¼Œå¦‚æœæ»¡è¶³b|aï¼Œåˆ™å­˜åœ¨ä¸€ä¸ªæ•´æ•°xï¼Œä½¿å¾— a/bâ‰¡aâˆ—x(mod m) ,åŒä½™ï¼Œåˆ™ç§°xä¸ºbçš„æ¨¡mä¹˜æ³•é€†å…ƒï¼Œè®°ä¸ºb^{-1}(mod m)ã€‚ 
```

- ç†è§£ï¼šé™¤ä»¥a ç­‰äºä¹˜ä»¥ ï¼ˆaçš„é€†å…ƒï¼‰

  **ç”¨é€†å…ƒæŠŠé™¤æ³•å˜æˆäº†ä¹˜æ³•**ã€‚é™¤æ³•æ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œæ‰€ä»¥ä¸Šè¿°æ„é€ çš„å«ä¹‰ï¼šaé™¤ä»¥ä¸€ä¸ªæ•°ï¼Œæˆ‘ä»¬è¦æŠŠä»–å˜æˆaä¹˜ä»¥ä¸€ä¸ªæ•°ï¼Œé™¤ä»¥bï¼Œç›¸å½“äºä¹˜ä»¥xï¼Œé‚£ä¹ˆ$b^{-1} = x$ã€‚å³ b*x == 1(mod m)

- é€†å…ƒå­˜åœ¨çš„å……è¦æ¡ä»¶ï¼š 

  bå­˜åœ¨ä¹˜æ³•é€†å…ƒçš„å……è¦æ¡ä»¶æ˜¯ **bä¸æ¨¡æ•° mäº’è´¨**ã€‚

- æ±‚è§£

  - å½“æ¨¡æ•° mä¸ºè´¨æ•°æ—¶ï¼Œå¹¶ä¸”bä¸æ˜¯mçš„å€æ•°æ—¶ï¼ˆåˆ©ç”¨è´¹é©¬å°å®šç†ï¼‰

    b^(mâˆ’2)å³ä¸ºbçš„æ¨¡mçš„ä¹˜æ³•é€†å…ƒ

  - å…¶ä»–æƒ…å†µï¼Œå¯ä»¥ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚é€†å…ƒï¼Œä¹Ÿå¯ä»¥ç”¨æ¬§æ‹‰å®šç†ï¼Œ**æ¨èæ‰©å±•æ¬§å‡ é‡Œå¾—**ï¼ˆæ•ˆç‡é«˜ï¼‰

    å°±éœ€è¦ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚å‡ºæ¥çš„xå°±æ˜¯ä¸€ä¸ªé€†å…ƒ

- å…·ä½“é¢˜ç›®ä¸­

  - å¦‚æœmæ˜¯ä¸€ä¸ªçš„å¤§è´¨æ•°ï¼ˆå¦‚1e9+7ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è´¹é©¬å°å®šç†ï¼Œ

    ```
    açš„é€†å…ƒ = a ^(m-2)
    ```

  - å½“æ¨¡æ•° mä¸æ˜¯è´¨æ•°æ—¶ï¼Œé‚£ä¹ˆå°±ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚å‡ºè§£ï¼Œæˆ–è€…æ¬§æ‹‰å®šç†

    - æ¬§æ‹‰å®šç† sqrt(nï¼‰æ—¶é—´å¤æ‚åº¦è¾ƒé«˜

    ```
    açš„é€†å…ƒ = a ^( Ï•(m) -1 )
    ```

    - æ‰©å±•æ¬§å‡ é‡Œå¾—O(logn)

    ```
    // æ±‚x, yï¼Œä½¿å¾—ax + by = gcd(a, b)
    // æ‰©å±•æ¬§å‡ é‡Œå¾—:æ±‚è§£æ–¹ç¨‹ax+by=gcd(a,b)çš„è§£
    // x=yâ€² y=xâ€²âˆ’[a/b]*yâ€²
    static int x, y;//å…¨å±€å˜é‡ï¼Œæ›¿ä»£å¼•ç”¨
    int exgcd(int a,int b){
        if(b==0){
            x=1,y=0;
            return a;
        }
    
        int gcd=exgcd(b,a%b);//é€’å½’è°ƒç”¨
        int tmp = x;
        x=y,y=tmp-a/b*y;
        return gcd;
    }
    
    	//ç»“æœè¯´æ˜
    	1.exgcd()çš„è¿”å›å€¼æ˜¯æœ€å¤§å…¬çº¦æ•°
     	2.æœ€åçš„ï¼ˆxï¼Œyï¼‰æ˜¯æ–¹ç¨‹ax + by = gcd(a,b)çš„è§£
        3.å¦‚æœexgcd()çš„ç»“æœæ˜¯1ï¼ˆé‚£ä¹ˆaå’Œbäº’è´¨ï¼Œå°±å­˜åœ¨é€†å…ƒï¼‰ï¼Œé‚£ä¹ˆxæ˜¯açš„é€†å…ƒï¼ˆxå¯èƒ½æ˜¯è´Ÿæ•°ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯getMod(x)ï¼‰
    ```

    

https://www.cnblogs.com/greenofyu/p/14103851.html

### åŸºç¡€æ•°è®ºçš„æ—¶é—´å¤æ‚åº¦æ²¡æœ‰æƒ³è±¡çš„é«˜

#### sqrt(n)

é¢˜ç›®ä¸­å€¼åŸŸåœ¨1e6çš„æ—¶å€™ï¼Œå¯¹åº”çš„å°±æ˜¯sqrt(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³é”®ä¿¡æ¯

ä¸€èˆ¬åªæœ‰æ•°è®ºä¸­ä¼šæœ‰sqrt(n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œå¦‚ï¼šåˆ†è§£è´¨å› æ•°ã€æ±‚å› å­ã€åˆ¤æ–­è´¨æ•°ã€‚

#### è°ƒå’Œçº§æ•°

>  æœ‰çš„æ—¶å€™æƒ³è±¡ä¸­çš„å¤æ‚åº¦æ˜¯n^2ï¼Œä½†æ˜¯å®é™…ç¡®æ˜¯nlognçš„ï¼Œæ‰€ä»¥ä¸è¦æŠŠå¤æ‚åº¦æƒ³é«˜äº†
>
>  å‚è§é¢˜ç›®ï¼šhttps://leetcode.cn/problems/find-the-number-of-good-pairs-ii/description/

è°ƒå’Œçº§æ•° = (1/1 + 1/2 + 1/3 +... + 1/n)çš„æ±‚å’Œçš„è¿è¡Œæ¬¡æ•°æ˜¯ lognçº§åˆ«çš„

ç®—æ³•ï¼šè´¨æ•°ç­›ã€æšä¸¾1~nçš„æ‰€æœ‰æ•°çš„å€æ•°ã€‚éƒ½æ˜¯nlognçš„æ—¶é—´

- ä¾‹å­

  çœ‹ä¸Šå»ä¸¤é‡å¾ªç¯ï¼Œå®é™…çš„å¤æ‚åº¦ä¸æ˜¯n^2ï¼Œè€Œæ˜¯n * logmï¼Œmæ˜¯å€¼åŸŸæœ€å¤§å€¼

```
for(Integer v : val.keySet()){
	int cnt = val.get(v);
	int x = v;
	//æšä¸¾xçš„æ‰€æœ‰å€æ•°
	for(int j=1;j * x <= mx;j++)
		mp.put(j*x,mp.getOrDefault(j*x,0)+cnt);
}
```



### nlognçš„æ—¶é—´å¤æ‚åº¦

```java
 for(int i=1;i<=n;i++){//æšä¸¾i
    for(int j =i+i;j<=n;j+=i){//æ‰§è¡Œn/iæ¬¡
```

æ‰§è¡Œæ¬¡æ•°ï¼šn + n/2 + n/3 + ...n/n

åŒ–ç®€ï¼šn * (1+1/2+1/3+1/4+...+1/n) = nlogn

> 1+1/2+1/3+1/4+...1/næ˜¯è°ƒå’Œçº§æ•°ï¼Œç»“æœå¤§æ¦‚æ˜¯logn
>
> å‚è€ƒï¼šç´ æ•°ç­›



### å¡ç‰¹å…°æ•°

æ»¡è¶³æ¡ä»¶çš„01åºåˆ—ï¼ˆå¡ç‰¹å…°æ•°ï¼‰

- ç»™å®šnä¸ª0å’Œnä¸ª1ï¼Œå®ƒä»¬æŒ‰ç…§æŸç§é¡ºåºæ’æˆé•¿åº¦ä¸º2nçš„åºåˆ—ï¼Œæ»¡è¶³ä»»æ„å‰ç¼€ä¸­0çš„ä¸ªæ•°éƒ½ä¸å°‘äº1çš„ä¸ªæ•°çš„åºåˆ—çš„æ•°é‡ä¸ºï¼š Cat(n) = C(2n, n) - C(2n,n-1) = C(2n, n) / (n + 1)

  ![ww](images/6828_9476d97655-Catalan.png)

https://www.acwing.com/activity/content/code/content/5905692/



### å®¹æ–¥åŸç†

![42785_2b1669eed8-QQæµè§ˆå™¨æˆªå›¾20200807160125.png](images/61195_2de17f58f3-42785_2b1669eed8-QQ%E6%B5%8F%E8%A7%88%E5%99%A8%E6%88%AA%E5%9B%BE20200807160125.png)

æ³¨æ„è§‚å¯Ÿï¼Œå¥‡æ•°ä¸ªé›†åˆçš„äº¤é›†æ˜¯æ­£çš„ï¼Œå¶æ•°ä¸ªæ˜¯è´Ÿå·

- ä¾‹é¢˜ï¼š890. èƒ½è¢«æ•´é™¤çš„æ•°

  > ç»™å®šä¸€ä¸ªæ•´æ•° nğ‘› å’Œ mğ‘š ä¸ªä¸åŒçš„è´¨æ•° p1,p2,â€¦,pm
  >
  > è¯·ä½ æ±‚å‡º 1âˆ¼n ä¸­èƒ½è¢« p1,p2,â€¦,pm ä¸­çš„è‡³å°‘ä¸€ä¸ªæ•°æ•´é™¤çš„æ•´æ•°æœ‰å¤šå°‘ä¸ªã€‚
  >
  > 1â‰¤mâ‰¤16
  > 1â‰¤n,piâ‰¤109

  ç›¸å½“äºæ±‚ï¼ša å¹¶ b å¹¶ c ...

  ```
  	for(int mask = 1;mask < (1<<m) ;mask ++){//æšä¸¾æ‰€æœ‰æƒ…å†µ
  		    long s = 1;//è´¨æ•°çš„ä¹˜ç§¯
  		    int cnt = 0;//é›†åˆçš„ä¸ªæ•°
  		    for(int j=0;j<32;j++){
  		        if((mask>>j&1)==1){//é€‰æ‹©äº†è¿™ä¸€ä½
  		            s *= a[j];
  		            cnt += 1;
  		            if(s > n) break;
  		        }
  		    }
  		    ans += n/s * (cnt%2==1?1:-1); //1~nä¸­sçš„å€æ•°çš„ä¸ªæ•°æ˜¯n/s
  ```

  

### æ•°å­¦å¸¸è¯†

#### 1~nä¸­kçš„å€æ•°çš„ä¸ªæ•°

1~nä¸­kçš„å€æ•°çš„ä¸ªæ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼šn/k
ä¸¾ä¾‹ï¼š1~8ä¸­2çš„å€æ•°çš„ä¸ªæ•°ä¸ºï¼š8/2=4

https://www.acwing.com/problem/content/4879/

#### n!ä¸­è´¨å› å­pçš„ä¸ªæ•°

æ ¹æ®å…¬å¼ï¼Œn!ä¸­æœ‰è´¨å› å­pçš„ä¸ªæ•°ä¸ºï¼š
$$
ï¼ˆ\frac {n}{p}+\frac {n}{p^2}+\frac {n}{p^3}+...)
$$
æ—¶é—´å¤æ‚åº¦ä¸º:O(logn)

```java
int divide(int n,int p){
    int ans=0;
    /*æ–¹æ¡ˆ1
    while(n){
        ans+=n/p;
        n/=p;//ä¸èƒ½å†™æˆp*=p;
    }
    */
    //æ–¹æ¡ˆ2
    for(int i=p;n/i;i*=p)
        ans+=n/i;
    return ans;
}
```

å‚è€ƒï¼šhttps://blog.csdn.net/Supreme7/article/details/115796373

#### ç­‰æ¯”æ•°åˆ—æ±‚å’Œ

- æ–¹æ³•1ï¼šæœ´ç´ åšæ³•

  O (n)

  Sk = 1+p^2+p^3+...+p^k 

  Sk-1 = 1+p^2+p^3+...+p^k-1 

  é€’æ¨å¼ï¼šSk = p*Sk-1 +1

  ```java 
  //è®¡ç®—1+p^2+p^3+...+p^kçš„å’Œ
  static long sum(int p,int k){
      long t=1;
      while(b--){
          t=(t*a+1);
      }
      return t;
  }
  ```

  

- åˆ†æ²»æ³•

  Oï¼ˆlognï¼‰

  ```java
      //è®¡ç®—1+p^2+p^3+...+p^kçš„å’Œï¼ˆæ—¶é—´å¤æ‚åº¦Oï¼ˆlognï¼‰ï¼‰
      static int sum(int p,int k) {
          p %= mod;//å¿…é¡»è¦åŠ è¿™ä¸ªï¼Œä¸ç„¶ä¼šWAï¼Œä¼šæœ‰æº¢å‡º
          if(k==0) return 1;
          if(k%2==1) 
              return sum(p, k/2)*(qpow(p,k/2+1)+1)%mod;
          return (sum(p, k-1)*p+1)%mod;
      }
  
  	//https://www.acwing.com/activity/content/code/content/5624746/
  ```

  

#### æµ·ä¼¦å…¬å¼

ä¸‰è§’å½¢ä¸‰è¾¹ï¼ša,b,c

ä»¤ p = (a+b+c)/2

é¢ç§¯ S = sqrt(p*(p-a)(p-b)(p-c))

#### åŒä½™

```
è‹¥a-b=n*k
åˆ™a%k==b%k
```

ä¾‹é¢˜ï¼škå€åŒºé—´

#### ä½è¿ç®—

- (cnt & 1) == 1:åˆ¤æ–­æ˜¯å¦æ˜¯å¥‡æ•° 

```
if((cnt & 1) == 1)
```

å¥‡æ•°çš„äºŒè¿›åˆ¶æœ€åä¸€ä½ä¸€å®šæ˜¯1ã€‚å¦åˆ™å°±æ˜¯å¶æ•°

















### å–æ¨¡

å½“åŠ å‡ä¹˜é™¤é‡ä¸Šå–æ¨¡(https://leetcode.cn/circle/discuss/mDfnkW/)

![image-20240514130303133](images/image-20240514130303133.png)

```
MOD = 1_000_000_007

// åŠ 
(a + b) % MOD

// å‡
(a - b + MOD) % MOD

// ä¹˜
a * b % MOD

// å¤šä¸ªæ•°ç›¸ä¹˜ï¼Œè¦æ­¥æ­¥å–æ¨¡ï¼Œé˜²æ­¢æº¢å‡º
a * b % MOD * c % MOD

// é™¤ï¼ˆMOD æ˜¯è´¨æ•°ä¸” b ä¸æ˜¯ MOD çš„å€æ•°ï¼‰è´¹é©¬å°å®šç†
a * qpow(b, MOD - 2, MOD) % MOD
```





## æœç´¢

### BFS

```java
    static char[][] arr = new char[N][N];
    static int[][] vis = new int[N][N];
    static int[][] cen = new int[N][N];
    static int t,r,c;
    static int sx,sy,ex,ey;
    static int[] dx = {1,0,-1,0};
    static int[] dy = {0,1,0,-1};

   static void bfs() {
       for(int i=0;i<N;i++) {
           Arrays.fill(cen[i], INF);
           Arrays.fill(vis[i], 0);
       }

       Queue<PII> q = new LinkedList<>();
       //èµ·ç‚¹å…¥é˜Ÿ
       q.add(new PII(sx,sy));
       cen[sx][sy] = 0;
       vis[sx][sy] = 1;

       while(q.size()>0) {
           PII top = q.poll();
           int x = top.x, y = top.y;
           for(int i=0;i<4;i++) {
               int nx = x + dx[i],ny = y + dy[i];
               if(check(nx,ny)==1) {
                   q.add(new PII(nx,ny));
                   vis[nx][ny] = 1;
                   cen[nx][ny] = cen[x][y]+1;
                   ans++;//è®¿é—®çš„ä¸åŒèŠ‚ç‚¹ä¸ªæ•°
               }
           }
       }
       return cen[ex][ey];
   }
class PII{
	int x;
	int y;
	public PII(int x,int y) {
		this.x = x;
		this.y = y;
	}
}

    static int check(int x,int y) {
        if(x>=1 && x<=r && y>=1 && y<=c && vis[x][y]==0 && arr[x][y]=='.')
            return 1;
        return 0;
    }

    public static void main(String[] sss) {
            int ans = bfs();
            if(ans!=INF)
                System.out.println(ans);
            else 
                System.out.println("oop!");
    }
}

```

#### BFSéå†å‰kå±‚æ‰€æœ‰èŠ‚ç‚¹çš„æ¨¡æ¿

å°±éå†kæ¬¡ï¼Œæ¯ä¸€æ¬¡åˆå§‹æ—¶é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°szï¼Œè®©szä¸ª

```java
    static int bfs(int u) {
        Queue<Integer> q = new LinkedList<Integer>();
        Arrays.fill(st, 0);
        q.add(u);
        st[u] = 1;
        int ans = 0;//ç­”æ¡ˆä¸ç®—èµ·ç‚¹

        for(int level = 0;level < k;level++) {//BFSæœ€å¤škå±‚
            int sz = q.size();//è·å¾—å½“å‰è¿™ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹ä¸ªæ•°
            while(sz-->0) {//æŠŠå½“å‰è¿™å±‚çš„æ‰€æœ‰èŠ‚ç‚¹å‡ºé˜Ÿ
                Integer top = q.poll();
                for(int i=h[top];i!=-1;i=ne[i]) {
                    int j = e[i];
                    if(st[j]==1) continue;
                    q.add(j);
                    st[j]=1;
                    ans++;
                }
            }
        }
        return ans;
    }
```



#### æšä¸¾ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘

	static int[] dx = {1,0,-1,0};
	static int[] dy = {0,1,0,-1};
	for(int i=0;i<4;i++){
		int nx = x + dx[i];
		int ny = y + dy[i];
	}
#### æšä¸¾ä¸Šä¸‹å·¦å³çš„å…«ä¸ªæ–¹å‘

```
for(int i=x-1;i<=x+1;i++){
	for(int j=y-1;j<=y+1;j++) {
		if(i==x && j==y) continue;//å»é™¤ä¸­é—´å…ƒç´ æœ¬èº«
		//å…·ä½“ä»£ç 
	}
}
```



#### FloodFill

æšä¸¾æ¯ä¸ªä½ç½®ï¼Œå¦‚æœæ˜¯æ°´åŸŸï¼Œå¹¶ä¸”æ²¡æœ‰è¢«æ ‡è®°è¿‡ï¼Œé‚£ä¹ˆå°±æœç´¢è¿™ä¸€æ•´ç‰‡æ± å¡˜ï¼Œæœç´¢çš„è¿‡ç¨‹å¯ä»¥æ˜¯bfsï¼Œä¹Ÿå¯ä»¥æ˜¯dfsï¼Œå¯¹äºæœç´¢è¿‡çš„æ¯ä¸€å—æ°´åŸŸï¼Œéƒ½æ ‡è®°ä¸€ä¸‹ã€‚

https://www.acwing.com/activity/content/code/content/6361986/



### DFS

#### æŒ‡æ•°å‹æšä¸¾

O(2^n)

#### ç»„åˆå‹æšä¸¾

é¡ºåºé™åˆ¶çš„dfs

Oï¼ˆC(n,m)ï¼‰

#### æ’åˆ—å‹æšä¸¾

æšä¸¾æ•°ç»„ansçš„æ¯ä¸ªä½ç½®é€‰ä»€ä¹ˆ

Oï¼ˆn!ï¼‰

#### å‰ªæ

##### å¯è¡Œæ€§å‰ªæ

å½“å‰è½®æ¬¡uæ—¶å·²ç»ä¸æ»¡è¶³é¢˜æ„ï¼Œç›´æ¥åœæ­¢é€’å½’

##### æœ€ä¼˜æ€§å‰ªæ

å½“å‰è½®æ¬¡uæ—¶ï¼Œåç»­å·²ç»ä¸å¯èƒ½è¶…è¿‡å½“å‰æœ€ä¼˜è§£æ—¶ï¼Œç›´æ¥åœæ­¢

##### é‡å¤æ€§å‰ªæ

æœç´¢æ—¶ï¼Œæœ‰äº›æ–¹æ¡ˆä¼šé‡å¤æœç´¢ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼š1.ä½¿ç”¨è®°å¿†æ•°ç»„è¿›è¡Œæ ‡è®° 2.åœ¨æšä¸¾æ–¹æ¡ˆæ—¶æ§åˆ¶

å½“å‰è½®æ¬¡uæ—¶ï¼Œåç»­ä¼šå‡ºç°ä¸¤ä¸ªç›¸åŒçš„æ–¹æ¡ˆï¼Œåœ¨æšä¸¾æ–¹æ¡ˆé€‰æ‹©æ—¶è¿›è¡Œæ§åˆ¶ï¼ˆé¡ºåºè¦æ±‚ï¼‰ï¼Œä»è€Œè¾¾åˆ°å‡å°‘é€’å½’æ¬¡æ•°çš„ç›®çš„ã€‚å‚è€ƒï¼šå°çŒ«çˆ¬å±±ï¼Œå…·ä½“çš„ï¼Œå½“select[j] == select[j-1]æ—¶ï¼Œå½“å‰é€‰æ‹©ä¸ä¸Šä¸€è½®çš„é€‰æ‹©å€¼æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆå°±ç›´æ¥è·³è¿‡ã€‚



##### å¥‡å¶æ€§å‰ªæ

ä»èµ·ç‚¹èµ°åˆ°ç»ˆç‚¹éœ€è¦çš„æ­¥æ•°çš„å¥‡å¶æ€§æ˜¯ç¡®å®šçš„ã€‚å¦‚æœè®©ä½ åˆ¤æ–­Tæ—¶åˆ»æ˜¯å¦èƒ½åˆ°è¾¾ï¼Œåˆ¤æ–­èµ·ç‚¹ç»ˆç‚¹é¢œè‰²æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å¿…é¡»èµ°å¶æ•°æ­¥ï¼Œå¦‚æœTæ˜¯å¥‡æ•°ä¸€å®šåˆ°ä¸äº†ã€‚ æ¯ä¸ªæ ¼å­çš„é¢œè‰²ç”¨æ¨ªåæ ‡+çºµåæ ‡çš„å¥‡å¶æ€§å°±èƒ½ç¡®å®šã€‚

> ä¾‹é¢˜
>
> æœ‰ä¸€ä¸ªnxmå¤§å°çš„è¿·å®«ã€‚å…¶ä¸­å­—ç¬¦Sè¡¨ç¤ºèµ·ç‚¹ï¼Œå­—ç¬¦Dè¡¨ç¤ºå‡ºå£ï¼Œå­—ç¬¦Xè¡¨ç¤ºå¢™å£ï¼Œå­—ç¬¦.è¡¨ç¤ºå¹³åœ°ã€‚ä½ éœ€è¦ä»Så‡ºå‘èµ°åˆ°Dï¼Œæ¯æ¬¡åªèƒ½å‘ä¸Šä¸‹å·¦å³ç›¸é‚»çš„ä½ç½®ç§»åŠ¨ï¼Œå¹¶ä¸”ä¸èƒ½èµ°å‡ºåœ°å›¾ï¼Œä¹Ÿä¸èƒ½èµ°è¿›å¢™å£ã€‚æ¯æ¬¡ç§»åŠ¨æ¶ˆè€—1æ—¶é—´ï¼Œèµ°è¿‡è·¯éƒ½ä¼šå¡Œé™·ï¼Œå› æ­¤ä¸èƒ½èµ°å›å¤´è·¯æˆ–è€…åŸåœ°ä¸åŠ¨ã€‚ç°åœ¨å·²çŸ¥å‡ºå£çš„å¤§é—¨åªä¼šåœ¨Tæ—¶é—´æ‰“å¼€ï¼ŒTæ—¶é—´åå°±ä¼šå…³é—­ï¼Œåˆ¤æ–­åœ¨0æ—¶é—´ä»èµ·ç‚¹å‡ºå‘èƒ½å¦é€ƒç¦»è¿·å®«ã€‚æ•°æ®èŒƒå›´n,m<10,T<50ã€‚
>
> ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªè·¯å¾„ï¼Œä½¿å¾—åˆ°è¾¾è¿™ä¸ªè·¯å¾„æ—¶çš„æ—¶é—´åˆšå¥½æ˜¯Tï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±æ˜¯Falseã€‚
>
> æ­£å¸¸åšå°±æ˜¯ä»èµ·ç‚¹dfsï¼Œæœ€ååˆ°è¾¾ç»ˆç‚¹ï¼Œåˆ¤æ–­ç»ˆç‚¹æ—¶é—´æ˜¯å¦æ˜¯T
>
> å‰ªæ1ï¼šå¦‚æœæ­¥æ•°è¶…è¿‡äº†Tå°±ç›´æ¥é€€å‡º
>
> å‰ªæ2ï¼šå¦‚æœåˆ°è¾¾äº†ç»ˆç‚¹æ­¥æ•°ä¸æ˜¯Tå°±é€€å‡º
>
> å‰ªæ3ï¼šå¦‚æœèµ·ç‚¹ï¼ˆ1,1ï¼‰ä¸ç»ˆç‚¹ï¼ˆn,mï¼‰åŒè‰²ï¼Œå¦‚æœTä¸æ˜¯å¶æ•°ï¼Œå°±ä¸€å®šåˆ°ä¸äº†ï¼Œé€€å‡ºï¼›å¦‚æœèµ·ç‚¹ï¼ˆ1,1ï¼‰ä¸ç»ˆç‚¹ï¼ˆn,mï¼‰ä¸åŒè‰²ï¼Œå¦‚æœTä¸æ˜¯å¥‡æ•°ï¼Œå°±ä¸€å®šåˆ°ä¸äº†ï¼Œé€€å‡ºï¼›å…·ä½“çš„ï¼ŒåŒè‰²ä»£è¡¨ï¼š(1+1)%2 == (n+m)%2

![image-20240507130802012](images/image-20240507130802012.png)



### è¿­ä»£åŠ æ·±

å®šä¹‰ï¼šæ¯æ¬¡é™å®šä¸€ä¸ªmaxdepæœ€å¤§æ·±åº¦ï¼Œä½¿æœç´¢æ ‘çš„æ·±åº¦ä¸è¶…è¿‡maxdep

æ„ä¹‰ï¼šé˜²æ­¢åœ¨ä¸€ä¸ªæ²¡æœ‰è§£çš„é€’å½’æ ‘ä¸­ä¸€è·¯èµ°åˆ°é»‘ï¼Œå¯¼è‡´æµªè´¹æ—¶é—´

æ–¹æ³•ï¼šä¸€å±‚ä¸€å±‚dfsï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡å°±æ˜¯æœ€å¤§æ·±åº¦æ˜¯1ï¼Œç¬¬äºŒæ¬¡æ·±åº¦æ˜¯2ã€‚

æ¨¡æ¿ï¼šæ±‚æœ€å°æ­¥æ•°

```
for(int maxdep=1;maxdep<=é¢˜ç›®ä¸­ç»™çš„æœ€å¤§æ­¥æ•°;maxdep++){
	dfs(0,maxdep);//0ä¸ºå‡ºå…¥å‡½æ•°ä¸­å½“å‰æ­¥æ•°ï¼Œmaxdepä¸ºä¼ å…¥çš„æœ€å¤§æ·±åº¦ã€‚
	if(success){
		//å¦‚æœæœç´¢æˆåŠŸåˆ™ä¼šåœ¨dfså‡½æ•°ä¸­å°†successèµ‹å€¼ä¸º1ã€‚
		return maxdep;
		break;
	}
	
}
```

**ä½¿ç”¨èŒƒå›´:**

1.åœ¨æœ‰ä¸€å®šçš„é™åˆ¶æ¡ä»¶æ—¶ä½¿ç”¨ï¼ˆä¾‹å¦‚æœ¬é¢˜ä¸­â€œå¦‚æœèƒ½åœ¨15æ­¥ä»¥å†…ï¼ˆåŒ…æ‹¬15æ­¥ï¼‰åˆ°è¾¾ç›®æ ‡çŠ¶æ€ï¼Œåˆ™è¾“å‡ºæ­¥æ•°ï¼Œå¦åˆ™è¾“å‡ºâˆ’1ã€‚â€œï¼‰ã€‚

2.é¢˜ç›®ä¸­è¯´è¾“å‡ºæ‰€ä»¥è§£ä¸­çš„ä»»ä½•ä¸€ç»„è§£ã€‚

**ä¸ºä»€ä¹ˆèƒ½å¤Ÿé™ä½æ—¶é—´å¤æ‚åº¦ï¼š**

æˆ‘ä»¬å¯èƒ½ä¼šåœ¨ä¸€ä¸ªæ²¡æœ‰è§£ï¼ˆæˆ–è§£å¾ˆæ·±çš„åœ°æ–¹æ— é™é€’å½’ç„¶è€Œé¢˜ç›®ä¸­è¦æ±‚è¾“å‡ºä»»ä½•çš„ä¸€ç»„è§£ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶ä¸€ä¸ªæ·±åº¦ï¼Œè®©å®ƒå»éå†æ›´å¤šçš„åˆ†æ”¯ï¼Œå»æ›´å¹¿æ³›åœ°æ±‚è§£ï¼Œ(å…¶å®å’ŒBFSæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™)ã€‚



### å¯å‘å¼æœç´¢

- ä¼°ä»·å‡½æ•°

#### A*

å¯å‘å¼æœç´¢





#### IDA*

> Iterative deepening A*
>
> https://blog.csdn.net/glorious_dream/article/details/123004027

IDA*æ˜¯å¯¹ç»“åˆ**è¿­ä»£åŠ æ·±**çš„DFS çš„ä¼˜åŒ–ï¼ŒåŠ äº†ä¸ª**è¯„ä¼°å‡½æ•°**ï¼Œç”¨äºé¢„æµ‹å¯èƒ½çš„ç»“æœã€‚`å’ŒA*ç®—æ³•ä¸€æ ·ï¼Œæ˜¯å¯å‘å¼æœç´¢`

ç°åœ¨å°±æ˜¯è¦æƒ³ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¼°ä»·å‡½æ•°ï¼ˆè‹¥ä¼°ä»·å‡½æ•°ä¸å¥½çš„è¯ï¼Œä¼˜åŒ–æ•ˆç‡å°±å¹¶ä¸é«˜ï¼Œä¾‹å¦‚è‹¥ä¼°ä»·å‡½æ•°ä¸€ç›´ä¸º0ï¼Œé‚£å°±æ˜¯çˆ†æœï¼‰ã€‚

ä¾‹é¢˜ï¼š

![img](images/1dfc0c14fac84e31931268e4ce82891a.png)

ä¼°ä»·å‡½æ•°ï¼šå½“å‰æƒ…å†µä¸‹è¿˜å‰©å¤šå°‘ä¸ªï¼ˆcntä¸ªï¼‰é©¬éœ€è¦è¢«æ¢

```
int evaluate(){
	int cnt=0;
	for(register int i(1) ; i<=5 ; i=-~i){
		for(register int j(1) ; j<=5 ; j=-~j){
			if(mp[i][j] != goal[i][j]) cnt++; //å¦‚æœè¿™ä¸¤ä¸ªç‚¹ä¸ç›¸åŒ
		}
	}
	return cnt; //è¿”å›æœ€å°‘ç†æƒ³æƒ…å†µä¸‹éœ€è¦çš„æ¬¡æ•°
}

```

æ ¸å¿ƒä»£ç ï¼š

å‡è®¾è¯„ä¼°å‡½æ•°è®¡ç®—å‡ºï¼šè¿˜æœ‰cntä¸ªé©¬ï¼Œé‚£ä¹ˆæœ€ä¼˜çŠ¶æ€å°±æ˜¯cntæ­¥å®Œæˆï¼Œé‚£ä¹ˆæœ€åå°±æ˜¯dep+cnt > maxDepï¼Œé‚£ä¹ˆå°±æ°¸ä¸å¯èƒ½åœ¨madDepå®Œæˆä»»åŠ¡

```
void A_star(int dep,int x,int y,int maxdep){
	if(dep == maxdep){
		if(!evaluate()) success=1; //è¡¨ç¤ºæ­£å¥½å®Œå…¨åŒ¹é…
		return;
	}
	for(register int i(0) ; i<8 ; i=-~i){
		int xx = x + dx[i];
		int yy = y + dy[i]; //8ä¸ªæ–¹å‘
		if(!pd(xx,yy)) continue; //ä¸èƒ½èµ°å°±è·³è¿‡
		swap(mp[x][y],mp[xx][yy]); //æŠŠä¸¤ä¸ªç‚¹çš„é¢œè‰²äº¤æ¢
		int eva = evaluate(); //ç†æƒ³æƒ…å†µä¸‹çš„æœ€å°‘æ­¥æ•°
		if(eva + dep <= maxdep) A_star(dep+1,xx,yy,maxdep); //å¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œæ¥ç€å¾€ä¸‹æœ
		swap(mp[x][y],mp[xx][yy]); //åˆ«å¿˜äº†å›æº¯
	}
}
signed main(){
	T=read();
	while(T--){
		success=0;
		flag=0; //åˆ«å¿˜äº†å…ˆæ¸…é›¶
		for(register int i(1) ; i<=5 ; i=-~i){
			for(register int j(1) ; j<=5 ; j=-~j){
				char ch;
				cin >> ch;
				if(ch == '*') mp[i][j] = 2,sx=i,sy=j; //è¿™é“é¢˜æšä¸¾é‚£ä¸ªç©ºç™½å¥½ï¼Œå› ä¸ºæ¬¡æ•°å°‘
				else mp[i][j] = ch-'0';
			}
		}
		if(!evaluate()) {printf("0\n");continue;}
		for(register int maxdep(1) ; maxdep<=15 ; maxdep=-~maxdep){ //é™åˆ¶æœ€å¤šæ¬¡æ•°
			A_star(0,sx,sy,maxdep);
			if(success) {printf("%d\n",maxdep);flag=1;break;} //å¦‚æœèƒ½åŒ¹é…
		}
		if(!flag) printf("-1\n"); //ä¸èƒ½åŒ¹é…
	}
	return 0;
}

```





#### A * å’ŒIDA * çš„åŒºåˆ«


Aâˆ—æ˜¯ç”¨äºå¯¹BFSçš„ä¼˜åŒ–ï¼›

IDA*æ˜¯å¯¹ç»“åˆè¿­ä»£åŠ æ·±çš„DFS çš„ä¼˜åŒ–ã€‚

æœ¬è´¨ä¸Šåªæ˜¯åœ¨BFSå’ŒDFSä¸ŠåŠ ä¸Šäº†ä¸€ä¸ªä¼°ä»·å‡½æ•°ã€‚

ä½•æ—¶ä½¿ç”¨å› é¢˜è€Œå®šã€‚

ç°åœ¨å°±æ˜¯è¦æƒ³ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¼°ä»·å‡½æ•°ï¼ˆè‹¥ä¼°ä»·å‡½æ•°ä¸å¥½çš„è¯ï¼Œä¼˜åŒ–æ•ˆç‡å°±å¹¶ä¸é«˜ï¼Œä¾‹å¦‚è‹¥ä¼°ä»·å‡½æ•°ä¸€ç›´ä¸º0ï¼Œé‚£å°±æ˜¯çˆ†æœï¼‰ã€‚


## å›¾è®º

### å›¾çš„å­˜å‚¨

#### é‚»æ¥è¡¨

```
static int[] dist = new int[N],st = new int[N];
static int[] h = new int[N],e = new int[M],ne = new int[M],w = new int[M];
static int idx;

static void init(){
	Arrays.fill(h,-1);
}
static void add(int a,int b,int c) {
	e[idx] = b;
	w[idx] = c;
	ne[idx] = h[a];
	h[a] = idx++;
}
```

#### é‚»æ¥è¡¨2

ç”¨æ¥å¿«é€Ÿå¾—åˆ°é¡¶ç‚¹çš„æ‰€æœ‰é‚»è¾¹æ¡æ•°

> leetcodeä¸­æ¯”è¾ƒå¸¸è§

```
ArrayList<Integer>[] g = new ArrayList[N];

//åˆå§‹åŒ–
for(int i=0;i<n;i++)
    g[i] = new ArrayList<Integer>();
    
//é¡¶ç‚¹a,bä¸­é—´æ·»åŠ ä¸€æ¡è¾¹
g[a].add(b);
```



### Dijkstra

O (mlogn)

```java
	static int[] h = new int[N],e = new int[M],ne = new int[M],w = new int[M];
	static int idx;
	static int[] dist = new int[N],st = new int[N];
	static void add(int a,int b,int c) {
		e[idx] = b;
		w[idx] = c;
		ne[idx] = h[a];
		h[a] = idx++;
	}
	static int dijkstra() {
		Arrays.fill(dist, INF);
		PriorityQueue<PII> q = new PriorityQueue<PII>((a,b)->(a.dist-b.dist));//å°æ ¹å †
		q.add(new PII(0,1));
		dist[1]=0;

		while(q.size()>0) {
			PII top = q.poll();
			//å¦‚æœè¿™ä¸ªç‚¹çš„æœ€çŸ­è·¯ç¡®å®šäº†ï¼Œé‚£ä¹ˆç›´æ¥è·³è¿‡
			if(st[top.ver]==1) continue;
			st[top.ver]=1;
			
			for(int i=h[top.ver];i!=-1;i=ne[i]) {
				int j = e[i];
				if(dist[j]>dist[top.ver]+w[i]) {
					dist[j] = dist[top.ver]+w[i];
					q.add(new PII(dist[j],j));
				}
			}
		}
		return dist[n];
	}
}
class PII{
	int dist,ver;
	
	public PII(int dist,int ver) {
		this.dist = dist;
		this.ver = ver;
	}
}
```



### SPFAæœ€çŸ­è·¯

æ—¶é—´å¤æ‚åº¦Oï¼ˆm*nï¼‰ä½†æ˜¯å®é™…æ•ˆç‡å¾ˆé«˜ï¼Œç”¨æ¥æ›¿ä»£æœ´ç´ ç‰ˆçš„dijkstra

```java
		//stæ•°ç»„ç”¨æ¥å­˜å‚¨å½“å‰èŠ‚ç‚¹æ˜¯å¦åœ¨é˜Ÿåˆ—ä¸­
		static int[] st = new int[N],dist = new int[N];

        static int spfa() {
            Arrays.fill(dist, INF);
            Queue<Integer> q = new LinkedList<Integer>();
            
            q.add(1);
            st[1] = 1;
            dist[1] = 0;
            
            while(q.size()>0) {
                Integer top = q.poll();
                st[top] = 0;//ä¸åœ¨é˜Ÿåˆ—äº†ï¼Œç½®ä¸º0
                for(int i=h[top];i!=-1;i=ne[i]) {
                    int j = e[i];
                    if(dist[j] > dist[top] + w[i]) {
                        dist[j] = dist[top] + w[i];
                        if(st[j]==0) {//ä¸åœ¨é˜Ÿåˆ—ä¸­ï¼Œå°±å…¥é˜Ÿ
                            st[j]=1;
                            q.add(j);
                        }
                    }
                }
            }
            return dist[n];
        }
```

### Floyd

- floydç®—æ³•åªéœ€è¦ä¸€ä¸ªäºŒç»´æ•°ç»„å˜é‡g[][]ï¼Œè¿è¡Œå‰æ˜¯ä¸€ä¸ªé‚»æ¥çŸ©é˜µï¼Œè¿è¡Œåæ˜¯ä¸€ä¸ªè®°å½•æœ€çŸ­è·¯çš„distæ•°ç»„ï¼Œg [ i ] [ j ]è¡¨ç¤ºiåˆ°jçš„æœ€çŸ­è·¯
- è¿™ä¸ªç®—æ³•ç”¨é‚»æ¥çŸ©é˜µå­˜å‚¨ï¼ˆæœ´ç´ dijkstraç”¨é‚»æ¥çŸ©é˜µï¼Œå †ä¼˜åŒ–ç”¨é‚»æ¥è¡¨ï¼Œspfaç”¨é‚»æ¥è¡¨ï¼Œfloydç”¨é‚»æ¥çŸ©é˜µï¼‰
- åˆå§‹åŒ–ï¼Œå¯¹äºæ‰€æœ‰çš„i!=jçš„ä½ç½®ï¼Œgæ•°ç»„åˆå§‹åŒ–æˆINFã€‚

```java
    static int floyd(int[][] g) {
        for(int k=1;k<=n;k++) 
            for(int i=1;i<=n;i++) 
                for(int j=1;j<=n;j++) 
                    g[i][j] = Math.min(g[i][j], g[i][k]+g[k][j]);
        return g[1][n];
    }

    //åˆå§‹åŒ–ï¼Œåœ¨è¾“å…¥ä¹‹å‰
    for(int i=0;i<n;i++) {
        Arrays.fill(g[i], INF);
        tie[i][i] = gon[i][i] = 0;  //è‡ªå·±åˆ°è‡ªå·±çš„è·ç¦»ä¸º0      
    }

	//æœ€çŸ­è·ç¦»
	g[1][n];//è¡¨ç¤ºä»é¡¶ç‚¹1åˆ°é¡¶ç‚¹nçš„æœ€çŸ­è·¯å¾„
```

### Kruskal

![7416_09dce69452-d87215b6df3bbf95de3a123d64be7bd](images/7416_09dce69452-d87215b6df3bbf95de3a123d64be7bd.png)

```java

    static int[] p = new int[N];
    static Edge[] edges = new Edge[M];

    static int kruskal() {
        Arrays.sort(edges,1,m+1);
        int cnt = 0,ans = 0;

        for(int i=1;i<=m;i++) {
            int x = edges[i].x;
            int y = edges[i].y;
            int w = edges[i].w;
            int a = find(x),b = find(y);
            if(a!=b) {
                p[a] = b;
                cnt++;
                ans += w;
            }
        }
        return cnt==n-1?ans:INF;
    }

	class Edge implements Comparable<Edge>{
        int x,y,w;
        public Edge(int x,int y,int w) {
            this.x = x;
            this.y = y;
            this.w = w;
        }
        @Override
        public int compareTo(Edge o) {
            return Integer.compare(w, o.w);
        }
    }

    static int find(int x) {
        if(x==p[x]) return x;
        return p[x] = find(p[x]);
    }
```



### bellmanFordæ±‚æœ€å¤škæ¡è¾¹çš„æœ€çŸ­è·¯

> åº”ç”¨åœºæ™¯ï¼šæ±‚è¾¹æ•°æœ€å¤§æ˜¯kçš„æœ€çŸ­è·¯

å¾ªç¯kæ¬¡ï¼Œæ¯ä¸€æ¬¡åªç”¨ä¸Šä¸€è½®çš„distæ•°ç»„æ›´æ–°ï¼Œæ‰€ä»¥åœ¨å¾ªç¯è¾¹æ—¶æŠŠdistä¿å­˜ä¸ºtmpï¼Œé˜²æ­¢æœ¬è½®ä½¿ç”¨äº†è¿™ä¸€è½®çš„distå€¼

```java
	static Edge[] edges = new Edge[N];
    static int[] dist = new int[N],tmp = new int[N];
	static void bellmanFord() {
            Arrays.fill(dist,INF);
            dist[1]=0;
            for(int i=0;i<k;i++) {//å¾ªç¯kæ¬¡,ä»£è¡¨
            	//å¤åˆ¶å½“å‰çš„distï¼Œè¡¨ç¤ºä¸Šä¸€è½®çš„distç»“æœï¼Œè¿™æ ·æ‰èƒ½æ‰¾åˆ°è¾¹æ•°<=kçš„
                tmp = dist.clone();
                for(int j=0;j<m;j++) {
                    Edge e = edges[j];
                    dist[e.b] = Math.min(dist[e.b], tmp[e.a]+e.c);
                }
            }
        }
    class Edge{
        int a,b,c;
        public Edge(int a,int b,int c) {
            this.a = a;
            this.b = b;
            this.c = c;
        }
    }
```

### æ‹“æ‰‘æ’åº

> åªæœ‰æœ‰å‘æ— ç¯å›¾æ‰æœ‰æ‹“æ‰‘åºåˆ—ï¼Œå›¾ä¸ä¸€å®šè¦è¿é€š

```
1.æ‰€æœ‰å…¥åº¦ä¸º0çš„ç»“ç‚¹å…¥é˜Ÿ
2.å½“é˜Ÿåˆ—ï¼ˆæ ˆï¼‰ä¸ä¸ºç©ºæ—¶å¾ªç¯
    2.1å–é˜Ÿå¤´,å‡ºé˜Ÿ,è®°å½•åºåˆ—
    2.2éå†é˜Ÿå¤´é¡¶ç‚¹æŒ‡å‘çš„é¡¶ç‚¹ï¼Œä½¿è¯¥é¡¶ç‚¹å…¥åº¦-1
    2.3å…¥åº¦ä¸º0æ—¶å…¥é˜Ÿ
```
æ—¶é—´å¤æ‚åº¦ Oï¼ˆV+Eï¼‰
æ³¨æ„ï¼š 

- cntç”¨æ¥å­˜å‚¨å·²ç»è¾“å‡ºçš„é¡¶ç‚¹çš„ä¸ªæ•°
- åªæœ‰æœ‰å‘æ— ç¯å›¾æ‰æœ‰æ‹“æ‰‘åºåˆ—  
- å¦‚æœä¸€ä¸ªå›¾æœ‰ç¯ï¼Œæœ€åç»ˆæ­¢å¾ªç¯æ—¶çš„cntä¸€å®šæ˜¯å°äºnçš„
- æ‰€ä»¥åªéœ€åˆ¤æ–­cnt==n? å¦‚æœç›¸ç­‰ï¼Œå°±æœ‰æ‹“æ‰‘åºåˆ—ï¼Œå¦åˆ™å°±ä¸å­˜åœ¨

```java

	int[] d = new int[N];//å­˜æ”¾å…¥åº¦
	int[] print = new int[N];//è®°å½•ç­”æ¡ˆ
	int cnt;
	
	static boolean topSort() {
		Queue<Integer> q = new LinkedList<Integer>();
		for(int i=1;i<=n;i++) {
			if(d[i]==0)
				q.add(i);
		}
		while(q.size()>0) {
			Integer top = q.poll();
			print[cnt++] = top;
			for(int i=h[top];i!=-1;i=ne[i]) {
				int j = e[i];
				d[j]--;
				if(d[j]==0) {
					q.add(j);
				}
			}
		}
		return n==cnt;
	}
	public static void main(String[] args) {
		Scanner sc = new Scanner(System.in);
		
		n = sc.nextInt();
		m = sc.nextInt();
		for(int i=1;i<=m;i++) {
			int a = sc.nextInt();
			int b = sc.nextInt();
			int w = sc.nextInt();
			add(a,b,w);
            d[b] += 1;
		}
	}
```

### æŸ“è‰²æ³•åˆ¤å®šäºŒåˆ†å›¾

- äºŒåˆ†å›¾æ¦‚å¿µï¼š
  - äºŒåˆ†å›¾ï¼šå›¾ä¸­ç‚¹é€šè¿‡ç§»åŠ¨èƒ½åˆ†æˆå·¦å³ä¸¤éƒ¨åˆ†ï¼Œå·¦ä¾§çš„ç‚¹åªå’Œå³ä¾§çš„ç‚¹ç›¸è¿ï¼Œå³ä¾§çš„ç‚¹åªå’Œå·¦ä¾§çš„ç‚¹ç›¸è¿ã€‚
  - ä¸€ä¸ªå›¾æ˜¯äºŒåˆ†å›¾çš„å……è¦æ¡ä»¶æ˜¯ï¼šå½“ä¸”ä»…å½“å›¾ä¸­ä¸å«æœ‰å¥‡æ•°ç¯
  - å¥‡æ•°ç¯ï¼šç”±å¥‡æ•°æ¡è¾¹å½¢æˆçš„ä¸€ä¸ªç¯

- åº”ç”¨ï¼šåˆ¤æ–­å›¾æ˜¯å¦æ˜¯äºŒåˆ†å›¾
- æ—¶é—´å¤æ‚åº¦Oï¼ˆnï¼‰
- æŸ“è‰²æ³•æ€è·¯ï¼š

1. å¼€å§‹å¯¹ä»»æ„ä¸€æœªæŸ“è‰²çš„é¡¶ç‚¹æŸ“è‰²ã€‚

2. åˆ¤æ–­å…¶ç›¸é‚»çš„é¡¶ç‚¹ä¸­ï¼Œè‹¥æœªæŸ“è‰²åˆ™å°†å…¶æŸ“ä¸Šå’Œç›¸é‚»é¡¶ç‚¹ä¸åŒçš„é¢œè‰²ã€‚

3. è‹¥å·²ç»æŸ“è‰²ä¸”é¢œè‰²å’Œç›¸é‚»é¡¶ç‚¹çš„é¢œè‰²ç›¸åŒåˆ™è¯´æ˜ä¸æ˜¯äºŒåˆ†å›¾ï¼Œè‹¥é¢œè‰²ä¸åŒåˆ™ç»§ç»­åˆ¤æ–­ã€‚

4. bfså’Œdfså¯ä»¥æå®šï¼

```java
		static int[] color = new int[N];

		//Uæ˜¯èŠ‚ç‚¹ç¼–å·ï¼Œcæ˜¯èŠ‚ç‚¹uåº”è¯¥å˜æˆçš„é¢œè‰²
        static boolean dfs(int u,int c) {
            color[u] = c;
            for(int i=h[u];i!=-1;i=ne[i]) {
                int j = e[i];
                if(color[j]==0) {
                    //return dfs(j,c==1?2:1);//è¿™ä¹ˆå†™ä¼šWA
                    boolean res = dfs(j,c==1?2:1);
                    if(res==false) return false;//åªæœ‰å½“è¿”å›falseçš„æ—¶å€™ï¼Œæ‰èƒ½å¾—åˆ°ï¼šä¸æ˜¯äºŒåˆ†å›¾çš„ç»“è®ºï¼Œå¦‚æœè¿”å›trueä¸èƒ½è¿”å›å€¼ï¼Œè€Œè¦ç»§ç»­æœç´¢
                }else if(c==color[j])
                    return false;
            }
            return true;
        }

		int flag = 1;
        for(int i=1;i<=n;i++) {
            if(color[i]==0) {
                boolean res = dfs(i,1);
                if(res==false) {
                    flag = 0;
                    break;
                }
            }
        }
		if(flag==1) System.out.println("Yes");
        else System.out.println("No");

```

### åŒˆç‰™åˆ©ç®—æ³•

äºŒåˆ†å›¾æœ€å¤§åŒ¹é…é—®é¢˜

>  https://www.acwing.com/activity/content/code/content/6469504/

- åº”ç”¨ï¼šåŒˆç‰™åˆ©ç®—æ³•è§£å†³äºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…é—®é¢˜
- æ€è·¯ï¼š
  - ç±»æ¯”ï¼šä¸€å¼ æ¡Œå·¦å³ä¸¤æ—åˆ†åˆ«æœ‰n1ä¸ªç”·ç”Ÿ,n2ä¸ªå¦¹å­ã€‚å›¾ä¸­çš„è¾¹æ˜¯æš§æ˜§çš„å¯¹è±¡ã€‚ç„¶åçœ‹çœ‹æœ€å¤šèƒ½æœ‰å¤šå°‘å¯¹åœ¨ä¸€èµ·ã€‚
  - æšä¸¾å·¦è¾¹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¾æ¬¡åˆ¤æ–­å½“å‰å·¦è¾¹èŠ‚ç‚¹çš„æ‰€æœ‰å³è¾¹æš§æ˜§å¯¹è±¡ï¼Œå¦‚æœå³è¾¹çš„æš§æ˜§å¯¹è±¡æ²¡æœ‰å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ç›´æ¥åœ¨ä¸€èµ·ï¼›å¦åˆ™å¦‚æœæš§æ˜§å¯¹è±¡å·²ç»æœ‰å¯¹è±¡äº†ï¼Œé‚£ä¹ˆå°±æ‰¾åˆ°è¿™ä¸ªå¦¹å­çš„å¯¹è±¡ï¼Œä»–åœ¨ä»–çš„æš§æ˜§å¯¹è±¡ä¸­é‡æ–°å»æ‰¾ï¼Œçœ‹çœ‹ä»–èƒ½ä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªå…¶ä»–çš„æš§æ˜§å¯¹è±¡ï¼Œå¦‚æœèƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªï¼Œé‚£å°±è®©ä»–ä»¬åœ¨ä¸€èµ·ï¼Œä»è€Œè¿™ä¸ªå¦¹å­å°±æ˜¯æˆ‘çš„äº†ã€‚

- æ—¶é—´å¤æ‚åº¦Oï¼ˆm*nï¼‰,ä½†æ˜¯å®é™…çš„æ‰§è¡Œæ•ˆç‡é«˜å¾ˆå¤š
- æ¨¡æ¿

```java
		//match[i]=jè¡¨ç¤ºå³åŠè¾¹èŠ‚ç‚¹iå½“å‰åŒ¹é…çš„æ˜¯å·¦åŠè¾¹çš„èŠ‚ç‚¹j
		//stæ˜¯ä¸´æ—¶é¢„å®šæ•°ç»„ï¼Œst[i]è¡¨ç¤ºå½“å‰è½®æ¬¡çš„å³åŠè¾¹èŠ‚ç‚¹iæ˜¯å¦è¢«æ ‡è®°è¿‡
		static int[] match = new int[N],st = new int[N];
		
		//findå‡½æ•°ï¼šå·¦è¾¹èŠ‚ç‚¹uå‘å³è¾¹åŒ¹é…ï¼Œè¿”å›å€¼ä¸ºæ˜¯å¦èƒ½å¤ŸåŒ¹é…æˆåŠŸ
		//è¿”å›å€¼ï¼šå¦‚æœåŠ å…¥xæ¥å‚ä¸æ¨¡æ‹Ÿé…å¯¹,ä¼šä¸ä¼šä½¿åŒ¹é…æ•°å¢å¤š
		static boolean find(int u) {
			for(int i=h[u];i!=-1;i=ne[i]) {
				int j = e[i];
				if(st[j]==0) {//å¦‚æœåœ¨è¿™ä¸€è½®æ¨¡æ‹ŸåŒ¹é…ä¸­,è¿™ä¸ªå¥³å­©å°šæœªè¢«é¢„å®š
					st[j] = 1;//é‚£uå°±é¢„å®šè¿™ä¸ªå¥³å­©äº†
					//å¦‚æœå¥³å­©jæ²¡æœ‰ç”·æœ‹å‹ï¼Œæˆ–è€…å¥¹åŸæ¥çš„ç”·æœ‹å‹èƒ½å¤Ÿé¢„å®šå…¶å®ƒå–œæ¬¢çš„å¥³å­©ã€‚é…å¯¹æˆåŠŸ,æ›´æ–°match
					if(match[j]==0 || find(match[j])) {
						match[j] = u;
						return true;
					}
				}
			}
			//è‡ªå·±ä¸­æ„çš„å…¨éƒ¨éƒ½è¢«é¢„å®šäº†ã€‚é…å¯¹å¤±è´¥ã€‚
			return false;
		}

		//æšä¸¾æ‰€æœ‰ç”·ç”Ÿï¼Œä¾æ¬¡è¿›è¡ŒåŒ¹é…
        for(int i=1;i<=n1;i++) {
            //å› ä¸ºæ¯æ¬¡æ¨¡æ‹ŸåŒ¹é…çš„é¢„å®šæƒ…å†µéƒ½æ˜¯ä¸ä¸€æ ·çš„æ‰€ä»¥æ¯è½®æ¨¡æ‹Ÿéƒ½è¦åˆå§‹åŒ–
            Arrays.fill(st,0);//æ¯ä¸€è½®éƒ½è¿›è¡ŒåŒ¹é…
            if(find(i)) ans++;
        }
```



### LCAï¼ˆæœ€è¿‘å…¬å…±ç¥–å…ˆï¼‰

> å…ˆçœ‹STè¡¨
>
> STè¡¨æ˜¯åœ¨çº¿æ€§è¡¨ä¸Šåšå€å¢ï¼Œç»´æŠ¤çš„æ˜¯å…·ä½“åŒºé—´çš„å®é™…å€¼ï¼Œä¸éœ€è¦ç»´æŠ¤ä½ç½®ï¼Œå› ä¸ºä½ç½®å¯ä»¥Oï¼ˆ1ï¼‰ç®—
>
> è€ŒLCAæ˜¯åœ¨æ ‘ä¸Šå€å¢ï¼Œé»˜è®¤ç»´æŠ¤çš„æ˜¯èŠ‚ç‚¹ç¼–å·ï¼Œä¹Ÿå¯ä»¥å†å¢åŠ ä¸€ç»´`dp[i][j]`è¡¨ç¤ºè·¯å¾„ä¸Šçš„é€‰æ³•é›†åˆï¼ˆè§lqbçœŸé¢˜ï¼šï¼‰

- depth[i] = jè¡¨ç¤ºèŠ‚ç‚¹içš„å±‚æ•°ï¼ˆæ·±åº¦ï¼‰æ˜¯j

- `fa[u][i]`è¡¨ç¤ºuå‘ä¸Šè·³2^iå±‚çš„ç¥–å…ˆèŠ‚ç‚¹ï¼Œç¬¬äºŒç»´å¼€å¤šå¤§å–å†³äºèŠ‚ç‚¹ä¸ªæ•°æœ€å¤§å€¼ï¼Œæ¯”å¦‚èŠ‚ç‚¹æœ‰5e5ï¼Œé‚£ä¹ˆç¬¬äºŒç»´å°±å¼€åˆ°20ï¼Œå› ä¸º2^20 = 1e6ï¼Œæœ€å¤§æŒ‡æ•°å°±æ˜¯19

- èŠ‚ç‚¹ç¼–å·æ˜¯ä»1å¼€å§‹ï¼Œ0ä¼šä½œä¸ºè¶…å‡ºè¾¹ç•Œçš„å“¨å…µ

- æ€è·¯

  - 1.é¢„å¤„ç†stè¡¨ï¼ˆå€å¢ï¼‰

    ä»å°åˆ°å¤§æšä¸¾ï¼Œ`fa[u][i] = fa[fa[u][i-1]][i-1]	`

  - 2.lcaæŸ¥è¯¢ï¼ˆäºŒè¿›åˆ¶æ‹†åˆ†ï¼‰ä»å¤§åˆ°å°æšä¸¾

    - 1.æŠŠa,bè·³åˆ°åŒä¸€å±‚
    - 2.a,båŒæ—¶å‘ä¸Šè·³

```java
		static int[] depth = new int[N];//å­˜å‚¨èŠ‚ç‚¹çš„å±‚æ•°
		static int[][] fa = new int[N][20];//æœ€å¤§2^19æ¬¡æ–¹
		static int n,m,start;
		//stè¡¨é¢„å¤„ç†ï¼ˆè®¡ç®—å€å¢æ•°ç»„ï¼‰Oï¼ˆnlognï¼‰
		static void dfs(int u,int father) {
			depth[u] = depth[father]+1;
			fa[u][0] = father;
			for(int i=1;i<=19;i++) //é€’æ¨
				fa[u][i] = fa[fa[u][i-1]][i-1];//å…ˆè·³2^i-1,å†è·³2^i-1

			for(int i=h[u];i!=-1;i=ne[i]) {
				int j = e[i];
				if(j==father) continue;
				dfs(j,u);
			}
		}
		
		//lcaæ±‚å…¬å…±ç¥–å…ˆOï¼ˆlognï¼‰
		static int lca(int a,int b) {
			if(depth[a]<depth[b]) {
				int t = a;
				a = b;
				b = t;
			}
			//1.æŠŠaå’Œbç§»åˆ°åŒä¸€å±‚
			for(int i=19;i>=0;i--) 
                //å¦‚æœè·³2^iå±‚è¿˜æ˜¯åœ¨bçš„ä¸‹é¢ï¼Œå°±è·³åˆ°è¿™ä¸ªä½ç½®
				if(depth[fa[a][i]]>=depth[b])
					a = fa[a][i];
			if(a==b) return b;
			//2.aå’ŒbåŒæ—¶å‘ä¸Šæ‰¾åˆ°æœ€è¿‘å…¬å…±ç¥–å…ˆçš„ä¸‹ä¸€å±‚èŠ‚ç‚¹
			for(int i=19;i>=0;i--) {
                //å¦‚æœaå’Œbè·³ä¸Šå»ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼ˆè¿™é‡Œçš„æ¡ä»¶èˆå»äº†è·³å‡ºè¾¹ç•Œçš„æƒ…å†µï¼‰
				if(fa[a][i] != fa[b][i]) {
					a = fa[a][i];
					b = fa[b][i];
				}	
			}
			return fa[a][0];//å†å‘ä¸Šèµ°1å±‚å°±åˆ°äº†lcaèŠ‚ç‚¹äº†
		}
		
		//ä¸»å‡½æ•°
        dfs(start,0);//ä¸èƒ½æ˜¯-1ï¼Œå› ä¸ºfatherè¦ç”¨åˆ°depth
        m = sc.nextInt();
        while(m-->0) {
            int x = sc.nextInt();
            int y = sc.nextInt();
            int ans = lca(x,y);
            if(ans==x) System.out.println(1);
            else if(ans==y) System.out.println(2);
            else System.out.println(0);
        }
```

![image-20230527165028501](images/image-20230527165028501.png)

- ä¾‹é¢˜
  - AcWing 1171. è·ç¦»ï¼ˆé¡¶ç‚¹è·ç¦»ï¼‰
  - AcWing 4962. æ™¯åŒºå¯¼æ¸¸ï¼ˆé¡¶ç‚¹è·ç¦»ï¼‰



### æ ‘ä¸Šå·®åˆ†

å·®åˆ†æ•°ç»„æ˜¯å¯ä»¥ç”¨Oï¼ˆ1ï¼‰å°†åŒºé—´å†…å…ƒç´ +cï¼Œæœ€ååªéœ€Oï¼ˆnï¼‰éå†æ•°ç»„ã€‚æ ‘ä¸Šå·®åˆ†ç”¨äºé«˜æ•ˆè§£å†³æ ‘ä¸Šçš„å°†åŒºé—´å†…å…ƒç´ +cã€‚

#### æŒ‰ç‚¹å·®åˆ†

å®šä¹‰æ ‘ä¸Šå·®åˆ†æ•°ç»„pï¼Œ`p[i]+=c`è¡¨ç¤ºå°†æ ‘ä¸­æ ¹èŠ‚ç‚¹å‘èŠ‚ç‚¹içš„è·¯å¾„ä¸Šçš„æ‰€æœ‰è¾¹çš„å€¼éƒ½+c,æ‰€ä»¥æ€ä¹ˆå°†æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹a,bè·¯å¾„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½+cå‘¢ï¼Œæ“ä½œå°±æ˜¯:

```
p[a]+=c;
p[b]+=c;
p[lca]-=c;
p[fa[lca][0]]-=c
```

å…¶ä¸­lcaè¡¨ç¤ºa,bçš„æœ€è¿‘å…¬å…±ç¥–å…ˆ,`fa[lca][0]`è¡¨ç¤ºçš„æ˜¯èŠ‚ç‚¹lcaçš„çˆ¶èŠ‚ç‚¹

![QQæˆªå›¾20230601125242.png](https://cdn.acwing.com/media/article/image/2023/06/01/61195_286068b500-QQæˆªå›¾20230601125242.png) 

**æ‹“å±•**ï¼šæ ‘ä¸Šé¡¶ç‚¹é—´çš„è·ç¦»

```java
è·ç¦»å…¬å¼ï¼š
	é¡¶ç‚¹aåˆ°é¡¶ç‚¹bçš„è·ç¦» =  dist[a] + dist[b] - 2*dist[lca]
	
	æ–°å¢ä¸€ä¸ªæ•°ç»„distï¼Œè¡¨ç¤ºé¡¶ç‚¹åˆ°èµ·ç‚¹çš„è·ç¦»
	
	distæ›´æ–°çš„æ–¹å¼å¦‚ä¸‹ï¼š
	static void dfs(int u,int father) {
        dep[u] = dep[father]+1;
        fa[u][0] = father;
        for(int i=1;i<19;i++)
            fa[u][i] = fa[fa[u][i-1]][i-1];
        for(int i=h[u];i!=-1;i=ne[i]) {
            int j = e[i];
            if(j==father) continue;
            dist[j] = dist[u] + w[i];
            dfs(j,u);
        }
    }
```





#### æŒ‰è¾¹å·®åˆ†

å¦‚æœè¦ç»´æŠ¤è¾¹çš„å·®åˆ†æ•°ç»„ï¼Œæ¯”å¦‚å¯¹æ ‘ä¸Ša,bè·¯å¾„ä¸Šçš„æ‰€æœ‰è¾¹éƒ½+cï¼Œæ“ä½œå°±æ˜¯:

```
p[a]+=c;
p[b]+=c;
p[lca(a,b)]-=2*c
```

è¿™é‡Œæ˜¯å°†**è¾¹ä¸‹æ”¾åˆ°èŠ‚ç‚¹**ï¼Œæ¯”å¦‚p[a] = bï¼Œè¡¨ç¤ºé¡¶ç‚¹aä¸ºä¸‹è¾¹ç•Œæ—¶çš„é‚£æ¡è¾¹

æœ€åä»æ ¹èŠ‚ç‚¹å‘ä¸‹éå†æ•´å¼ å›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹ï¼Œå…ˆé€’å½’å­èŠ‚ç‚¹ï¼Œå†å°†èŠ‚ç‚¹ä»ä¸‹å‘ä¸Šæ›´æ–°å‰ç¼€å’Œæ•°ç»„ï¼ˆå·®åˆ†çš„æ±‚å’Œï¼‰ï¼Œæ¿å­å¦‚ä¸‹

```
    //å…ˆé€’åå½’
	static void dfs(int u,int father) {
		for(int i=h[u];i!=-1;i=ne[i]) {
			int j = e[i];
			if(j==father) continue;
			dfs(j,u);
			chafen[u] += chafen[j];
			//å¦‚æœè¦åœ¨è¿™åˆ¤æ–­è¾¹ï¼Œæ˜¯ä½¿ç”¨chafen[j]è¿™æ¡è¾¹ï¼Œå› ä¸ºè¿™æ¡è¾¹çš„å€¼å·²ç»ç¡®å®šï¼Œè€Œchafen[u]è¿˜æ²¡ç¡®å®š
		}
	}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ ‘ä¸Šå·®åˆ†ç®—æ³•æ¶‰åŠåˆ°LCAï¼Œå¦‚æœæ˜¯ç”¨å€å¢æ±‚LCAï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ±‚lcaæ˜¯Oï¼ˆlognï¼‰çš„å¤æ‚åº¦ï¼›å¦‚æœæ˜¯ç”¨Tarjanæ±‚LCAï¼Œé‚£ä¹ˆé¢„å¤„ç†åæ¯ä¸€ä¸ªæ±‚lcaæ˜¯Oï¼ˆ1ï¼‰çš„

- ä¾‹é¢˜
  - AcWing 352. é—‡ã®ï¦šé–ï¼ˆè¾¹çš„æ ‘ä¸Šå·®åˆ†ï¼‰
  - luogu P3258 æ¾é¼ çš„æ–°å®¶ï¼ˆé¡¶ç‚¹çš„æ ‘ä¸Šå·®åˆ†ï¼‰
  - 



## æ’åºç®—æ³•

### å¿«é€Ÿæ’åº

æ—¶é—´å¤æ‚åº¦Oï¼ˆnlognï¼‰

> é€’å½’æ ‘çš„é«˜åº¦æ˜¯lognï¼Œæ¯ä¸€å±‚çš„å…ƒç´ å’Œè¿˜æ˜¯nï¼Œæ‰€ä»¥nlogn

```java
        static void quickSort(int[] arr,int l,int r) {
            if(l>=r) return ;
            int x = arr[l],i = l-1,j = r+1;
            while(i<j) {
                while(arr[++i] < x);
                while(arr[--j] > x);
                if(i<j) {
                    int t = arr[i];
                    arr[i] = arr[j];
                    arr[j] = t;
                }
            }
            quickSort(arr, l, j);
            quickSort(arr, j+1, r);
        }
```

> å¿«æ’å¯ä»¥æ±‚ç¬¬kå¤§çš„æ•°

### å½’å¹¶æ’åº

```java
		static int[] tmp = new int[N];//ä¸´æ—¶æ•°ç»„
        static void mergeSort(int[] a,int l,int r) {
            if(l>=r) return;
            int mid = l + r>>1;
            mergeSort(a, l, mid);
            mergeSort(a, mid+1, r);
            int k=0;//ä¸´æ—¶æ•°ç»„tmpçš„ä¸‹æ ‡è®¡æ•°
            int i=l,j=mid+1;
            while(i<=mid && j<=r) {
                if(a[i]<=a[j]) tmp[k++] = a[i++];
                else tmp[k++] = a[j++];
            }
            while(i<=mid) tmp[k++] = a[i++];
            while(j<=mid) tmp[k++] = a[j++];

            for(i=l,j=0;i<=r && j<k;i++,j++) {
                a[i] = tmp[j];
            }
        }
```

> å½’å¹¶æ’åºå¯ä»¥ç”¨æ¥æ±‚é€†åºå¯¹çš„æ•°é‡

#### é€†åºå¯¹çš„æ•°é‡

åˆ†æ²»çš„æ€æƒ³ï¼Œç”¨Oï¼ˆnlognï¼‰çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ±‚å‡ºä¸€ä¸ªæ•°åˆ—ä¸­é€†åºå¯¹çš„ä¸ªæ•°ï¼Œä¿®æ”¹å½’å¹¶æ’åºçš„ä»£ç 

```java

        //è¿”å›åŒºé—´å†…å…ƒç´ çš„é€†åºå¯¹çš„ä¸ªæ•°
        static long getNixudui(int[] q,int l,int r) {
            if(l>=r) return 0;
            int mid = l+r>>1;
            long res = getNixudui(q, l, mid) + getNixudui(q, mid+1, r);

            int i = l, j = mid+1;
            int k = 0;
            while(i<=mid && j<=r) {
                if(q[i]<=q[j]) tmp[k++] = q[i++];
                else {
                    res += mid - i +1;//å½“å‰jçš„é€†åºå¯¹çš„ä¸ªæ•°
                    tmp[k++] = q[j++];
                }
            }
            while(i<=mid) tmp[k++] = q[i++];
            while(j<=r) tmp[k++] = q[j++];
            for(i = l,j = 0;i<=r;i++,j++)
                q[i] = tmp[j];
            return res;
        }

é“¾æ¥ï¼šhttps://www.acwing.com/activity/content/code/content/5530302/
```

> æ³¨æ„è¿™é‡Œåªèƒ½å›ºå®šjï¼Œå¦‚æœå›ºå®šiæ‰¾å³è¾¹æ¯”å®ƒå°çš„ï¼Œä¼šæ‰¾ä¸å…¨



ä¹Ÿå¯ä»¥ç”¨æ ‘çŠ¶æ•°ç»„

```java
        Node[] arr = new Node[N];
        int[] lisanhua = new int[N];
		//ç¦»æ•£åŒ–
        for(int i=1;i<=n;i++){
            arr[i] = new Node(nums[i],i);
        }
        Arrays.sort(arr,1,n+1,(a,b)->a.val-b.val);
        for(int i=1;i<=n;i++)
            lisanhua[arr[i].id] = i;
		//è®°å½•ä¸ªæ•°
        int cnt = 0;
        for(int i=n;i>0;i--){//ä»åå‘å‰æšä¸¾
            cnt += query(lisanhua[i]-1);//æ‰¾åˆ°å°äºlisanhua[i]çš„ä¸ªæ•°
            // System.out.println(query(lisanhua[i]-1));
            add(lisanhua[i],1);
        }
        return cnt;
```







## åšå¼ˆè®º

> è‘£æ™“å…¥é—¨
>
> å·¦ç¥è®²çš„ç»†ï¼šhttps://www.bilibili.com/video/BV1N94y1T7Mb/?spm_id_from=333.999.0.0&vd_source=9df13446957cfa1b1efd5650c5e3a393

- åŸºæœ¬æ¦‚å¿µ
  -  å…ˆæ‰‹å¿…èƒœçŠ¶æ€ï¼šå…ˆæ‰‹è¿›è¡ŒæŸä¸€ä¸ªæ“ä½œï¼Œç•™ç»™åæ‰‹æ˜¯ä¸€ä¸ªå¿…è´¥çŠ¶æ€æ—¶ï¼Œå¯¹äºå…ˆæ‰‹æ¥è¯´æ˜¯ä¸€ä¸ªå¿…èƒœçŠ¶æ€ã€‚å³å…ˆæ‰‹å¯ä»¥èµ°åˆ°æŸä¸€ä¸ªå¿…è´¥çŠ¶æ€ã€‚
  - å…ˆæ‰‹å¿…è´¥çŠ¶æ€ï¼šå…ˆæ‰‹æ— è®ºå¦‚ä½•æ“ä½œï¼Œç•™ç»™åæ‰‹éƒ½æ˜¯ä¸€ä¸ªå¿…èƒœçŠ¶æ€æ—¶ï¼Œå¯¹äºå…ˆæ‰‹æ¥è¯´æ˜¯ä¸€ä¸ªå¿…è´¥çŠ¶æ€ã€‚å³å…ˆæ‰‹èµ°ä¸åˆ°ä»»ä½•ä¸€ä¸ªå¿…è´¥çŠ¶æ€ã€‚

- ç»†èŠ‚ï¼š

  - ä¸‹é¢çš„ä¾‹å­çš„æœ€ç»ˆæ€éƒ½æ˜¯å¿…è´¥æ€ï¼Œå¹¶ä¸”è¿™ä¸ªæœ€ç»ˆæ€éƒ½æ˜¯æ— æ±‚å¯æ‹¿ï¼Œæ²¡æœ‰ä»»ä½•é€‰æ‹©æ—¶å°±è¾“

    - å¦‚æœå‘Šè¯‰äº†å¿…è´¥æ€ä¸æ˜¯æ²¡æœ‰é€‰æ‹©çš„æƒ…å†µæ—¶ï¼Œé‚£å°±æ§åˆ¶åˆå§‹å€¼

      ä¾‹é¢˜ï¼šlqbçœŸé¢˜ï¼šå–çƒæ¸¸æˆ

    - å¦‚æœé¢˜ç›®å‘Šè¯‰äº†å¿…èƒœæ€çš„æƒ…å†µï¼Œè¦è½¬æ¢æˆå¿…è´¥æ€å»åšã€‚

      ä¾‹é¢˜ï¼šå‰ªçº¸æ¸¸æˆ

### Nimæ¸¸æˆï¼šçŸ³å­

- é¢˜æ„ï¼šç»™å®š n å †çŸ³å­ï¼Œä¸¤ä½ç©å®¶è½®æµæ“ä½œï¼Œæ¯æ¬¡æ“ä½œå¯ä»¥ä»ä»»æ„ä¸€å †çŸ³å­ä¸­æ‹¿èµ°ä»»æ„æ•°é‡çš„çŸ³å­ï¼ˆå¯ä»¥æ‹¿å®Œï¼Œä½†ä¸èƒ½ä¸æ‹¿ï¼‰ï¼Œæœ€åæ— æ³•è¿›è¡Œæ“ä½œçš„äººè§†ä¸ºå¤±è´¥ã€‚

- ç»“è®ºï¼š

  ![QQæˆªå›¾20230519155452.png](https://cdn.acwing.com/media/article/image/2023/05/19/61195_745c6773f6-QQ%E6%88%AA%E5%9B%BE20230519155452.png)

- è¯æ˜

![QQå›¾ç‰‡20230520143018.png](images/61195_ae2016f6f6-QQ%E5%9B%BE%E7%89%8720230520143018.png)

- æ‹“å±•

  æœ¬é¢˜è¿˜å¯ä»¥æ±‚å‡ºå¦‚æœå…ˆæ‰‹å¿…èƒœï¼Œé‚£ä¹ˆè¾“å‡ºå…ˆæ‰‹çš„ç¬¬ä¸€æ¬¡é€‰æ‹©ã€‚ä»£ç å¦‚ä¸‹

  ![QQæˆªå›¾20230520143508.png](images/61195_a5bf0405f6-QQ%E6%88%AA%E5%9B%BE20230520143508.png)

### Nimæ¸¸æˆï¼šå°é˜¶

å…¶å®é˜¶æ¢¯åšå¼ˆç»è¿‡è½¬æ¢å¯ä»¥å˜ä¸ºNim..æŠŠæ‰€æœ‰å¥‡æ•°é˜¶æ¢¯çœ‹æˆNå †çŸ³å­..åšnim..æŠŠçŸ³å­ä»å¥‡æ•°å †ç§»åŠ¨åˆ°å¶æ•°å †å¯ä»¥ç†è§£ä¸ºæ‹¿èµ°çŸ³å­..å°±ç›¸å½“äºå‡ ä¸ªå¥‡æ•°å †çš„çŸ³å­åœ¨åšNim

- ç»“è®ºï¼šå¥‡æ•°é¡¹å¼‚æˆ–å’Œä¸ç­‰äº0å°±æ˜¯å…ˆæ‰‹å¿…èƒœ

![image-20230520145530342](images/image-20230520145530342.png)

- æ‹“å±•

  ![image-20230520151031503](images/image-20230520151031503.png)

### SGå‡½æ•°æ¦‚å¿µ

![image-20230520151931480](images/image-20230520151931480.png)

- SGå‡½æ•°ç†è®ºï¼š**å¤šä¸ªç‹¬ç«‹å±€é¢çš„SGå€¼ï¼Œç­‰äºè¿™äº›å±€é¢SGå€¼çš„å¼‚æˆ–å’Œã€‚**

- SGå®šç†çš„æœ€ç»ˆçŠ¶æ€æ˜¯å¿…è´¥æ€ï¼ŒSG(x) = 0 è¡¨ç¤ºxæ˜¯å¿…è´¥æ€

- SGå‡½æ•°**æ‰“è¡¨æ‰¾è§„å¾‹**ï¼Œæ‰¾ä¸åˆ°è§„å¾‹å°±ä¿ç•™ä»£ç 

  å› ä¸ºSGå‡½æ•°èƒ½å­˜ï¼Œæ¯ä¸ªçŠ¶æ€å…·ä½“çš„å€¼ï¼Œçœ‹è°æ˜¯0

  å¦‚æœæ²¡æœ‰SGå‡½æ•°ï¼Œä¸ç”¨SGå‡½æ•°ï¼Œå¯ä»¥ç”¨æ™®é€šçš„çº¿æ€§DPï¼Œæ‰¾åˆ°ä¸€ç§å¿…è´¥æ€ï¼Œç„¶åè¿”å›True False
  å¦‚æœæ˜¯å¤šä¸ªç‹¬ç«‹çš„äº‹ä»¶ï¼šå…ˆæ¨SGå‡½æ•°çš„è§„å¾‹ï¼Œå†æ±‚å¼‚æˆ–çš„è§„å¾‹ï¼ˆä»€ä¹ˆæƒ…å†µä¸‹å¼‚æˆ–å€¼ç­‰äº0ï¼šæ‰€æœ‰æƒ…å†µçš„sgå‡½æ•°ç›¸åŒï¼‰

- åšå¼ˆè®ºçš„é—®é¢˜æœ¬è´¨æ˜¯çº¿æ€§DPçš„é—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥ä¸ç®—SGå‡½æ•°ï¼Œç›´æ¥ç”¨DPå³å¯ï¼Œé‚£ä¹ˆSGå‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

  å› ä¸ºSGå‡½æ•°èƒ½å­˜ï¼Œæ¯ä¸ªçŠ¶æ€å…·ä½“çš„å€¼ï¼Œçœ‹è°æ˜¯0ï¼Œä»è€Œæ‰¾è§„å¾‹ï¼Œè€ŒDPçš„çŠ¶æ€åªæœ‰0å’Œ1ï¼Œä¸æ–¹ä¾¿æ‰¾è§„å¾‹

- å¦‚æœæš´åŠ›ç”¨DPåšæœ€å¥½å†™è®°å¿†åŒ–æœç´¢çš„å†™æ³•ï¼Œè€Œä¸è¦å†™é€’æ¨çš„å†™æ³•

  å› ä¸ºè®°å¿†åŒ–æœç´¢å®ç°äº†ï¼šç”¨åˆ°è°å†ç®—è°ï¼Œè€Œé€’æ¨å¤ªè€—æ—¶é—´

### SGå‡½æ•°æ¨¡æ¿

è®¡ç®—æ¯å †çŸ³å­çš„æ‰€æœ‰å˜åŒ–æƒ…å†µï¼šsgå‡½æ•°ï¼Œå†å¼‚æˆ–

```java
		static int[] sg = new int[N];//sgå‡½æ•°å€¼
		
		//sgå‡½æ•°åˆå§‹åŒ–
		Arrays.fill(sg,-1);//åˆå§‹åŒ–æˆè´Ÿæ•°
		
		//è®¡ç®—èŠ‚ç‚¹xçš„sgå‡½æ•°ï¼ˆè®°å¿†åŒ–æœç´¢ï¼‰
		static int calSg(int x) {
			if(sg[x]!=-1) return sg[x];
			HashSet<Integer> se = new HashSet<Integer>();
			
			//å…·ä½“çš„é€»è¾‘ï¼Œä¼šå˜
			for(int i=1;i<=k;i++) {
				if(x>=set[i])
					se.add(calSg(x-set[i]));
			}
			//è®¡ç®—mexï¼ˆä¸åœ¨seä¸­çš„æœ€å°çš„é0å…ƒç´ ï¼‰
			for(int i=0;;i++) {
				if(!se.contains(i)) {
					return sg[x] = i;
				}
			}
		}
		
		//ç­”æ¡ˆï¼š
		for(int i=1;i<=n;i++) {
			int x = sc.nextInt();
			res ^= calSg(x);
		}
		if(res!=0) System.out.println("Yes");
		else System.out.println("No");
```



> sgå‡½æ•°çš„ä¾‹å­ï¼Œå¦‚ä¸‹ï¼šé›†åˆã€‚

### SGå‡½æ•°ï¼šæœ‰å‘å›¾æ¸¸æˆ

è®¡ç®—kæšæ£‹å­çš„sgå€¼ï¼Œå†å¼‚æˆ–ï¼Œè®°å¿†åŒ–æœç´¢

![image-20230520154448694](images/image-20230520154448694.png)

### SGå‡½æ•°ï¼šé›†åˆ

è®¡ç®—sgå‡½æ•°æ—¶ï¼Œæšä¸¾æ•´ä¸ªé›†åˆï¼Œä¸éœ€è¦çœŸçš„å»ºå›¾

![image-20230520153906756](images/image-20230520153906756.png)



### Nimæ˜¯Sgå®šç†çš„ç‰¹ä¾‹

- æ™®é€šçš„Nimå®šç†å…¶å®å°±æ˜¯Sgå®šç†çš„ç‰¹ä¾‹ï¼Œåœ¨æ™®é€šçš„Nimä¸­ï¼Œsg(x)=xï¼Œæ‰€ä»¥ä¸åŒç®—æ¯ä¸ªèŠ‚ç‚¹xçš„sgå€¼äº†ï¼Œå› ä¸ºå°±æ˜¯xï¼Œæ‰€ä»¥å°±ç›¸å½“äºæ‰€æœ‰å€¼çš„å¼‚æˆ–ã€‚

  > åœ¨Nimä¸­ï¼Œæœ‰nå †çŸ³å­ï¼Œåˆ†åˆ«ç”»å‡ºnæ£µæ ‘ï¼Œæ ¹èŠ‚ç‚¹åˆ†åˆ«æ˜¯çŸ³å­çš„å€¼ï¼Œä¸‹é¢çš„å­èŠ‚ç‚¹éƒ½æ˜¯ä¸€æ¬¡æ“ä½œï¼Œè®¡ç®—nä¸ªæ ¹èŠ‚ç‚¹çš„sgå€¼ï¼Œæœ€åå¼‚æˆ–èµ·æ¥ï¼Œå¦‚æœé0å°±æ˜¯å…ˆæ‰‹å¿…èƒœ

  
  
  ![image-20230520153221800](images/image-20230520153221800.png)

### SGå‡½æ•°ï¼šäºŒç»´å­èŠ‚ç‚¹çš„sgå€¼

- é¢˜æ„ï¼šæœ‰Nå †çŸ³å­ï¼Œé€‰æ‹©ä¸€å †çŸ³å­ï¼ˆä¸ªæ•°æ˜¯xï¼‰ï¼ŒæŠŠä»–æ‹¿èµ°ï¼Œç„¶åå†æ·»åŠ ä¸¤å †çŸ³å­ï¼Œè¿™ä¸¤å †çŸ³å­ï¼Œæ¯å †çŸ³å­çš„æœ€å¤§å€¼æ˜¯x-1ï¼Œæœ€å°å€¼æ˜¯0ã€‚
- æ€è·¯ï¼šè¿™æ˜¯sgå‡½æ•°çš„é¢˜ï¼Œå…³é”®ç‚¹åœ¨äºï¼šä¸€å †çŸ³å­xå¯ä»¥è½¬ç§»å¾ˆå¤šä¸ªå­èŠ‚ç‚¹çŠ¶æ€ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹åˆæ˜¯äºŒç»´çš„ï¼Œå› ä¸ºæœ‰ä¸¤å †ï¼Œè¡¨ç¤ºä¸º(i,j)ï¼Œéœ€è¦è®¡ç®—è¿™ä¸ªäºŒç»´å­èŠ‚ç‚¹çš„sgå€¼ï¼Œåˆç›¸å½“äºä¸€ä¸ªå±€é¢æ‹†åˆ†æˆäº†ä¸¤ä¸ªå±€é¢ï¼Œç”±SGå‡½æ•°ç†è®ºï¼Œå¤šä¸ªç‹¬ç«‹å±€é¢çš„SGå€¼ï¼Œç­‰äºè¿™äº›å±€é¢SGå€¼çš„å¼‚æˆ–å’Œã€‚å³sg(i,j) = sg(i)^sg(j)

- é¢˜è§£ï¼šhttps://www.acwing.com/activity/content/code/content/6473987/

### SGå‡½æ•°ï¼šå‰ªçº¸æ¸¸æˆ

> æœ¬é¢˜æ˜¯æ›´å¤æ‚çš„äºŒç»´æƒ…å†µï¼Œæ ¹èŠ‚ç‚¹èŠ‚ç‚¹æ˜¯äºŒç»´çš„ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹æ˜¯ä¸¤ä¸ªäºŒç»´èŠ‚ç‚¹

![image-20230520160822655](images/image-20230520160822655.png)

åšå¼ˆè®ºä¾‹é¢˜ï¼š

- lqbçœŸé¢˜ï¼šåˆ†çŸ³å¤´ï¼ˆsgå‡½æ•°ï¼‰

  https://www.lanqiao.cn/problems/2241/learning/?page=1&first_category_id=1&sort=students_count&tags=%E5%8D%9A%E5%BC%88%E8%AE%BA

- lqbçœŸé¢˜ï¼šå–æ•°æ¸¸æˆï¼ˆsgå‡½æ•°+é›†åˆï¼‰









## è´ªå¿ƒ

- åŒºé—´çš„è´ªå¿ƒé—®é¢˜ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸Šæ¥å…ˆæŒ‰å·¦ç«¯ç‚¹æˆ–è€…å³ç«¯ç‚¹æ’åºï¼Œæ–¹æ³•ï¼šè€ƒè™‘åŒºé—´aè¢«åŒºé—´båŒ…å«çš„æƒ…å†µï¼Œæ¯”å¦‚åŒºé—´é€‰ç‚¹é—®é¢˜ï¼Œæ­¤æ—¶å°±é€‰æ‹©å°çš„åŒºé—´aï¼Œå†ç”»å›¾å¯¹æ¯”ä¸€ä¸‹ï¼Œå°±çŸ¥é“é€‰æ‹©æŒ‰ç…§å³ç«¯ç‚¹ï¼›æ¯”å¦‚åŒºé—´è¦†ç›–é—®é¢˜ï¼Œæ­¤æ—¶é€‰æ‹©åŒºé—´å¤§çš„åŒºé—´bï¼Œå°±æ˜¯å·¦ç«¯ç‚¹æ’åºã€‚

### åŒºé—´é€‰ç‚¹

- é¢˜æ„ï¼šç»™å®š Nä¸ªé—­åŒºé—´ [ai,bi]ï¼Œè¯·ä½ åœ¨æ•°è½´ä¸Šé€‰æ‹©å°½é‡å°‘çš„ç‚¹ï¼Œä½¿å¾—æ¯ä¸ªåŒºé—´å†…è‡³å°‘åŒ…å«ä¸€ä¸ªé€‰å‡ºçš„ç‚¹ã€‚è¾“å‡ºé€‰æ‹©çš„ç‚¹çš„æœ€å°æ•°é‡ã€‚

- è´ªå¿ƒç­–ç•¥ï¼šæ ¹æ®å³ç«¯ç‚¹å‡åº

- ç®—æ³•æ€è·¯ï¼šræ˜¯ç­‰åˆ°ans++ä¿®æ”¹åæ‰æ›´æ–°

  ```
  			Arrays.sort(arr,1,n+1,(a,b)->(a.b-b.b));
              int ans = 1;
              int r = arr[1].b;
              for(int i=2;i<=n;i++) {
                  if(arr[i].a > r) {
                      ans ++;
                      r = arr[i].b;
                  }
              }
  ```

### æœ€å¤§ä¸ç›¸äº¤åŒºé—´æ•°é‡

> æœ€å¤§ä¸ç›¸äº¤åŒºé—´æ•°==æœ€å°‘è¦†ç›–åŒºé—´ç‚¹æ•°

- é¢˜æ„ï¼šç»™å®š Nä¸ªé—­åŒºé—´ [ai,bi]ï¼Œè¯·ä½ åœ¨é€‰æ‹©è‹¥å¹²åŒºé—´ï¼Œä½¿å¾—é€‰ä¸­çš„åŒºé—´ä¹‹é—´äº’ä¸ç›¸äº¤ã€‚è¾“å‡ºå¯é€‰å–åŒºé—´çš„æœ€å¤§æ•°é‡ã€‚

- è´ªå¿ƒç­–ç•¥ï¼šæ ¹æ®å³ç«¯ç‚¹å‡åº

- ç®—æ³•æ€è·¯ï¼šræ˜¯ç­‰åˆ°ans++ä¿®æ”¹åæ‰æ›´æ–°

  ```
  æœ¬é¢˜ä»£ç å’ŒåŒºé—´é€‰ç‚¹ä»£ç å®Œå…¨ä¸€æ ·
  ```

### åŒºé—´è¦†ç›–

- é¢˜æ„ï¼šç»™å®š Nä¸ªé—­åŒºé—´ [ai,bi]ï¼Œä»¥åŠä¸€ä¸ªçº¿æ®µåŒºé—´[s,t]ã€‚è¯·ä½ åœ¨é€‰æ‹©å°½é‡å°‘çš„åŒºé—´ï¼Œå°†æŒ‡å®šçº¿æ®µåŒºé—´å®Œå…¨è¦†ç›–ã€‚

- è´ªå¿ƒç­–ç•¥ï¼šæ ¹æ®å·¦ç«¯ç‚¹å‡åº

- ç®—æ³•æ€è·¯ï¼šåŒæŒ‡é’ˆæ‰¾åˆ°åŒºé—´å·¦ç«¯ç‚¹åœ¨så‰é¢ï¼Œå³ç«¯ç‚¹çš„æœ€å¤§å€¼ï¼Œç„¶åå°±é€‰æ‹©è¯¥åŒºé—´ï¼Œä¸‹ä¸€è½®çš„så°±å˜æˆäº†å½“å‰åŒºé—´å³ç«¯ç‚¹

  ```
  			for(int i=1;i<=n;i++) {
                  int j = i,r = -0x3f3f3f3f;//ræ˜¯å³ç«¯ç‚¹æœ€å¤§å€¼
                  //æ‰¾åˆ°å³ç«¯ç‚¹çš„æœ€å¤§å€¼
                  while(j<=n && arr[j].l<=start) {
                      r = Math.max(r,arr[j].r);
                      j++;
                  }
                  //å¦‚æœæœ€å¤§å€¼è¿˜æ˜¯åˆ°ä¸äº†ä¸‹ä¸€æ¬¡è¦†ç›–çš„èµ·ç‚¹ï¼Œå°±ç›´æ¥è¿”å›
                  if(r<start) {
                      break;
                  }
                  ans++;
                  start = r;
                  if(r>=end) {
                      flag = 1;
                      break;
                  }
                  i = j-1;//ä¸‹ä¸€è½®æŒ‡å®š
              }
  
  ä½œè€…ï¼šweiambt
  é“¾æ¥ï¼šhttps://www.acwing.com/activity/content/code/content/6481372/
  æ¥æºï¼šAcWing
  è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
  ```

### åŒºé—´åˆ†ç»„

- é¢˜æ„ï¼šç»™å®š Nä¸ªé—­åŒºé—´ [ai,bi]ï¼Œè¯·ä½ å°†è¿™äº›åŒºé—´åˆ†æˆè‹¥å¹²ç»„ï¼Œä½¿å¾—æ¯ç»„å†…éƒ¨çš„åŒºé—´ä¸¤ä¸¤ä¹‹é—´ï¼ˆåŒ…æ‹¬ç«¯ç‚¹ï¼‰æ²¡æœ‰äº¤é›†ï¼Œå¹¶ä½¿å¾—ç»„æ•°å°½å¯èƒ½å°

- è´ªå¿ƒç­–ç•¥ï¼šæ ¹æ®å·¦ç«¯ç‚¹å‡åº

- ç®—æ³•æ€è·¯ï¼šå †ç»´æŠ¤æ‰€æœ‰ç»„çš„å³ç«¯ç‚¹æœ€å°å€¼ã€‚

- è§£é‡Šï¼šä½¿ç”¨å°æ ¹å †ç»´æŠ¤æ‰€æœ‰ç»„çš„å³ç«¯ç‚¹çš„æœ€å°å€¼
              åœ¨å·²ç»å­˜åœ¨çš„ç»„ä¸­ï¼Œæ²¡æœ‰å³ç«¯ç‚¹æ¯”å½“å‰åŒºé—´çš„å·¦ç«¯ç‚¹å°çš„ï¼Œé‚£ä¹ˆå°±æ–°å¼€ä¸€ä¸ªç»„
              //                               æœ‰å³ç«¯ç‚¹æ¯”å½“å‰åŒºé—´çš„å·¦ç«¯ç‚¹å°çš„ï¼Œé‚£ä¹ˆå°±åŠ åˆ°è¿™ä¸ªç»„ä¸­
              //ç”¨å †çš„åŸå› ï¼šåªéœ€è¦åˆ¤æ–­æ‰€æœ‰ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªç»„çš„å³ç«¯ç‚¹æ¯”å®ƒå°ï¼Œæ‰€ä»¥ç›´æ¥ç»´æŠ¤å³ç«¯ç‚¹çš„æœ€å°å€¼å³å¯

  ```
  		PriorityQueue<Integer> q = new PriorityQueue<Integer>((a,b)->(a-b));
          for(int i=1;i<=n;i++) {
          	PII now = arr[i];
              //å½“å‰æ‰€æœ‰ç»„çš„å³ç«¯ç‚¹æœ€å°å€¼æ¯”å·¦ç«¯ç‚¹å¤§ï¼Œé‚£ä¹ˆå°±æ–°å»ºç»„
              if(q.size()==0 || q.peek()>=now.l) {
              	q.add(now.r);
              	ans++;
              }else {//å¦åˆ™å°±åŠ å…¥åˆ°å³ç«¯ç‚¹æœ€å°çš„ç»„ä¸­ï¼ˆè¿™é‡Œå…¶å®åŠ åˆ°å“ªä¸€ç»„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ºäº†æ–¹ä¾¿åŠ å…¥åˆ°æœ€å°çš„ç»„ä¸­ï¼‰
              	q.poll();
              	q.add(now.r);
              }
  ```

### ç»å¯¹å€¼ä¸ç­‰å¼

- é¢˜æ„ï¼šåœ¨ä¸€æ¡æ•°è½´ä¸Šæœ‰Nä¸ªç‚¹,A1~ANã€‚å¯»æ‰¾ä¸€ä¸ªç‚¹ï¼Œä½¿å¾—nä¸ªç‚¹åˆ°è¯¥ç‚¹çš„è·ç¦»å’Œæœ€å°

- ä¸ç­‰å¼ï¼š|x-a|+|x-b|>=|a-b|(å½“ä¸”ä»…å½“xåœ¨çº¿æ®µabä¸Šæ—¶å–ç­‰)

  æ¨å¹¿ï¼š

  ```
    |x-a1|+|x-a2|+...|x-an|
  
  =(|x-a1|+|x-an|)+(|x-a2|+|x-an-1|)+...  
  
  >=|a1-an|+|a2-an-1|+...(æ¯ä¸€ä¸ªç­‰å·æˆç«‹çš„æ¡ä»¶éƒ½æ˜¯xåœ¨èŒƒå›´ä¹‹é—´)
  ```

  æ‰€ä»¥å¾—å‡ºç»“è®ºï¼š

  å½“nä¸ºå¥‡æ•°æ—¶ï¼Œxä¸ºnçš„ä¸­ä½æ•°ï¼Œå³(n+1)/2

  å½“nä¸ºå¶æ•°æ—¶ï¼Œxå–ä¸­é—´ä¸¤ä¸ªæ•°ä¹‹é—´ä»»æ„æ•°éƒ½å¯ï¼Œ[n/2ï¼Œn/2+1]	ï¼Œæ–¹ä¾¿å†™ä»£ç ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥å–(n+1)/2

- æ€è·¯ï¼šå‡åºæ’åˆ—ï¼Œä¸€æ¬¡è®¡ç®—å’Œä¸­é—´å€¼çš„å·®å€¼

### è€æ‚æŠ€çš„ç‰›

> æ¨å…¬å¼ï¼šhttps://www.acwing.com/activity/content/code/content/6500568/

- è´ªå¿ƒæ¨å…¬å¼çš„æ€è·¯ï¼šè¦æƒ³åˆ°è´ªå¿ƒï¼Œç”»è¡¨æ ¼ï¼Œç›¸é‚»ä¸¤ä¸ªæ•°ï¼Œäº¤æ¢å‰ã€äº¤æ¢åçš„å€¼ï¼Œè®¾å®šå¤§å°å…³ç³»ï¼Œä½¿å¾—äº¤æ¢å‰çš„æœ€ä¼˜

## å¿«è¯»å¿«å†™

```java
class FastRead {
    StreamTokenizer streamTokenizer;  //è¯»å–æ•°å­—
    BufferedReader bufferedReader;  //è¯»å–å­—ç¬¦ä¸²
    PrintWriter out;//è¾“å‡ºæ—¶è¦sc.out.flush();

    public FastRead() {
        streamTokenizer = new StreamTokenizer(new BufferedReader(new InputStreamReader(System.in)));
        bufferedReader = new BufferedReader(new InputStreamReader(System.in));
        out=new PrintWriter(new BufferedWriter(new OutputStreamWriter(System.out)));
    }

    int nextInt() throws IOException {
        streamTokenizer.nextToken();
        return (int) streamTokenizer.nval;
    }

    long nextLong() throws IOException {
        streamTokenizer.nextToken();
        return (long) streamTokenizer.nval; 
    }

    double nextDouble() throws IOException {
        streamTokenizer.nextToken();
        return streamTokenizer.nval;
    }

    String nextLine() throws IOException {
        return bufferedReader.readLine();
    }

    void println(String s) throws IOException{
        out.println(s);
    }

    void println(int s) throws IOException{
        out.println(s);
    }

    void println(long s) throws IOException{
        out.println(s);
    }

    void println(double s) throws IOException{
        out.println(s);
    }

    void println(BigInteger s) throws IOException{
        out.println(s);
    }
}

ä½œè€…ï¼šweiambt
é“¾æ¥ï¼šhttps://www.acwing.com/activity/content/code/content/5436562/
æ¥æºï¼šAcWing
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
```

ä¸‹é¢è¿™ä¸ªæ¿å­ä¸è¡Œï¼ˆåœ¨è“æ¡¥æ¯é‡Œæ²¡ç”¨ï¼‰

```java
Scanner sc = new Scanner(new BufferedReader(new InputStreamReader(System.in)));
```

## åŸºç¡€æ¨¡å‹

### è®¡ç®—æ•°ç»„çš„ä¸€ä¸ªåŒºé—´çš„å€¼

ç§¦ä¹éŸ¶

```java
static int cal(int l,int r) {
	int res = 0;
	while(l<=r) {
		res = res * 10 + num[l];
		l++;
	}
	return res;
}
```

### æšä¸¾æ•°ä½

```java
int num;//ä¸€ä¸ªæ•°
int n;//numçš„æ•°ä½é•¿åº¦
//ä»é«˜ä½æšä¸¾
for(int i=n-1;i>=0;i--)
{
    int u=x>>i&1; //æ‹¿åˆ°è¿™ä¸€ä½çš„å€¼
    
    res += 1<<i;//è¿™ä¸€ä½å¯¹äºåè¿›åˆ¶ç­”æ¡ˆçš„è´¡çŒ®å°±æ˜¯2^i
}
```

